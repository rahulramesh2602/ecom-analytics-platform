[0m11:08:42.181814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106628590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10746bb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10746bd90>]}


============================== 11:08:42.185404 | ce016662-8fb0-4a6e-bc51-e6b0b0e86f40 ==============================
[0m11:08:42.185404 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:08:42.185774 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt debug', 'indirect_selection': 'eager', 'use_colors': 'True', 'warn_error': 'None', 'log_format': 'default', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'empty': 'None', 'target_path': 'None', 'cache_selected_only': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'version_check': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'introspect': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'debug': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'send_anonymous_usage_stats': 'True'}
[0m11:08:42.196598 [info ] [MainThread]: dbt version: 1.10.15
[0m11:08:42.196818 [info ] [MainThread]: python version: 3.13.7
[0m11:08:42.196954 [info ] [MainThread]: python path: /Users/raramesh/Desktop/Project/ecom-analytics-platform/venv/bin/python3.13
[0m11:08:42.197075 [info ] [MainThread]: os info: macOS-15.7.1-arm64-arm-64bit-Mach-O
[0m11:08:42.238142 [info ] [MainThread]: Using profiles dir at /Users/raramesh/.dbt
[0m11:08:42.238385 [info ] [MainThread]: Using profiles.yml file at /Users/raramesh/.dbt/profiles.yml
[0m11:08:42.238520 [info ] [MainThread]: Using dbt_project.yml file at /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/dbt_project.yml
[0m11:08:42.238871 [info ] [MainThread]: adapter type: postgres
[0m11:08:42.238995 [info ] [MainThread]: adapter version: 1.9.1
[0m11:08:42.285264 [info ] [MainThread]: Configuration:
[0m11:08:42.285547 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:08:42.285681 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:08:42.285801 [info ] [MainThread]: Required dependencies:
[0m11:08:42.286051 [debug] [MainThread]: Executing "git --help"
[0m11:08:42.305631 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify tags\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:08:42.306180 [debug] [MainThread]: STDERR: "b''"
[0m11:08:42.306342 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:08:42.306488 [info ] [MainThread]: Connection:
[0m11:08:42.306641 [info ] [MainThread]:   host: localhost
[0m11:08:42.306753 [info ] [MainThread]:   port: 5432
[0m11:08:42.306861 [info ] [MainThread]:   user: raramesh
[0m11:08:42.306962 [info ] [MainThread]:   database: ecommerce_db
[0m11:08:42.307062 [info ] [MainThread]:   schema: analytics
[0m11:08:42.307161 [info ] [MainThread]:   connect_timeout: 10
[0m11:08:42.307263 [info ] [MainThread]:   role: None
[0m11:08:42.307364 [info ] [MainThread]:   search_path: None
[0m11:08:42.307460 [info ] [MainThread]:   keepalives_idle: 0
[0m11:08:42.307559 [info ] [MainThread]:   sslmode: None
[0m11:08:42.307655 [info ] [MainThread]:   sslcert: None
[0m11:08:42.307755 [info ] [MainThread]:   sslkey: None
[0m11:08:42.307851 [info ] [MainThread]:   sslrootcert: None
[0m11:08:42.307959 [info ] [MainThread]:   application_name: dbt
[0m11:08:42.308056 [info ] [MainThread]:   retries: 1
[0m11:08:42.308362 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:08:42.357805 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m11:08:42.404996 [debug] [MainThread]: Using postgres connection "debug"
[0m11:08:42.405228 [debug] [MainThread]: On debug: select 1 as id
[0m11:08:42.405358 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:08:42.427260 [debug] [MainThread]: SQL status: SELECT 1 in 0.022 seconds
[0m11:08:42.427863 [debug] [MainThread]: On debug: Close
[0m11:08:42.428048 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m11:08:42.428205 [info ] [MainThread]: [32mAll checks passed![0m
[0m11:08:42.430700 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.33694655, "process_in_blocks": "0", "process_kernel_time": 0.217333, "process_mem_max_rss": "121470976", "process_out_blocks": "0", "process_user_time": 0.757944}
[0m11:08:42.431019 [debug] [MainThread]: Command `dbt debug` succeeded at 11:08:42.430959 after 0.34 seconds
[0m11:08:42.431180 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:08:42.431352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b5f360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b51fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075189e0>]}
[0m11:08:42.431552 [debug] [MainThread]: Flushing usage events
[0m11:08:43.026367 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:38:48.927701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bc5a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d7f7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d7f7c50>]}


============================== 10:38:48.931674 | 406b2a66-96f9-4229-9e35-cf28d4003a89 ==============================
[0m10:38:48.931674 [info ] [MainThread]: Running with dbt=1.10.15
[0m10:38:48.932052 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'introspect': 'True', 'warn_error': 'None', 'static_parser': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'write_json': 'True', 'debug': 'False', 'version_check': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'log_format': 'default', 'invocation_command': 'dbt run --select stg_orders', 'target_path': 'None', 'no_print': 'None', 'empty': 'False'}
[0m10:38:49.384088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '406b2a66-96f9-4229-9e35-cf28d4003a89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c80a650>]}
[0m10:38:49.420316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '406b2a66-96f9-4229-9e35-cf28d4003a89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d58fbd0>]}
[0m10:38:49.421237 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m10:38:49.515739 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m10:38:49.516666 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m10:38:49.516924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '406b2a66-96f9-4229-9e35-cf28d4003a89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d872650>]}
[0m10:38:50.160344 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.marts
- models.ecom_analytics.intermediate
[0m10:38:50.164800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '406b2a66-96f9-4229-9e35-cf28d4003a89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df39c70>]}
[0m10:38:50.199318 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:38:50.200861 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:38:50.221929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '406b2a66-96f9-4229-9e35-cf28d4003a89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ec94590>]}
[0m10:38:50.222261 [info ] [MainThread]: Found 1 model, 9 sources, 459 macros
[0m10:38:50.222491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '406b2a66-96f9-4229-9e35-cf28d4003a89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e9958b0>]}
[0m10:38:50.223446 [info ] [MainThread]: 
[0m10:38:50.223645 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:38:50.223782 [info ] [MainThread]: 
[0m10:38:50.224006 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:38:50.224460 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m10:38:50.292244 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m10:38:50.292516 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m10:38:50.292678 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:38:50.551207 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.258 seconds
[0m10:38:50.554439 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m10:38:50.555758 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now create_ecommerce_db_analytics)
[0m10:38:50.556678 [debug] [ThreadPool]: Creating schema "database: "ecommerce_db"
schema: "analytics"
"
[0m10:38:50.559473 [debug] [ThreadPool]: Using postgres connection "create_ecommerce_db_analytics"
[0m10:38:50.559654 [debug] [ThreadPool]: On create_ecommerce_db_analytics: BEGIN
[0m10:38:50.559785 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:38:50.567844 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m10:38:50.568041 [debug] [ThreadPool]: Using postgres connection "create_ecommerce_db_analytics"
[0m10:38:50.568215 [debug] [ThreadPool]: On create_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "create_ecommerce_db_analytics"} */
create schema if not exists "analytics"
[0m10:38:50.574311 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.006 seconds
[0m10:38:50.575041 [debug] [ThreadPool]: On create_ecommerce_db_analytics: COMMIT
[0m10:38:50.575199 [debug] [ThreadPool]: Using postgres connection "create_ecommerce_db_analytics"
[0m10:38:50.575332 [debug] [ThreadPool]: On create_ecommerce_db_analytics: COMMIT
[0m10:38:50.577884 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m10:38:50.578485 [debug] [ThreadPool]: On create_ecommerce_db_analytics: Close
[0m10:38:50.579119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_ecommerce_db_analytics, now list_ecommerce_db_analytics)
[0m10:38:50.581960 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:38:50.582134 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m10:38:50.582269 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:38:50.592057 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m10:38:50.592238 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:38:50.592393 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m10:38:50.599225 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.007 seconds
[0m10:38:50.600335 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m10:38:50.600728 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m10:38:50.603239 [debug] [MainThread]: Using postgres connection "master"
[0m10:38:50.603476 [debug] [MainThread]: On master: BEGIN
[0m10:38:50.603631 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:38:50.611207 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m10:38:50.611455 [debug] [MainThread]: Using postgres connection "master"
[0m10:38:50.611699 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m10:38:50.620276 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m10:38:50.621175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '406b2a66-96f9-4229-9e35-cf28d4003a89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ebd3650>]}
[0m10:38:50.621519 [debug] [MainThread]: On master: ROLLBACK
[0m10:38:50.622640 [debug] [MainThread]: Using postgres connection "master"
[0m10:38:50.622849 [debug] [MainThread]: On master: BEGIN
[0m10:38:50.623618 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m10:38:50.623897 [debug] [MainThread]: On master: COMMIT
[0m10:38:50.624092 [debug] [MainThread]: Using postgres connection "master"
[0m10:38:50.624265 [debug] [MainThread]: On master: COMMIT
[0m10:38:50.624624 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:38:50.624846 [debug] [MainThread]: On master: Close
[0m10:38:50.626964 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_orders
[0m10:38:50.627424 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics.stg_orders ............................... [RUN]
[0m10:38:50.627789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_orders)
[0m10:38:50.628059 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_orders
[0m10:38:50.633353 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_orders"
[0m10:38:50.635275 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_orders
[0m10:38:50.661207 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.stg_orders"
[0m10:38:50.662492 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:38:50.662772 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: BEGIN
[0m10:38:50.662951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:38:50.671769 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m10:38:50.672015 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:38:50.672227 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_orders"} */

  create view "ecommerce_db"."analytics"."stg_orders__dbt_tmp"
    
    
  as (
    /*
    Staging model for orders table
    - Cleans and standardizes raw orders data
    - Casts timestamp columns to proper timestamp type
    - One-to-one relationship with source orders table
    - Foundation for downstream intermediate models
*/

SELECT
    --primary key
    order_id,
    --foreign key
    customer_id,
    --business columns
    order_status,
    --timestamp columns 
    order_purchase_timestamp::timestamp AS order_purchase_timestamp,
    order_approved_at::timestamp AS order_approved_at,
    order_delivered_carrier_date::timestamp AS order_delivered_carrier_date,
    order_delivered_customer_date::timestamp AS order_delivered_customer_date,
    order_estimated_delivery_date::timestamp AS order_estimated_delivery_date

FROM "ecommerce_db"."raw_data"."orders"
  );
[0m10:38:50.705995 [debug] [Thread-1 (]: Postgres adapter: Postgres error: relation "raw_data.orders" does not exist
LINE 29: FROM "ecommerce_db"."raw_data"."orders"
              ^

[0m10:38:50.706273 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: ROLLBACK
[0m10:38:50.706673 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: Close
[0m10:38:50.713205 [debug] [Thread-1 (]: Database Error in model stg_orders (models/staging/stg_orders.sql)
  relation "raw_data.orders" does not exist
  LINE 29: FROM "ecommerce_db"."raw_data"."orders"
                ^
  compiled code at target/run/ecom_analytics/models/staging/stg_orders.sql
[0m10:38:50.714415 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '406b2a66-96f9-4229-9e35-cf28d4003a89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128058680>]}
[0m10:38:50.714804 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model analytics.stg_orders ...................... [[31mERROR[0m in 0.09s]
[0m10:38:50.715111 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_orders
[0m10:38:50.715383 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.stg_orders' to be skipped because of status 'error'.  Reason: Database Error in model stg_orders (models/staging/stg_orders.sql)
  relation "raw_data.orders" does not exist
  LINE 29: FROM "ecommerce_db"."raw_data"."orders"
                ^
  compiled code at target/run/ecom_analytics/models/staging/stg_orders.sql.
[0m10:38:50.716290 [debug] [MainThread]: Using postgres connection "master"
[0m10:38:50.716447 [debug] [MainThread]: On master: BEGIN
[0m10:38:50.716581 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:38:50.723821 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m10:38:50.724046 [debug] [MainThread]: On master: COMMIT
[0m10:38:50.724195 [debug] [MainThread]: Using postgres connection "master"
[0m10:38:50.724328 [debug] [MainThread]: On master: COMMIT
[0m10:38:50.724590 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:38:50.724721 [debug] [MainThread]: On master: Close
[0m10:38:50.724913 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:38:50.725033 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_orders' was properly closed.
[0m10:38:50.725168 [info ] [MainThread]: 
[0m10:38:50.725311 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.50 seconds (0.50s).
[0m10:38:50.725621 [debug] [MainThread]: Command end result
[0m10:38:50.739051 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:38:50.740333 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:38:50.743516 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m10:38:50.743719 [info ] [MainThread]: 
[0m10:38:50.743987 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m10:38:50.744219 [info ] [MainThread]: 
[0m10:38:50.744432 [error] [MainThread]: [31mFailure in model stg_orders (models/staging/stg_orders.sql)[0m
[0m10:38:50.744635 [error] [MainThread]:   Database Error in model stg_orders (models/staging/stg_orders.sql)
  relation "raw_data.orders" does not exist
  LINE 29: FROM "ecommerce_db"."raw_data"."orders"
                ^
  compiled code at target/run/ecom_analytics/models/staging/stg_orders.sql
[0m10:38:50.744787 [info ] [MainThread]: 
[0m10:38:50.744966 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/staging/stg_orders.sql
[0m10:38:50.745107 [info ] [MainThread]: 
[0m10:38:50.745266 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m10:38:50.769486 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.9012048, "process_in_blocks": "0", "process_kernel_time": 0.391602, "process_mem_max_rss": "153714688", "process_out_blocks": "0", "process_user_time": 2.253803}
[0m10:38:50.769784 [debug] [MainThread]: Command `dbt run` failed at 10:38:50.769739 after 1.90 seconds
[0m10:38:50.769989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11efadd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11efd6210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e9c7ad0>]}
[0m10:38:50.770166 [debug] [MainThread]: Flushing usage events
[0m10:38:51.430168 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:39:49.990012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10750e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1291f7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1291f7c50>]}


============================== 10:39:49.993623 | f9432bb5-f348-4335-84b7-198c5e88e8df ==============================
[0m10:39:49.993623 [info ] [MainThread]: Running with dbt=1.10.15
[0m10:39:49.993976 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'use_experimental_parser': 'False', 'printer_width': '80', 'log_format': 'default', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'introspect': 'True', 'static_parser': 'True', 'version_check': 'True', 'write_json': 'True', 'quiet': 'False', 'empty': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'partial_parse': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run --select stg_orders', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'target_path': 'None', 'profiles_dir': '/Users/raramesh/.dbt'}
[0m10:39:50.125723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f9432bb5-f348-4335-84b7-198c5e88e8df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12830e650>]}
[0m10:39:50.159268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f9432bb5-f348-4335-84b7-198c5e88e8df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129093bd0>]}
[0m10:39:50.160135 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m10:39:50.224226 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m10:39:50.307600 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:39:50.308123 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/staging/_sources.yml
[0m10:39:50.494315 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.intermediate
- models.ecom_analytics.marts
[0m10:39:50.499412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f9432bb5-f348-4335-84b7-198c5e88e8df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a3ba350>]}
[0m10:39:50.534192 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:39:50.535697 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:39:50.561756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f9432bb5-f348-4335-84b7-198c5e88e8df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1298b7020>]}
[0m10:39:50.562053 [info ] [MainThread]: Found 1 model, 9 sources, 459 macros
[0m10:39:50.562230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f9432bb5-f348-4335-84b7-198c5e88e8df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a7fbcb0>]}
[0m10:39:50.563129 [info ] [MainThread]: 
[0m10:39:50.563320 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:39:50.563458 [info ] [MainThread]: 
[0m10:39:50.563715 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:39:50.564187 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m10:39:50.650943 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m10:39:50.651203 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m10:39:50.651363 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:39:50.679507 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.028 seconds
[0m10:39:50.680425 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m10:39:50.681097 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m10:39:50.684178 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:39:50.684365 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m10:39:50.684503 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:39:50.691845 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m10:39:50.692056 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:39:50.692207 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m10:39:50.700930 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.009 seconds
[0m10:39:50.701644 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m10:39:50.702035 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m10:39:50.704335 [debug] [MainThread]: Using postgres connection "master"
[0m10:39:50.704547 [debug] [MainThread]: On master: BEGIN
[0m10:39:50.704677 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:39:50.715572 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m10:39:50.715826 [debug] [MainThread]: Using postgres connection "master"
[0m10:39:50.716029 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m10:39:50.731146 [debug] [MainThread]: SQL status: SELECT 0 in 0.015 seconds
[0m10:39:50.731908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f9432bb5-f348-4335-84b7-198c5e88e8df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b3f8fc0>]}
[0m10:39:50.732180 [debug] [MainThread]: On master: ROLLBACK
[0m10:39:50.732503 [debug] [MainThread]: Using postgres connection "master"
[0m10:39:50.732690 [debug] [MainThread]: On master: BEGIN
[0m10:39:50.733098 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m10:39:50.733262 [debug] [MainThread]: On master: COMMIT
[0m10:39:50.733396 [debug] [MainThread]: Using postgres connection "master"
[0m10:39:50.733519 [debug] [MainThread]: On master: COMMIT
[0m10:39:50.733785 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:39:50.733935 [debug] [MainThread]: On master: Close
[0m10:39:50.735424 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_orders
[0m10:39:50.735702 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics.stg_orders ............................... [RUN]
[0m10:39:50.735927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_orders)
[0m10:39:50.736110 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_orders
[0m10:39:50.740637 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_orders"
[0m10:39:50.741183 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_orders
[0m10:39:50.763695 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.stg_orders"
[0m10:39:50.764427 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:39:50.764679 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: BEGIN
[0m10:39:50.764837 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:39:50.772119 [debug] [Thread-1 (]: SQL status: BEGIN in 0.007 seconds
[0m10:39:50.772434 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:39:50.772620 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_orders"} */

  create view "ecommerce_db"."analytics"."stg_orders__dbt_tmp"
    
    
  as (
    /*
    Staging model for orders table
    - Cleans and standardizes raw orders data
    - Casts timestamp columns to proper timestamp type
    - One-to-one relationship with source orders table
    - Foundation for downstream intermediate models
*/

SELECT
    --primary key
    order_id,
    --foreign key
    customer_id,
    --business columns
    order_status,
    --timestamp columns 
    order_purchase_timestamp::timestamp AS order_purchase_timestamp,
    order_approved_at::timestamp AS order_approved_at,
    order_delivered_carrier_date::timestamp AS order_delivered_carrier_date,
    order_delivered_customer_date::timestamp AS order_delivered_customer_date,
    order_estimated_delivery_date::timestamp AS order_estimated_delivery_date

FROM "ecommerce_db"."public"."orders"
  );
[0m10:39:50.783739 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m10:39:50.787254 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:39:50.787462 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_orders"} */
alter table "ecommerce_db"."analytics"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m10:39:50.788860 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m10:39:50.796381 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: COMMIT
[0m10:39:50.796613 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:39:50.796782 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: COMMIT
[0m10:39:50.798172 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m10:39:50.870357 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."stg_orders__dbt_backup"
[0m10:39:50.873098 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:39:50.873328 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_orders"} */
drop view if exists "ecommerce_db"."analytics"."stg_orders__dbt_backup" cascade
[0m10:39:50.874258 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m10:39:50.875559 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: Close
[0m10:39:50.878469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9432bb5-f348-4335-84b7-198c5e88e8df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b4f8e90>]}
[0m10:39:50.878811 [info ] [Thread-1 (]: 1 of 1 OK created sql view model analytics.stg_orders .......................... [[32mCREATE VIEW[0m in 0.14s]
[0m10:39:50.879101 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_orders
[0m10:39:50.879731 [debug] [MainThread]: Using postgres connection "master"
[0m10:39:50.879916 [debug] [MainThread]: On master: BEGIN
[0m10:39:50.880041 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:39:50.889914 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m10:39:50.890153 [debug] [MainThread]: On master: COMMIT
[0m10:39:50.890303 [debug] [MainThread]: Using postgres connection "master"
[0m10:39:50.890436 [debug] [MainThread]: On master: COMMIT
[0m10:39:50.890684 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:39:50.890818 [debug] [MainThread]: On master: Close
[0m10:39:50.891016 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:39:50.891141 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_orders' was properly closed.
[0m10:39:50.891282 [info ] [MainThread]: 
[0m10:39:50.891431 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.33 seconds (0.33s).
[0m10:39:50.891740 [debug] [MainThread]: Command end result
[0m10:39:50.903826 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:39:50.905154 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:39:50.908521 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m10:39:50.908710 [info ] [MainThread]: 
[0m10:39:50.908897 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:39:50.909028 [info ] [MainThread]: 
[0m10:39:50.909164 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m10:39:50.910963 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.98167795, "process_in_blocks": "0", "process_kernel_time": 0.320783, "process_mem_max_rss": "155533312", "process_out_blocks": "0", "process_user_time": 1.911434}
[0m10:39:50.911301 [debug] [MainThread]: Command `dbt run` succeeded at 10:39:50.911248 after 0.98 seconds
[0m10:39:50.911541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b1da620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b10d630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b10d770>]}
[0m10:39:50.911725 [debug] [MainThread]: Flushing usage events
[0m10:39:51.733960 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:42:43.274199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069f2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1205fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1205fbc50>]}


============================== 10:42:43.277997 | fd4aacbd-9666-45ba-998d-3e6802c143d6 ==============================
[0m10:42:43.277997 [info ] [MainThread]: Running with dbt=1.10.15
[0m10:42:43.278356 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt show --select stg_orders', 'target_path': 'None', 'cache_selected_only': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'introspect': 'True', 'write_json': 'True', 'quiet': 'False', 'static_parser': 'True', 'warn_error': 'None', 'empty': 'None', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'printer_width': '80', 'version_check': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'use_experimental_parser': 'False', 'debug': 'False', 'log_cache_events': 'False'}
[0m10:42:43.418801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd4aacbd-9666-45ba-998d-3e6802c143d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107412650>]}
[0m10:42:43.449949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd4aacbd-9666-45ba-998d-3e6802c143d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120493bd0>]}
[0m10:42:43.470238 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m10:42:43.528902 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m10:42:43.619245 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:42:43.619533 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:42:43.622596 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.marts
- models.ecom_analytics.intermediate
[0m10:42:43.636966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd4aacbd-9666-45ba-998d-3e6802c143d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1216c8750>]}
[0m10:42:43.673989 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:42:43.675713 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:42:43.677741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd4aacbd-9666-45ba-998d-3e6802c143d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c0fe30>]}
[0m10:42:43.678044 [info ] [MainThread]: Found 1 model, 9 sources, 459 macros
[0m10:42:43.678223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd4aacbd-9666-45ba-998d-3e6802c143d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1216c7690>]}
[0m10:42:43.679137 [info ] [MainThread]: 
[0m10:42:43.679363 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:42:43.679509 [info ] [MainThread]: 
[0m10:42:43.679822 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:42:43.680317 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m10:42:43.760098 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:42:43.760365 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m10:42:43.760515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:42:43.781557 [debug] [ThreadPool]: SQL status: BEGIN in 0.021 seconds
[0m10:42:43.781843 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:42:43.782027 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m10:42:43.786318 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.004 seconds
[0m10:42:43.787106 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m10:42:43.787379 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m10:42:43.789793 [debug] [MainThread]: Using postgres connection "master"
[0m10:42:43.790007 [debug] [MainThread]: On master: BEGIN
[0m10:42:43.790160 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:42:43.796590 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m10:42:43.796808 [debug] [MainThread]: Using postgres connection "master"
[0m10:42:43.797005 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m10:42:43.804557 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m10:42:43.805285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd4aacbd-9666-45ba-998d-3e6802c143d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1233c46d0>]}
[0m10:42:43.805549 [debug] [MainThread]: On master: ROLLBACK
[0m10:42:43.805839 [debug] [MainThread]: On master: Close
[0m10:42:43.808041 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_orders
[0m10:42:43.808254 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_orders)
[0m10:42:43.808429 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_orders
[0m10:42:43.812331 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_orders"
[0m10:42:43.813203 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_orders
[0m10:42:43.817238 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:42:43.817478 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_orders"} */

  
  /*
    Staging model for orders table
    - Cleans and standardizes raw orders data
    - Casts timestamp columns to proper timestamp type
    - One-to-one relationship with source orders table
    - Foundation for downstream intermediate models
*/

SELECT
    --primary key
    order_id,
    --foreign key
    customer_id,
    --business columns
    order_status,
    --timestamp columns 
    order_purchase_timestamp::timestamp AS order_purchase_timestamp,
    order_approved_at::timestamp AS order_approved_at,
    order_delivered_carrier_date::timestamp AS order_delivered_carrier_date,
    order_delivered_customer_date::timestamp AS order_delivered_customer_date,
    order_estimated_delivery_date::timestamp AS order_estimated_delivery_date

FROM "ecommerce_db"."public"."orders"
  
  limit 5

[0m10:42:43.817672 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:42:43.831469 [debug] [Thread-1 (]: SQL status: SELECT 5 in 0.014 seconds
[0m10:42:43.832993 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: Close
[0m10:42:43.833429 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_orders
[0m10:42:43.834087 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:42:43.834268 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_orders' was properly closed.
[0m10:42:43.834630 [debug] [MainThread]: Command end result
[0m10:42:43.846797 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:42:43.848123 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:42:43.851616 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m10:42:43.851912 [info ] [MainThread]: Previewing node 'stg_orders':
| order_id             | customer_id          | order_status | order_purchase_ti... |   order_approved_at | order_delivered_c... | ... |
| -------------------- | -------------------- | ------------ | -------------------- | ------------------- | -------------------- | --- |
| e481f51cbdc54678b... | 9ef432eb625129730... | delivered    |  2017-10-02 10:56:33 | 2017-10-02 11:07:15 |  2017-10-04 19:55:00 | ... |
| 53cdb2fc8bc7dce0b... | b0830fb4747a6c6d2... | delivered    |  2018-07-24 20:41:37 | 2018-07-26 03:24:27 |  2018-07-26 14:31:00 | ... |
| 47770eb9100c2d0c4... | 41ce2a54c0b03bf34... | delivered    |  2018-08-08 08:38:49 | 2018-08-08 08:55:23 |  2018-08-08 13:50:00 | ... |
| 949d5b44dbf5de918... | f88197465ea7920ad... | delivered    |  2017-11-18 19:28:06 | 2017-11-18 19:45:59 |  2017-11-22 13:39:59 | ... |
| ad21c59c0840e6cb8... | 8ab97904e6daea886... | delivered    |  2018-02-13 21:18:39 | 2018-02-13 22:20:29 |  2018-02-14 19:46:34 | ... |

[0m10:42:43.853783 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 0.6394506, "process_in_blocks": "0", "process_kernel_time": 0.289101, "process_mem_max_rss": "147570688", "process_out_blocks": "0", "process_user_time": 1.530519}
[0m10:42:43.854048 [debug] [MainThread]: Command `dbt show` succeeded at 10:42:43.854002 after 0.64 seconds
[0m10:42:43.854267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1205ec590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1217d9700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1217d97b0>]}
[0m10:42:43.854454 [debug] [MainThread]: Flushing usage events
[0m10:42:44.405490 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:43:17.313090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10866a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bf7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bf7c50>]}


============================== 10:43:17.318423 | cb8084af-597c-4f44-b64b-48f73636f735 ==============================
[0m10:43:17.318423 [info ] [MainThread]: Running with dbt=1.10.15
[0m10:43:17.318804 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'empty': 'None', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'static_parser': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'printer_width': '80', 'partial_parse': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'target_path': 'None', 'quiet': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'debug': 'False', 'invocation_command': 'dbt run-operation query --args {sql: "SELECT * FROM analytics.stg_orders LIMIT 3"}', 'log_format': 'default'}
[0m10:43:17.455607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb8084af-597c-4f44-b64b-48f73636f735', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f0a650>]}
[0m10:43:17.490591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cb8084af-597c-4f44-b64b-48f73636f735', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a8f460>]}
[0m10:43:17.491488 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m10:43:17.550735 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m10:43:17.631608 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:43:17.631873 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:43:17.635004 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.marts
- models.ecom_analytics.intermediate
[0m10:43:17.648663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb8084af-597c-4f44-b64b-48f73636f735', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab3c950>]}
[0m10:43:17.686439 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:43:17.688200 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:43:17.711094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb8084af-597c-4f44-b64b-48f73636f735', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8bf200>]}
[0m10:43:17.711419 [info ] [MainThread]: Found 1 model, 9 sources, 459 macros
[0m10:43:17.711602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb8084af-597c-4f44-b64b-48f73636f735', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acf8d70>]}
[0m10:43:17.711915 [debug] [MainThread]: Acquiring new postgres connection 'macro_query'
[0m10:43:17.712086 [debug] [MainThread]: Using postgres connection "macro_query"
[0m10:43:17.712213 [debug] [MainThread]: On macro_query: BEGIN
[0m10:43:17.712336 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:43:17.738752 [debug] [MainThread]: SQL status: BEGIN in 0.026 seconds
[0m10:43:17.739019 [debug] [MainThread]: On macro_query: COMMIT
[0m10:43:17.739183 [debug] [MainThread]: Using postgres connection "macro_query"
[0m10:43:17.739319 [debug] [MainThread]: On macro_query: COMMIT
[0m10:43:17.739557 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:43:17.739733 [debug] [MainThread]: On macro_query: Close
[0m10:43:17.739956 [error] [MainThread]: Encountered an error while running operation: Runtime Error
  dbt could not find a macro with the name "query" in any package
[0m10:43:17.741286 [debug] [MainThread]: Traceback (most recent call last):
  File "/Users/raramesh/Desktop/Project/ecom-analytics-platform/venv/lib/python3.13/site-packages/dbt/task/run_operation.py", line 64, in run
    self._run_unsafe(package_name, macro_name)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/raramesh/Desktop/Project/ecom-analytics-platform/venv/lib/python3.13/site-packages/dbt/task/run_operation.py", line 45, in _run_unsafe
    res = adapter.execute_macro(
        macro_name, project=package_name, kwargs=macro_kwargs, macro_resolver=self.manifest
    )
  File "/Users/raramesh/Desktop/Project/ecom-analytics-platform/venv/lib/python3.13/site-packages/dbt/adapters/base/impl.py", line 1294, in execute_macro
    raise DbtRuntimeError(
    ...<3 lines>...
    )
dbt_common.exceptions.base.DbtRuntimeError: Runtime Error
  dbt could not find a macro with the name "query" in any package

[0m10:43:17.741501 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt could not find a macro with the name 'query' in any package. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m10:43:17.743495 [debug] [MainThread]: Resource report: {"command_name": "run-operation", "command_success": false, "command_wall_clock_time": 0.48824075, "process_in_blocks": "0", "process_kernel_time": 0.278322, "process_mem_max_rss": "143949824", "process_out_blocks": "0", "process_user_time": 1.567739}
[0m10:43:17.743763 [debug] [MainThread]: Command `dbt run-operation` failed at 10:43:17.743713 after 0.49 seconds
[0m10:43:17.743923 [debug] [MainThread]: Connection 'macro_query' was properly closed.
[0m10:43:17.744084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab68ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109be8590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acc1550>]}
[0m10:43:17.744258 [debug] [MainThread]: Flushing usage events
[0m10:43:18.397618 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:43:49.361245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10683e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dfbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dfbc50>]}


============================== 10:43:49.364953 | e8c5390d-0311-435e-97a3-0cea7ff8c6d4 ==============================
[0m10:43:49.364953 [info ] [MainThread]: Running with dbt=1.10.15
[0m10:43:49.365382 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'introspect': 'True', 'warn_error': 'None', 'no_print': 'None', 'debug': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'version_check': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'empty': 'None', 'invocation_command': 'dbt show --select stg_orders --limit 3', 'target_path': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'use_colors': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'quiet': 'False', 'fail_fast': 'False', 'partial_parse': 'True'}
[0m10:43:49.490063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e8c5390d-0311-435e-97a3-0cea7ff8c6d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e0a650>]}
[0m10:43:49.523057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e8c5390d-0311-435e-97a3-0cea7ff8c6d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c8fbd0>]}
[0m10:43:49.540755 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m10:43:49.599171 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m10:43:49.665489 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:43:49.665745 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:43:49.668567 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.marts
- models.ecom_analytics.intermediate
[0m10:43:49.682775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e8c5390d-0311-435e-97a3-0cea7ff8c6d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110f0750>]}
[0m10:43:49.719819 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:43:49.721565 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:43:49.723420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e8c5390d-0311-435e-97a3-0cea7ff8c6d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104b7e30>]}
[0m10:43:49.723675 [info ] [MainThread]: Found 1 model, 9 sources, 459 macros
[0m10:43:49.723848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8c5390d-0311-435e-97a3-0cea7ff8c6d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110c7690>]}
[0m10:43:49.724736 [info ] [MainThread]: 
[0m10:43:49.724916 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:43:49.725041 [info ] [MainThread]: 
[0m10:43:49.725290 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:43:49.725711 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m10:43:49.779243 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:43:49.779513 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m10:43:49.779668 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:43:49.804221 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m10:43:49.804476 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:43:49.804635 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m10:43:49.809329 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m10:43:49.810083 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m10:43:49.810414 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m10:43:49.812744 [debug] [MainThread]: Using postgres connection "master"
[0m10:43:49.812929 [debug] [MainThread]: On master: BEGIN
[0m10:43:49.813065 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:43:49.820846 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m10:43:49.821048 [debug] [MainThread]: Using postgres connection "master"
[0m10:43:49.821236 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m10:43:49.827995 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m10:43:49.828667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8c5390d-0311-435e-97a3-0cea7ff8c6d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114c46d0>]}
[0m10:43:49.828903 [debug] [MainThread]: On master: ROLLBACK
[0m10:43:49.829238 [debug] [MainThread]: On master: Close
[0m10:43:49.831325 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_orders
[0m10:43:49.831561 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_orders)
[0m10:43:49.831742 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_orders
[0m10:43:49.835744 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_orders"
[0m10:43:49.836317 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_orders
[0m10:43:49.840202 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_orders"
[0m10:43:49.840456 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_orders"} */

  
  /*
    Staging model for orders table
    - Cleans and standardizes raw orders data
    - Casts timestamp columns to proper timestamp type
    - One-to-one relationship with source orders table
    - Foundation for downstream intermediate models
*/

SELECT
    --primary key
    order_id,
    --foreign key
    customer_id,
    --business columns
    order_status,
    --timestamp columns 
    order_purchase_timestamp::timestamp AS order_purchase_timestamp,
    order_approved_at::timestamp AS order_approved_at,
    order_delivered_carrier_date::timestamp AS order_delivered_carrier_date,
    order_delivered_customer_date::timestamp AS order_delivered_customer_date,
    order_estimated_delivery_date::timestamp AS order_estimated_delivery_date

FROM "ecommerce_db"."public"."orders"
  
  limit 3

[0m10:43:49.840649 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:43:49.851993 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.011 seconds
[0m10:43:49.853274 [debug] [Thread-1 (]: On model.ecom_analytics.stg_orders: Close
[0m10:43:49.853671 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_orders
[0m10:43:49.854226 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:43:49.854370 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_orders' was properly closed.
[0m10:43:49.854672 [debug] [MainThread]: Command end result
[0m10:43:49.865625 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:43:49.866736 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:43:49.869983 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m10:43:49.870238 [info ] [MainThread]: Previewing node 'stg_orders':
| order_id             | customer_id          | order_status | order_purchase_ti... |   order_approved_at | order_delivered_c... | ... |
| -------------------- | -------------------- | ------------ | -------------------- | ------------------- | -------------------- | --- |
| e481f51cbdc54678b... | 9ef432eb625129730... | delivered    |  2017-10-02 10:56:33 | 2017-10-02 11:07:15 |  2017-10-04 19:55:00 | ... |
| 53cdb2fc8bc7dce0b... | b0830fb4747a6c6d2... | delivered    |  2018-07-24 20:41:37 | 2018-07-26 03:24:27 |  2018-07-26 14:31:00 | ... |
| 47770eb9100c2d0c4... | 41ce2a54c0b03bf34... | delivered    |  2018-08-08 08:38:49 | 2018-08-08 08:55:23 |  2018-08-08 13:50:00 | ... |

[0m10:43:49.871883 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 0.5557804, "process_in_blocks": "0", "process_kernel_time": 0.282767, "process_mem_max_rss": "149323776", "process_out_blocks": "0", "process_user_time": 1.58835}
[0m10:43:49.872116 [debug] [MainThread]: Command `dbt show` succeeded at 10:43:49.872076 after 0.56 seconds
[0m10:43:49.872308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dec590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111cd700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111cd7b0>]}
[0m10:43:49.872473 [debug] [MainThread]: Flushing usage events
[0m10:43:50.362877 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:36:21.647745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108f2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124f7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124f7c50>]}


============================== 11:36:21.652074 | b8eaa06b-9730-46f5-902e-8fd84eae9523 ==============================
[0m11:36:21.652074 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:36:21.652463 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'debug': 'False', 'fail_fast': 'False', 'empty': 'False', 'static_parser': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'printer_width': '80', 'invocation_command': 'dbt run --select stg_products', 'use_colors': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'version_check': 'True', 'write_json': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'partial_parse': 'True', 'quiet': 'False', 'no_print': 'None'}
[0m11:36:21.799441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8eaa06b-9730-46f5-902e-8fd84eae9523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11150e650>]}
[0m11:36:21.833453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8eaa06b-9730-46f5-902e-8fd84eae9523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112293bd0>]}
[0m11:36:21.834411 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:36:21.923011 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:36:22.011028 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m11:36:22.011361 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/staging/stg_products.sql
[0m11:36:22.136649 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.intermediate
- models.ecom_analytics.marts
[0m11:36:22.143426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8eaa06b-9730-46f5-902e-8fd84eae9523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11353c750>]}
[0m11:36:22.180031 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:36:22.182702 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:36:22.203191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8eaa06b-9730-46f5-902e-8fd84eae9523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c84140>]}
[0m11:36:22.203482 [info ] [MainThread]: Found 2 models, 9 sources, 459 macros
[0m11:36:22.203653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8eaa06b-9730-46f5-902e-8fd84eae9523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124fe190>]}
[0m11:36:22.204500 [info ] [MainThread]: 
[0m11:36:22.204677 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:36:22.204812 [info ] [MainThread]: 
[0m11:36:22.205064 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:36:22.205494 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:36:22.283972 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:36:22.284255 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:36:22.284408 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:36:22.314286 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.030 seconds
[0m11:36:22.315160 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:36:22.317406 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:36:22.320354 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:36:22.320536 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:36:22.320669 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:36:22.327195 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m11:36:22.327386 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:36:22.327541 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:36:22.334072 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.006 seconds
[0m11:36:22.334750 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:36:22.335025 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:36:22.337218 [debug] [MainThread]: Using postgres connection "master"
[0m11:36:22.337397 [debug] [MainThread]: On master: BEGIN
[0m11:36:22.337533 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:36:22.344118 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:36:22.344393 [debug] [MainThread]: Using postgres connection "master"
[0m11:36:22.344602 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:36:22.351953 [debug] [MainThread]: SQL status: SELECT 1 in 0.007 seconds
[0m11:36:22.352687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8eaa06b-9730-46f5-902e-8fd84eae9523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b3f450>]}
[0m11:36:22.352958 [debug] [MainThread]: On master: ROLLBACK
[0m11:36:22.353262 [debug] [MainThread]: Using postgres connection "master"
[0m11:36:22.353396 [debug] [MainThread]: On master: BEGIN
[0m11:36:22.353833 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:36:22.354058 [debug] [MainThread]: On master: COMMIT
[0m11:36:22.354228 [debug] [MainThread]: Using postgres connection "master"
[0m11:36:22.354361 [debug] [MainThread]: On master: COMMIT
[0m11:36:22.354589 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:36:22.354732 [debug] [MainThread]: On master: Close
[0m11:36:22.356808 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_products
[0m11:36:22.357111 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics.stg_products ............................. [RUN]
[0m11:36:22.357507 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_products)
[0m11:36:22.357819 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_products
[0m11:36:22.361750 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_products"
[0m11:36:22.362724 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_products
[0m11:36:22.381412 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.stg_products"
[0m11:36:22.382165 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_products"
[0m11:36:22.382414 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: BEGIN
[0m11:36:22.382657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:36:22.397600 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m11:36:22.397826 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_products"
[0m11:36:22.398008 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_products"} */

  create view "ecommerce_db"."analytics"."stg_products__dbt_tmp"
    
    
  as (
    /*
    Staging model for products table
    - Cleans and standardizes raw products data
*/

SELECT
    -- primary key
    product_id,
    -- business columns
    product_category_name,
    product_name_lenght,
    product_description_lenght,
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm

FROM "ecommerce_db"."public"."products"
  );
[0m11:36:22.405379 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m11:36:22.409100 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_products"
[0m11:36:22.409362 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_products"} */
alter table "ecommerce_db"."analytics"."stg_products__dbt_tmp" rename to "stg_products"
[0m11:36:22.409891 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:36:22.417638 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: COMMIT
[0m11:36:22.417889 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_products"
[0m11:36:22.418061 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: COMMIT
[0m11:36:22.419158 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m11:36:22.422419 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."stg_products__dbt_backup"
[0m11:36:22.425002 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_products"
[0m11:36:22.425212 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_products"} */
drop view if exists "ecommerce_db"."analytics"."stg_products__dbt_backup" cascade
[0m11:36:22.425692 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m11:36:22.426951 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: Close
[0m11:36:22.429457 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8eaa06b-9730-46f5-902e-8fd84eae9523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113cecdd0>]}
[0m11:36:22.429802 [info ] [Thread-1 (]: 1 of 1 OK created sql view model analytics.stg_products ........................ [[32mCREATE VIEW[0m in 0.07s]
[0m11:36:22.430100 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_products
[0m11:36:22.430724 [debug] [MainThread]: Using postgres connection "master"
[0m11:36:22.430886 [debug] [MainThread]: On master: BEGIN
[0m11:36:22.431024 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:36:22.437716 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:36:22.437912 [debug] [MainThread]: On master: COMMIT
[0m11:36:22.438054 [debug] [MainThread]: Using postgres connection "master"
[0m11:36:22.438198 [debug] [MainThread]: On master: COMMIT
[0m11:36:22.438530 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:36:22.438666 [debug] [MainThread]: On master: Close
[0m11:36:22.438869 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:36:22.439010 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_products' was properly closed.
[0m11:36:22.439150 [info ] [MainThread]: 
[0m11:36:22.439296 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m11:36:22.439606 [debug] [MainThread]: Command end result
[0m11:36:22.453140 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:36:22.454700 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:36:22.458349 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:36:22.458534 [info ] [MainThread]: 
[0m11:36:22.458750 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:36:22.458888 [info ] [MainThread]: 
[0m11:36:22.459062 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:36:22.460976 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8775657, "process_in_blocks": "0", "process_kernel_time": 0.316777, "process_mem_max_rss": "151502848", "process_out_blocks": "0", "process_user_time": 1.718495}
[0m11:36:22.461242 [debug] [MainThread]: Command `dbt run` succeeded at 11:36:22.461196 after 0.88 seconds
[0m11:36:22.461452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139d1b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113965f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113966030>]}
[0m11:36:22.461628 [debug] [MainThread]: Flushing usage events
[0m11:36:23.168573 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:36:59.866492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11112a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128fbc50>]}


============================== 11:36:59.870147 | 0b1b93fa-4bb9-4d82-9f64-baa261021ae0 ==============================
[0m11:36:59.870147 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:36:59.870497 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'static_parser': 'True', 'debug': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'introspect': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'log_format': 'default', 'indirect_selection': 'eager', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'empty': 'False', 'invocation_command': 'dbt run --select stg_product_category_name_translation', 'cache_selected_only': 'False', 'write_json': 'True', 'printer_width': '80'}
[0m11:36:59.989660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0b1b93fa-4bb9-4d82-9f64-baa261021ae0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11180a650>]}
[0m11:37:00.024018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0b1b93fa-4bb9-4d82-9f64-baa261021ae0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11268fbd0>]}
[0m11:37:00.025304 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:37:00.084125 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:37:00.161307 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m11:37:00.161673 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/staging/stg_product_category_name_translation.sql
[0m11:37:00.274791 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.marts
- models.ecom_analytics.intermediate
[0m11:37:00.281149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0b1b93fa-4bb9-4d82-9f64-baa261021ae0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139b8750>]}
[0m11:37:00.317083 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:37:00.319100 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:37:00.341595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0b1b93fa-4bb9-4d82-9f64-baa261021ae0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e94140>]}
[0m11:37:00.341939 [info ] [MainThread]: Found 3 models, 9 sources, 459 macros
[0m11:37:00.342122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b1b93fa-4bb9-4d82-9f64-baa261021ae0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128fe190>]}
[0m11:37:00.343047 [info ] [MainThread]: 
[0m11:37:00.343229 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:37:00.343367 [info ] [MainThread]: 
[0m11:37:00.343624 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:37:00.344104 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:37:00.421959 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:37:00.422225 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:37:00.422376 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:37:00.444510 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.022 seconds
[0m11:37:00.445359 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:37:00.447650 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:37:00.451033 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:37:00.451305 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:37:00.451441 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:37:00.459038 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m11:37:00.459297 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:37:00.459453 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:37:00.464929 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m11:37:00.465649 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:37:00.465931 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:37:00.468397 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:00.468615 [debug] [MainThread]: On master: BEGIN
[0m11:37:00.468754 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:37:00.475761 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:37:00.475970 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:00.476153 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:37:00.482944 [debug] [MainThread]: SQL status: SELECT 2 in 0.007 seconds
[0m11:37:00.483713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b1b93fa-4bb9-4d82-9f64-baa261021ae0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e3f6c0>]}
[0m11:37:00.483984 [debug] [MainThread]: On master: ROLLBACK
[0m11:37:00.484267 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:00.484417 [debug] [MainThread]: On master: BEGIN
[0m11:37:00.484777 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:37:00.484913 [debug] [MainThread]: On master: COMMIT
[0m11:37:00.485036 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:00.485157 [debug] [MainThread]: On master: COMMIT
[0m11:37:00.485412 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:37:00.485567 [debug] [MainThread]: On master: Close
[0m11:37:00.488966 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_product_category_name_translation
[0m11:37:00.489282 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics.stg_product_category_name_translation .... [RUN]
[0m11:37:00.489529 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_product_category_name_translation)
[0m11:37:00.489832 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_product_category_name_translation
[0m11:37:00.493852 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_product_category_name_translation"
[0m11:37:00.494580 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_product_category_name_translation
[0m11:37:00.512748 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.stg_product_category_name_translation"
[0m11:37:00.513613 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_product_category_name_translation"
[0m11:37:00.513900 [debug] [Thread-1 (]: On model.ecom_analytics.stg_product_category_name_translation: BEGIN
[0m11:37:00.514127 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:37:00.522260 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m11:37:00.522522 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_product_category_name_translation"
[0m11:37:00.522697 [debug] [Thread-1 (]: On model.ecom_analytics.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_product_category_name_translation"} */

  create view "ecommerce_db"."analytics"."stg_product_category_name_translation__dbt_tmp"
    
    
  as (
    /*
    Staging model for product category name translation table
    - Cleans and standardizes category translation data
    - Maps Portuguese category names to English equivalents
*/

SELECT
    -- Translation columns
    product_category_name,
    product_category_name_english

FROM "ecommerce_db"."public"."product_category_name_translation"
  );
[0m11:37:00.532454 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m11:37:00.536302 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_product_category_name_translation"
[0m11:37:00.536560 [debug] [Thread-1 (]: On model.ecom_analytics.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_product_category_name_translation"} */
alter table "ecommerce_db"."analytics"."stg_product_category_name_translation__dbt_tmp" rename to "stg_product_category_name_translation"
[0m11:37:00.537183 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:37:00.544704 [debug] [Thread-1 (]: On model.ecom_analytics.stg_product_category_name_translation: COMMIT
[0m11:37:00.544947 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_product_category_name_translation"
[0m11:37:00.545112 [debug] [Thread-1 (]: On model.ecom_analytics.stg_product_category_name_translation: COMMIT
[0m11:37:00.546120 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m11:37:00.549857 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."stg_product_category_name_translation__dbt_backup"
[0m11:37:00.552324 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_product_category_name_translation"
[0m11:37:00.552525 [debug] [Thread-1 (]: On model.ecom_analytics.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_product_category_name_translation"} */
drop view if exists "ecommerce_db"."analytics"."stg_product_category_name_translation__dbt_backup" cascade
[0m11:37:00.553102 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m11:37:00.554519 [debug] [Thread-1 (]: On model.ecom_analytics.stg_product_category_name_translation: Close
[0m11:37:00.555783 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b1b93fa-4bb9-4d82-9f64-baa261021ae0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fe4e90>]}
[0m11:37:00.556119 [info ] [Thread-1 (]: 1 of 1 OK created sql view model analytics.stg_product_category_name_translation  [[32mCREATE VIEW[0m in 0.07s]
[0m11:37:00.556416 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_product_category_name_translation
[0m11:37:00.557063 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:00.557223 [debug] [MainThread]: On master: BEGIN
[0m11:37:00.557357 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:37:00.565141 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m11:37:00.565340 [debug] [MainThread]: On master: COMMIT
[0m11:37:00.565471 [debug] [MainThread]: Using postgres connection "master"
[0m11:37:00.565591 [debug] [MainThread]: On master: COMMIT
[0m11:37:00.565809 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:37:00.565935 [debug] [MainThread]: On master: Close
[0m11:37:00.566130 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:37:00.566343 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_product_category_name_translation' was properly closed.
[0m11:37:00.566513 [info ] [MainThread]: 
[0m11:37:00.566681 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m11:37:00.567120 [debug] [MainThread]: Command end result
[0m11:37:00.580732 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:37:00.582549 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:37:00.585801 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:37:00.586013 [info ] [MainThread]: 
[0m11:37:00.586244 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:37:00.586398 [info ] [MainThread]: 
[0m11:37:00.586571 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:37:00.588461 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7832138, "process_in_blocks": "0", "process_kernel_time": 0.298647, "process_mem_max_rss": "153010176", "process_out_blocks": "0", "process_user_time": 1.703714}
[0m11:37:00.588756 [debug] [MainThread]: Command `dbt run` succeeded at 11:37:00.588702 after 0.78 seconds
[0m11:37:00.589002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113cde360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c59f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c5a030>]}
[0m11:37:00.589233 [debug] [MainThread]: Flushing usage events
[0m11:37:01.159743 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:42:33.449864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a252900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0ffd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0ffc50>]}


============================== 11:42:33.453789 | 2ebf3067-fc1e-4482-8a4f-2909ff9c3b76 ==============================
[0m11:42:33.453789 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:42:33.454141 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'write_json': 'True', 'invocation_command': 'dbt run --select stg_customers', 'static_parser': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'partial_parse': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'indirect_selection': 'eager', 'debug': 'False', 'use_colors': 'True', 'empty': 'False', 'no_print': 'None', 'quiet': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_cache_events': 'False'}
[0m11:42:33.595251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2ebf3067-fc1e-4482-8a4f-2909ff9c3b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af0a650>]}
[0m11:42:33.627819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2ebf3067-fc1e-4482-8a4f-2909ff9c3b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be93bd0>]}
[0m11:42:33.628757 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:42:33.688173 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:42:33.784669 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m11:42:33.785054 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/staging/stg_customers.sql
[0m11:42:33.907429 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.marts
- models.ecom_analytics.intermediate
[0m11:42:33.914259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2ebf3067-fc1e-4482-8a4f-2909ff9c3b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0b8750>]}
[0m11:42:33.952046 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:42:33.954104 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:42:33.977230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2ebf3067-fc1e-4482-8a4f-2909ff9c3b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c694140>]}
[0m11:42:33.977554 [info ] [MainThread]: Found 4 models, 9 sources, 459 macros
[0m11:42:33.977749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ebf3067-fc1e-4482-8a4f-2909ff9c3b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d215390>]}
[0m11:42:33.978673 [info ] [MainThread]: 
[0m11:42:33.978875 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:42:33.979029 [info ] [MainThread]: 
[0m11:42:33.979304 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:42:33.979964 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:42:34.066533 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:42:34.066814 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:42:34.066985 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:34.097349 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.030 seconds
[0m11:42:34.098283 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:42:34.100964 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:42:34.104051 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:42:34.104223 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:42:34.104363 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:42:34.111932 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m11:42:34.112203 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:42:34.112390 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:42:34.118053 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.005 seconds
[0m11:42:34.118869 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:42:34.119166 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:42:34.121773 [debug] [MainThread]: Using postgres connection "master"
[0m11:42:34.121952 [debug] [MainThread]: On master: BEGIN
[0m11:42:34.122079 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:42:34.129929 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m11:42:34.130184 [debug] [MainThread]: Using postgres connection "master"
[0m11:42:34.130383 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:42:34.137108 [debug] [MainThread]: SQL status: SELECT 3 in 0.007 seconds
[0m11:42:34.137970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ebf3067-fc1e-4482-8a4f-2909ff9c3b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d547380>]}
[0m11:42:34.138215 [debug] [MainThread]: On master: ROLLBACK
[0m11:42:34.138544 [debug] [MainThread]: Using postgres connection "master"
[0m11:42:34.138745 [debug] [MainThread]: On master: BEGIN
[0m11:42:34.139145 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:42:34.139296 [debug] [MainThread]: On master: COMMIT
[0m11:42:34.139436 [debug] [MainThread]: Using postgres connection "master"
[0m11:42:34.139568 [debug] [MainThread]: On master: COMMIT
[0m11:42:34.139796 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:42:34.139941 [debug] [MainThread]: On master: Close
[0m11:42:34.142390 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_customers
[0m11:42:34.142729 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics.stg_customers ............................ [RUN]
[0m11:42:34.142993 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_customers)
[0m11:42:34.143225 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_customers
[0m11:42:34.147315 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_customers"
[0m11:42:34.148176 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_customers
[0m11:42:34.167000 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.stg_customers"
[0m11:42:34.167984 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_customers"
[0m11:42:34.168246 [debug] [Thread-1 (]: On model.ecom_analytics.stg_customers: BEGIN
[0m11:42:34.168434 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:42:34.182599 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m11:42:34.182873 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_customers"
[0m11:42:34.183063 [debug] [Thread-1 (]: On model.ecom_analytics.stg_customers: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_customers"} */

  create view "ecommerce_db"."analytics"."stg_customers__dbt_tmp"
    
    
  as (
    /*
    Staging model for customers table
    - Cleans and standardizes customer data
*/

SELECT
    -- primary key
    customer_id,
    customer_unique_id,
    -- business columns
    customer_zip_code_prefix,
    customer_city,
    customer_state 

FROM "ecommerce_db"."public"."customers"
  );
[0m11:42:34.188363 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m11:42:34.191985 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_customers"
[0m11:42:34.192189 [debug] [Thread-1 (]: On model.ecom_analytics.stg_customers: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_customers"} */
alter table "ecommerce_db"."analytics"."stg_customers__dbt_tmp" rename to "stg_customers"
[0m11:42:34.193235 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:42:34.200647 [debug] [Thread-1 (]: On model.ecom_analytics.stg_customers: COMMIT
[0m11:42:34.200906 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_customers"
[0m11:42:34.201087 [debug] [Thread-1 (]: On model.ecom_analytics.stg_customers: COMMIT
[0m11:42:34.202045 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m11:42:34.205417 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."stg_customers__dbt_backup"
[0m11:42:34.207785 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_customers"
[0m11:42:34.207987 [debug] [Thread-1 (]: On model.ecom_analytics.stg_customers: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_customers"} */
drop view if exists "ecommerce_db"."analytics"."stg_customers__dbt_backup" cascade
[0m11:42:34.208684 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m11:42:34.209904 [debug] [Thread-1 (]: On model.ecom_analytics.stg_customers: Close
[0m11:42:34.211325 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ebf3067-fc1e-4482-8a4f-2909ff9c3b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6e1010>]}
[0m11:42:34.211658 [info ] [Thread-1 (]: 1 of 1 OK created sql view model analytics.stg_customers ....................... [[32mCREATE VIEW[0m in 0.07s]
[0m11:42:34.211945 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_customers
[0m11:42:34.212723 [debug] [MainThread]: Using postgres connection "master"
[0m11:42:34.212895 [debug] [MainThread]: On master: BEGIN
[0m11:42:34.213027 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:42:34.221800 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m11:42:34.222023 [debug] [MainThread]: On master: COMMIT
[0m11:42:34.222165 [debug] [MainThread]: Using postgres connection "master"
[0m11:42:34.222300 [debug] [MainThread]: On master: COMMIT
[0m11:42:34.222521 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:42:34.222653 [debug] [MainThread]: On master: Close
[0m11:42:34.222846 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:34.222969 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_customers' was properly closed.
[0m11:42:34.223109 [info ] [MainThread]: 
[0m11:42:34.223258 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m11:42:34.223583 [debug] [MainThread]: Command end result
[0m11:42:34.236783 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:42:34.238383 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:42:34.241808 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:42:34.242021 [info ] [MainThread]: 
[0m11:42:34.242234 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:42:34.242379 [info ] [MainThread]: 
[0m11:42:34.242533 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:42:34.245525 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8600597, "process_in_blocks": "0", "process_kernel_time": 0.325672, "process_mem_max_rss": "151863296", "process_out_blocks": "0", "process_user_time": 1.755104}
[0m11:42:34.245813 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:34.245765 after 0.86 seconds
[0m11:42:34.246050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3e64c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3d2170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3d2210>]}
[0m11:42:34.246316 [debug] [MainThread]: Flushing usage events
[0m11:42:34.873506 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:03:45.676965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11283e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1151fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1151fbc50>]}


============================== 12:03:45.680670 | c194baf3-5250-4e4b-bdb4-145caeddab42 ==============================
[0m12:03:45.680670 [info ] [MainThread]: Running with dbt=1.10.15
[0m12:03:45.681005 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'use_colors': 'True', 'fail_fast': 'False', 'empty': 'False', 'static_parser': 'True', 'invocation_command': 'dbt run --select stg_order_items stg_sellers stg_order_payments', 'use_experimental_parser': 'False', 'introspect': 'True', 'printer_width': '80', 'warn_error': 'None', 'cache_selected_only': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'debug': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'target_path': 'None', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs'}
[0m12:03:45.816711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e0a650>]}
[0m12:03:45.848248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11508fbd0>]}
[0m12:03:45.849201 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:03:45.905390 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m12:03:45.982143 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 0 files changed.
[0m12:03:45.982495 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/staging/stg_order_payments.sql
[0m12:03:45.982681 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/staging/stg_order_items.sql
[0m12:03:45.982840 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/staging/stg_sellers.sql
[0m12:03:46.102572 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ecom_analytics.marts
- models.ecom_analytics.intermediate
[0m12:03:46.109153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11613c650>]}
[0m12:03:46.145865 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m12:03:46.147792 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m12:03:46.171960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11588bb60>]}
[0m12:03:46.172266 [info ] [MainThread]: Found 7 models, 9 sources, 459 macros
[0m12:03:46.172457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11629a270>]}
[0m12:03:46.173438 [info ] [MainThread]: 
[0m12:03:46.173626 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:03:46.173829 [info ] [MainThread]: 
[0m12:03:46.174141 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:03:46.176134 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m12:03:46.251167 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m12:03:46.251447 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m12:03:46.251610 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:03:46.278229 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.027 seconds
[0m12:03:46.279127 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m12:03:46.280001 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m12:03:46.283094 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m12:03:46.283282 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m12:03:46.283415 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:03:46.292286 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m12:03:46.292496 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m12:03:46.292659 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m12:03:46.300431 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.008 seconds
[0m12:03:46.301180 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m12:03:46.301463 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m12:03:46.304115 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:46.304293 [debug] [MainThread]: On master: BEGIN
[0m12:03:46.304441 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:03:46.310393 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m12:03:46.310566 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:46.310761 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:03:46.318585 [debug] [MainThread]: SQL status: SELECT 4 in 0.008 seconds
[0m12:03:46.319276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1165cf860>]}
[0m12:03:46.319515 [debug] [MainThread]: On master: ROLLBACK
[0m12:03:46.319820 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:46.319957 [debug] [MainThread]: On master: BEGIN
[0m12:03:46.320450 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:03:46.320589 [debug] [MainThread]: On master: COMMIT
[0m12:03:46.320721 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:46.320856 [debug] [MainThread]: On master: COMMIT
[0m12:03:46.321151 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:03:46.321290 [debug] [MainThread]: On master: Close
[0m12:03:46.324053 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_order_items
[0m12:03:46.324372 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_order_items .......................... [RUN]
[0m12:03:46.324606 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_order_items)
[0m12:03:46.325266 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_order_items
[0m12:03:46.329435 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_order_items"
[0m12:03:46.330224 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_order_items
[0m12:03:46.348633 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.stg_order_items"
[0m12:03:46.349448 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_items"
[0m12:03:46.349699 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_items: BEGIN
[0m12:03:46.349867 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:03:46.362485 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m12:03:46.362692 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_items"
[0m12:03:46.362895 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_items: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_order_items"} */

  create view "ecommerce_db"."analytics"."stg_order_items__dbt_tmp"
    
    
  as (
    /*
    Staging model for order items table
    - Cleans and standardizes order line item data
    - Casts timestamp columns to proper types
    - Foundation for order-product-seller relationships
*/

SELECT
    -- Primary/Foreign keys
    order_id,
    order_item_id,
    product_id,
    seller_id,
    
    -- Business columns
    shipping_limit_date::timestamp AS shipping_limit_date,
    price,
    freight_value

FROM "ecommerce_db"."public"."order_items"
  );
[0m12:03:46.367815 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m12:03:46.371273 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_items"
[0m12:03:46.371477 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_items: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_order_items"} */
alter table "ecommerce_db"."analytics"."stg_order_items__dbt_tmp" rename to "stg_order_items"
[0m12:03:46.372124 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:03:46.379664 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_items: COMMIT
[0m12:03:46.379895 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_items"
[0m12:03:46.380063 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_items: COMMIT
[0m12:03:46.385987 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m12:03:46.389312 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."stg_order_items__dbt_backup"
[0m12:03:46.392028 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_items"
[0m12:03:46.392254 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_items: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_order_items"} */
drop view if exists "ecommerce_db"."analytics"."stg_order_items__dbt_backup" cascade
[0m12:03:46.392779 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m12:03:46.394055 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_items: Close
[0m12:03:46.395513 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116748dd0>]}
[0m12:03:46.395847 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_order_items ..................... [[32mCREATE VIEW[0m in 0.07s]
[0m12:03:46.396161 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_order_items
[0m12:03:46.396361 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_order_payments
[0m12:03:46.396573 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stg_order_payments ....................... [RUN]
[0m12:03:46.396776 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecom_analytics.stg_order_items, now model.ecom_analytics.stg_order_payments)
[0m12:03:46.396940 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_order_payments
[0m12:03:46.398170 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_order_payments"
[0m12:03:46.398669 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_order_payments
[0m12:03:46.400541 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.stg_order_payments"
[0m12:03:46.401027 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_payments"
[0m12:03:46.401190 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_payments: BEGIN
[0m12:03:46.401336 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:03:46.418130 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m12:03:46.418416 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_payments"
[0m12:03:46.418603 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_order_payments"} */

  create view "ecommerce_db"."analytics"."stg_order_payments__dbt_tmp"
    
    
  as (
    /*
    Staging model for order payments table
    - Cleans and standardizes payment method data
    - Foundation for financial analytics
*/

SELECT
    -- Foreign key
    order_id,
    
    -- Business columns
    payment_sequential,
    payment_type,
    payment_installments,
    payment_value

FROM "ecommerce_db"."public"."order_payments"
  );
[0m12:03:46.424002 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m12:03:46.425548 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_payments"
[0m12:03:46.425728 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_order_payments"} */
alter table "ecommerce_db"."analytics"."stg_order_payments__dbt_tmp" rename to "stg_order_payments"
[0m12:03:46.426313 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:03:46.426976 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_payments: COMMIT
[0m12:03:46.427168 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_payments"
[0m12:03:46.427329 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_payments: COMMIT
[0m12:03:46.428821 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:03:46.430094 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."stg_order_payments__dbt_backup"
[0m12:03:46.430455 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_order_payments"
[0m12:03:46.430627 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_order_payments"} */
drop view if exists "ecommerce_db"."analytics"."stg_order_payments__dbt_backup" cascade
[0m12:03:46.431047 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m12:03:46.431680 [debug] [Thread-1 (]: On model.ecom_analytics.stg_order_payments: Close
[0m12:03:46.431974 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116479de0>]}
[0m12:03:46.432382 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stg_order_payments .................. [[32mCREATE VIEW[0m in 0.04s]
[0m12:03:46.432697 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_order_payments
[0m12:03:46.432899 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_sellers
[0m12:03:46.433119 [info ] [Thread-1 (]: 3 of 3 START sql view model analytics.stg_sellers .............................. [RUN]
[0m12:03:46.433338 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.ecom_analytics.stg_order_payments, now model.ecom_analytics.stg_sellers)
[0m12:03:46.433556 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_sellers
[0m12:03:46.434903 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_sellers"
[0m12:03:46.435564 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_sellers
[0m12:03:46.437081 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.stg_sellers"
[0m12:03:46.437521 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_sellers"
[0m12:03:46.437686 [debug] [Thread-1 (]: On model.ecom_analytics.stg_sellers: BEGIN
[0m12:03:46.437849 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:03:46.444983 [debug] [Thread-1 (]: SQL status: BEGIN in 0.007 seconds
[0m12:03:46.445229 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_sellers"
[0m12:03:46.445400 [debug] [Thread-1 (]: On model.ecom_analytics.stg_sellers: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_sellers"} */

  create view "ecommerce_db"."analytics"."stg_sellers__dbt_tmp"
    
    
  as (
    /*
    Staging model for sellers table
    - Cleans and standardizes seller data
    - Foundation for marketplace seller analytics
*/

SELECT
    -- Primary key
    seller_id,
    
    -- Business columns
    seller_zip_code_prefix,
    seller_city,
    seller_state

FROM "ecommerce_db"."public"."sellers"
  );
[0m12:03:46.451643 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m12:03:46.455286 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_sellers"
[0m12:03:46.455497 [debug] [Thread-1 (]: On model.ecom_analytics.stg_sellers: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_sellers"} */
alter table "ecommerce_db"."analytics"."stg_sellers__dbt_tmp" rename to "stg_sellers"
[0m12:03:46.456134 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:03:46.456825 [debug] [Thread-1 (]: On model.ecom_analytics.stg_sellers: COMMIT
[0m12:03:46.457031 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_sellers"
[0m12:03:46.457239 [debug] [Thread-1 (]: On model.ecom_analytics.stg_sellers: COMMIT
[0m12:03:46.458409 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:03:46.459470 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."stg_sellers__dbt_backup"
[0m12:03:46.459824 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_sellers"
[0m12:03:46.459996 [debug] [Thread-1 (]: On model.ecom_analytics.stg_sellers: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_sellers"} */
drop view if exists "ecommerce_db"."analytics"."stg_sellers__dbt_backup" cascade
[0m12:03:46.460377 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m12:03:46.460987 [debug] [Thread-1 (]: On model.ecom_analytics.stg_sellers: Close
[0m12:03:46.461258 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c194baf3-5250-4e4b-bdb4-145caeddab42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1170c96d0>]}
[0m12:03:46.461571 [info ] [Thread-1 (]: 3 of 3 OK created sql view model analytics.stg_sellers ......................... [[32mCREATE VIEW[0m in 0.03s]
[0m12:03:46.461843 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_sellers
[0m12:03:46.462456 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:46.462643 [debug] [MainThread]: On master: BEGIN
[0m12:03:46.462790 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:03:46.471266 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m12:03:46.471475 [debug] [MainThread]: On master: COMMIT
[0m12:03:46.471618 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:46.471747 [debug] [MainThread]: On master: COMMIT
[0m12:03:46.471980 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:03:46.472114 [debug] [MainThread]: On master: Close
[0m12:03:46.472297 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:03:46.472426 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_sellers' was properly closed.
[0m12:03:46.472598 [info ] [MainThread]: 
[0m12:03:46.472751 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m12:03:46.473175 [debug] [MainThread]: Command end result
[0m12:03:46.550525 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m12:03:46.551793 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m12:03:46.554869 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m12:03:46.555044 [info ] [MainThread]: 
[0m12:03:46.555232 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:03:46.555372 [info ] [MainThread]: 
[0m12:03:46.555525 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m12:03:46.557417 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.94362015, "process_in_blocks": "0", "process_kernel_time": 0.290405, "process_mem_max_rss": "151748608", "process_out_blocks": "0", "process_user_time": 1.781893}
[0m12:03:46.557705 [debug] [MainThread]: Command `dbt run` succeeded at 12:03:46.557656 after 0.94 seconds
[0m12:03:46.557902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11232c950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112dc5c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045ae7b0>]}
[0m12:03:46.558077 [debug] [MainThread]: Flushing usage events
[0m12:03:47.299681 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:18:23.932179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122c92900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1258fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1258fbc50>]}


============================== 12:18:23.935872 | 81001a16-04e3-492a-aec3-9cb06eddac06 ==============================
[0m12:18:23.935872 [info ] [MainThread]: Running with dbt=1.10.15
[0m12:18:23.936228 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'warn_error': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'target_path': 'None', 'log_format': 'default', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'write_json': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'partial_parse': 'True', 'use_colors': 'True', 'debug': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run --select int_orders_joined', 'cache_selected_only': 'False', 'no_print': 'None', 'fail_fast': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'empty': 'False'}
[0m12:18:24.070626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '81001a16-04e3-492a-aec3-9cb06eddac06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123912650>]}
[0m12:18:24.102316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '81001a16-04e3-492a-aec3-9cb06eddac06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125693bd0>]}
[0m12:18:24.103292 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:18:24.161761 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m12:18:24.245023 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:18:24.245404 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/intermediate/int_orders_joined.sql
[0m12:18:24.371712 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ecom_analytics.marts
[0m12:18:24.378216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '81001a16-04e3-492a-aec3-9cb06eddac06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126840750>]}
[0m12:18:24.415895 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m12:18:24.417571 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m12:18:24.433782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '81001a16-04e3-492a-aec3-9cb06eddac06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125f97c50>]}
[0m12:18:24.434079 [info ] [MainThread]: Found 8 models, 9 sources, 459 macros
[0m12:18:24.434252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81001a16-04e3-492a-aec3-9cb06eddac06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1258ff3f0>]}
[0m12:18:24.435152 [info ] [MainThread]: 
[0m12:18:24.435343 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:18:24.435482 [info ] [MainThread]: 
[0m12:18:24.435763 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:18:24.436186 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m12:18:24.491077 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m12:18:24.491354 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m12:18:24.491517 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:18:24.696750 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.205 seconds
[0m12:18:24.698520 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m12:18:24.703271 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m12:18:24.708965 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m12:18:24.709339 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m12:18:24.709614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:18:24.718889 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m12:18:24.719086 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m12:18:24.719267 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m12:18:24.727797 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.008 seconds
[0m12:18:24.729108 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m12:18:24.729577 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m12:18:24.733649 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:24.733854 [debug] [MainThread]: On master: BEGIN
[0m12:18:24.734009 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:18:24.741797 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m12:18:24.742078 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:24.742391 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:18:24.750833 [debug] [MainThread]: SQL status: SELECT 7 in 0.008 seconds
[0m12:18:24.752191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81001a16-04e3-492a-aec3-9cb06eddac06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126e476c0>]}
[0m12:18:24.752609 [debug] [MainThread]: On master: ROLLBACK
[0m12:18:24.753087 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:24.753299 [debug] [MainThread]: On master: BEGIN
[0m12:18:24.753804 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:18:24.754007 [debug] [MainThread]: On master: COMMIT
[0m12:18:24.754194 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:24.754381 [debug] [MainThread]: On master: COMMIT
[0m12:18:24.754694 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:18:24.755114 [debug] [MainThread]: On master: Close
[0m12:18:24.758207 [debug] [Thread-1 (]: Began running node model.ecom_analytics.int_orders_joined
[0m12:18:24.758616 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics.int_orders_joined ........................ [RUN]
[0m12:18:24.758933 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.int_orders_joined)
[0m12:18:24.759196 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.int_orders_joined
[0m12:18:24.765847 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.int_orders_joined"
[0m12:18:24.766816 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.int_orders_joined
[0m12:18:24.790208 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.int_orders_joined"
[0m12:18:24.791251 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.int_orders_joined"
[0m12:18:24.791526 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: BEGIN
[0m12:18:24.791707 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:18:24.816463 [debug] [Thread-1 (]: SQL status: BEGIN in 0.025 seconds
[0m12:18:24.816743 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.int_orders_joined"
[0m12:18:24.817070 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.int_orders_joined"} */

  create view "ecommerce_db"."analytics"."int_orders_joined__dbt_tmp"
    
    
  as (
    /*
    Intermediate model joining core business entities
    - Combines orders, order items, customers, products, sellers, and category translations
    - Creates wide analytical dataset at order line item grain
    - Foundation for business analytics and reporting
    - Includes calculated fields for business insights
*/

WITH order_base AS (
    SELECT
        -- Order information
        order_id,
        customer_id,
        order_status,
        order_purchase_timestamp,
        order_approved_at,
        order_delivered_carrier_date,
        order_delivered_customer_date,
        order_estimated_delivery_date
    FROM "ecommerce_db"."analytics"."stg_orders"
),

order_items_base AS (
    SELECT
        order_id,
        order_item_id,
        product_id,
        seller_id,
        shipping_limit_date,
        price,
        freight_value
    FROM "ecommerce_db"."analytics"."stg_order_items"
),

customers_base AS (
    SELECT
        customer_id,
        customer_unique_id,
        customer_zip_code_prefix,
        customer_city,
        customer_state
    FROM "ecommerce_db"."analytics"."stg_customers"
),

products_base AS (
    SELECT
        product_id,
        product_category_name,
        product_name_lenght,
        product_description_lenght,
        product_photos_qty,
        product_weight_g,
        product_length_cm,
        product_height_cm,
        product_width_cm
    FROM "ecommerce_db"."analytics"."stg_products"
),

sellers_base AS (
    SELECT
        seller_id,
        seller_zip_code_prefix,
        seller_city,
        seller_state
    FROM "ecommerce_db"."analytics"."stg_sellers"
),

category_translation AS (
    SELECT
        product_category_name,
        product_category_name_english
    FROM "ecommerce_db"."analytics"."stg_product_category_name_translation"
)

SELECT
    -- Order identifiers
    oi.order_id,
    oi.order_item_id,
    
    -- Order details
    o.order_status,
    o.order_purchase_timestamp,
    o.order_approved_at,
    o.order_delivered_carrier_date,
    o.order_delivered_customer_date,
    o.order_estimated_delivery_date,
    
    -- Customer information
    o.customer_id,
    c.customer_unique_id,
    c.customer_city,
    c.customer_state,
    c.customer_zip_code_prefix,
    
    -- Product information
    oi.product_id,
    p.product_category_name,
    ct.product_category_name_english,
    p.product_weight_g,
    p.product_length_cm,
    p.product_height_cm,
    p.product_width_cm,
    p.product_photos_qty,
    
    -- Seller information
    oi.seller_id,
    s.seller_city,
    s.seller_state,
    s.seller_zip_code_prefix AS seller_zip_code_prefix,
    
    -- Financial information
    oi.price,
    oi.freight_value,
    oi.shipping_limit_date,
    
    -- Calculated fields
    (oi.price + oi.freight_value) AS total_item_value,
    
    CASE 
        WHEN o.order_delivered_customer_date IS NOT NULL 
             AND o.order_purchase_timestamp IS NOT NULL
        THEN EXTRACT(DAY FROM (o.order_delivered_customer_date - o.order_purchase_timestamp))
        ELSE NULL
    END AS delivery_days,
    
    CASE 
        WHEN o.order_delivered_customer_date > o.order_estimated_delivery_date
        THEN TRUE
        ELSE FALSE
    END AS is_late_delivery

FROM order_items_base oi
LEFT JOIN order_base o ON oi.order_id = o.order_id
LEFT JOIN customers_base c ON o.customer_id = c.customer_id
LEFT JOIN products_base p ON oi.product_id = p.product_id
LEFT JOIN category_translation ct ON p.product_category_name = ct.product_category_name
LEFT JOIN sellers_base s ON oi.seller_id = s.seller_id
  );
[0m12:18:24.870271 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.053 seconds
[0m12:18:24.875208 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.int_orders_joined"
[0m12:18:24.875556 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.int_orders_joined"} */
alter table "ecommerce_db"."analytics"."int_orders_joined__dbt_tmp" rename to "int_orders_joined"
[0m12:18:24.877758 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m12:18:24.888405 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: COMMIT
[0m12:18:24.888702 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.int_orders_joined"
[0m12:18:24.888916 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: COMMIT
[0m12:18:24.890469 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:18:24.894620 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."int_orders_joined__dbt_backup"
[0m12:18:24.897736 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.int_orders_joined"
[0m12:18:24.898000 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.int_orders_joined"} */
drop view if exists "ecommerce_db"."analytics"."int_orders_joined__dbt_backup" cascade
[0m12:18:24.898573 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m12:18:24.900104 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: Close
[0m12:18:24.901874 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '81001a16-04e3-492a-aec3-9cb06eddac06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126fece90>]}
[0m12:18:24.902267 [info ] [Thread-1 (]: 1 of 1 OK created sql view model analytics.int_orders_joined ................... [[32mCREATE VIEW[0m in 0.14s]
[0m12:18:24.902601 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.int_orders_joined
[0m12:18:24.903322 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:24.903543 [debug] [MainThread]: On master: BEGIN
[0m12:18:24.903709 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:18:24.913061 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m12:18:24.913365 [debug] [MainThread]: On master: COMMIT
[0m12:18:24.913562 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:24.913733 [debug] [MainThread]: On master: COMMIT
[0m12:18:24.914002 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:18:24.914196 [debug] [MainThread]: On master: Close
[0m12:18:24.914435 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:18:24.914599 [debug] [MainThread]: Connection 'model.ecom_analytics.int_orders_joined' was properly closed.
[0m12:18:24.914759 [info ] [MainThread]: 
[0m12:18:24.914931 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.48 seconds (0.48s).
[0m12:18:24.915275 [debug] [MainThread]: Command end result
[0m12:18:24.931127 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m12:18:24.932868 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m12:18:24.936417 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m12:18:24.936652 [info ] [MainThread]: 
[0m12:18:24.936867 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:18:24.937022 [info ] [MainThread]: 
[0m12:18:24.937190 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:18:24.939216 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.077467, "process_in_blocks": "0", "process_kernel_time": 0.317686, "process_mem_max_rss": "152993792", "process_out_blocks": "0", "process_user_time": 1.759745}
[0m12:18:24.939506 [debug] [MainThread]: Command `dbt run` succeeded at 12:18:24.939456 after 1.08 seconds
[0m12:18:24.939722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126b722b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126af2b70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126af2c10>]}
[0m12:18:24.939909 [debug] [MainThread]: Flushing usage events
[0m12:18:26.013281 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:19:28.737418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d3a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208fbc50>]}


============================== 12:19:28.743175 | f6cf5fd5-afd5-49d0-94d7-b52aafe2c12d ==============================
[0m12:19:28.743175 [info ] [MainThread]: Running with dbt=1.10.15
[0m12:19:28.743550 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'static_parser': 'True', 'use_colors': 'True', 'invocation_command': 'dbt show --select int_orders_joined --limit 5', 'version_check': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'fail_fast': 'False', 'empty': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'no_print': 'None', 'profiles_dir': '/Users/raramesh/.dbt', 'cache_selected_only': 'False', 'introspect': 'True', 'debug': 'False', 'partial_parse': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs'}
[0m12:19:28.878758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f6cf5fd5-afd5-49d0-94d7-b52aafe2c12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10700e650>]}
[0m12:19:28.910864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f6cf5fd5-afd5-49d0-94d7-b52aafe2c12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120793bd0>]}
[0m12:19:28.928993 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m12:19:28.987812 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m12:19:29.073251 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:19:29.073579 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:19:29.076563 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ecom_analytics.marts
[0m12:19:29.091228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f6cf5fd5-afd5-49d0-94d7-b52aafe2c12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121df4850>]}
[0m12:19:29.131536 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m12:19:29.133608 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m12:19:29.135569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6cf5fd5-afd5-49d0-94d7-b52aafe2c12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f87e30>]}
[0m12:19:29.135835 [info ] [MainThread]: Found 8 models, 9 sources, 459 macros
[0m12:19:29.136006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6cf5fd5-afd5-49d0-94d7-b52aafe2c12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121dd1010>]}
[0m12:19:29.136859 [info ] [MainThread]: 
[0m12:19:29.137053 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:19:29.137190 [info ] [MainThread]: 
[0m12:19:29.137455 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:19:29.139513 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m12:19:29.211518 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m12:19:29.211792 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m12:19:29.211950 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:19:29.240228 [debug] [ThreadPool]: SQL status: BEGIN in 0.028 seconds
[0m12:19:29.240500 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m12:19:29.240672 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m12:19:29.246691 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.006 seconds
[0m12:19:29.247499 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m12:19:29.247819 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m12:19:29.250929 [debug] [MainThread]: Using postgres connection "master"
[0m12:19:29.251106 [debug] [MainThread]: On master: BEGIN
[0m12:19:29.251243 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:19:29.258762 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m12:19:29.258981 [debug] [MainThread]: Using postgres connection "master"
[0m12:19:29.259190 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m12:19:29.266042 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m12:19:29.267274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6cf5fd5-afd5-49d0-94d7-b52aafe2c12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1222a4600>]}
[0m12:19:29.267509 [debug] [MainThread]: On master: ROLLBACK
[0m12:19:29.267814 [debug] [MainThread]: On master: Close
[0m12:19:29.276113 [debug] [Thread-1 (]: Began running node model.ecom_analytics.int_orders_joined
[0m12:19:29.276352 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.int_orders_joined)
[0m12:19:29.276536 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.int_orders_joined
[0m12:19:29.281804 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.int_orders_joined"
[0m12:19:29.282441 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.int_orders_joined
[0m12:19:29.286001 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.int_orders_joined"
[0m12:19:29.286307 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.int_orders_joined"} */

  
  /*
    Intermediate model joining core business entities
    - Combines orders, order items, customers, products, sellers, and category translations
    - Creates wide analytical dataset at order line item grain
    - Foundation for business analytics and reporting
    - Includes calculated fields for business insights
*/

WITH order_base AS (
    SELECT
        -- Order information
        order_id,
        customer_id,
        order_status,
        order_purchase_timestamp,
        order_approved_at,
        order_delivered_carrier_date,
        order_delivered_customer_date,
        order_estimated_delivery_date
    FROM "ecommerce_db"."analytics"."stg_orders"
),

order_items_base AS (
    SELECT
        order_id,
        order_item_id,
        product_id,
        seller_id,
        shipping_limit_date,
        price,
        freight_value
    FROM "ecommerce_db"."analytics"."stg_order_items"
),

customers_base AS (
    SELECT
        customer_id,
        customer_unique_id,
        customer_zip_code_prefix,
        customer_city,
        customer_state
    FROM "ecommerce_db"."analytics"."stg_customers"
),

products_base AS (
    SELECT
        product_id,
        product_category_name,
        product_name_lenght,
        product_description_lenght,
        product_photos_qty,
        product_weight_g,
        product_length_cm,
        product_height_cm,
        product_width_cm
    FROM "ecommerce_db"."analytics"."stg_products"
),

sellers_base AS (
    SELECT
        seller_id,
        seller_zip_code_prefix,
        seller_city,
        seller_state
    FROM "ecommerce_db"."analytics"."stg_sellers"
),

category_translation AS (
    SELECT
        product_category_name,
        product_category_name_english
    FROM "ecommerce_db"."analytics"."stg_product_category_name_translation"
)

SELECT
    -- Order identifiers
    oi.order_id,
    oi.order_item_id,
    
    -- Order details
    o.order_status,
    o.order_purchase_timestamp,
    o.order_approved_at,
    o.order_delivered_carrier_date,
    o.order_delivered_customer_date,
    o.order_estimated_delivery_date,
    
    -- Customer information
    o.customer_id,
    c.customer_unique_id,
    c.customer_city,
    c.customer_state,
    c.customer_zip_code_prefix,
    
    -- Product information
    oi.product_id,
    p.product_category_name,
    ct.product_category_name_english,
    p.product_weight_g,
    p.product_length_cm,
    p.product_height_cm,
    p.product_width_cm,
    p.product_photos_qty,
    
    -- Seller information
    oi.seller_id,
    s.seller_city,
    s.seller_state,
    s.seller_zip_code_prefix AS seller_zip_code_prefix,
    
    -- Financial information
    oi.price,
    oi.freight_value,
    oi.shipping_limit_date,
    
    -- Calculated fields
    (oi.price + oi.freight_value) AS total_item_value,
    
    CASE 
        WHEN o.order_delivered_customer_date IS NOT NULL 
             AND o.order_purchase_timestamp IS NOT NULL
        THEN EXTRACT(DAY FROM (o.order_delivered_customer_date - o.order_purchase_timestamp))
        ELSE NULL
    END AS delivery_days,
    
    CASE 
        WHEN o.order_delivered_customer_date > o.order_estimated_delivery_date
        THEN TRUE
        ELSE FALSE
    END AS is_late_delivery

FROM order_items_base oi
LEFT JOIN order_base o ON oi.order_id = o.order_id
LEFT JOIN customers_base c ON o.customer_id = c.customer_id
LEFT JOIN products_base p ON oi.product_id = p.product_id
LEFT JOIN category_translation ct ON p.product_category_name = ct.product_category_name
LEFT JOIN sellers_base s ON oi.seller_id = s.seller_id
  
  limit 5

[0m12:19:29.286567 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:19:29.416832 [debug] [Thread-1 (]: SQL status: SELECT 5 in 0.130 seconds
[0m12:19:29.418522 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: Close
[0m12:19:29.418938 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.int_orders_joined
[0m12:19:29.419517 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:19:29.419667 [debug] [MainThread]: Connection 'model.ecom_analytics.int_orders_joined' was properly closed.
[0m12:19:29.419997 [debug] [MainThread]: Command end result
[0m12:19:29.435334 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m12:19:29.436992 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m12:19:29.441630 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m12:19:29.441998 [info ] [MainThread]: Previewing node 'int_orders_joined':
| order_id             | order_item_id | order_status | order_purchase_ti... |   order_approved_at | order_delivered_c... | ... |
| -------------------- | ------------- | ------------ | -------------------- | ------------------- | -------------------- | --- |
| 0014ae671de39511f... |             1 | delivered    |  2017-05-22 13:49:03 | 2017-05-23 03:15:24 |  2017-05-29 09:04:02 | ... |
| 008819c6d5f6da6fa... |             1 | delivered    |  2018-08-04 21:40:35 | 2018-08-04 21:50:11 |  2018-08-06 13:34:00 | ... |
| 00975e709cd12c34d... |             1 | delivered    |  2017-08-21 12:54:37 | 2017-08-21 13:05:16 |  2017-08-21 19:07:09 | ... |
| 0097f0545a302aafa... |             2 | delivered    |  2018-03-05 18:15:11 | 2018-03-05 18:30:41 |  2018-03-06 22:04:03 | ... |
| 00a250dbdb3153cc6... |             1 | delivered    |  2017-12-10 18:07:24 | 2017-12-10 18:15:33 |  2017-12-12 21:07:48 | ... |

[0m12:19:29.444229 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 0.76175904, "process_in_blocks": "0", "process_kernel_time": 0.255526, "process_mem_max_rss": "148078592", "process_out_blocks": "0", "process_user_time": 1.558433}
[0m12:19:29.444512 [debug] [MainThread]: Command `dbt show` succeeded at 12:19:29.444464 after 0.76 seconds
[0m12:19:29.444746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208ec590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121eee2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121eee150>]}
[0m12:19:29.444947 [debug] [MainThread]: Flushing usage events
[0m12:19:29.917169 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:45:09.948906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1138aa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114fffd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114fffc50>]}


============================== 13:45:09.955171 | 07be1add-8b84-4b3c-a40c-767054ac2f68 ==============================
[0m13:45:09.955171 [info ] [MainThread]: Running with dbt=1.10.15
[0m13:45:09.955533 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'introspect': 'True', 'write_json': 'True', 'quiet': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'log_format': 'default', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select mart_monthly_sales_summary', 'cache_selected_only': 'False', 'fail_fast': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'printer_width': '80'}
[0m13:45:10.122950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07be1add-8b84-4b3c-a40c-767054ac2f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f0a650>]}
[0m13:45:10.156137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07be1add-8b84-4b3c-a40c-767054ac2f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e97bd0>]}
[0m13:45:10.157154 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:45:10.217525 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m13:45:10.328087 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m13:45:10.328552 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/marts/mart_monthly_sales_summary.sql
[0m13:45:10.460551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07be1add-8b84-4b3c-a40c-767054ac2f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1160bdc50>]}
[0m13:45:10.497168 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:45:10.498939 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:45:10.533719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07be1add-8b84-4b3c-a40c-767054ac2f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1155a3b60>]}
[0m13:45:10.534026 [info ] [MainThread]: Found 9 models, 9 sources, 459 macros
[0m13:45:10.534207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07be1add-8b84-4b3c-a40c-767054ac2f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1162d8bb0>]}
[0m13:45:10.535092 [info ] [MainThread]: 
[0m13:45:10.535269 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:45:10.535402 [info ] [MainThread]: 
[0m13:45:10.535673 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:45:10.536206 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m13:45:10.624644 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m13:45:10.624989 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m13:45:10.625153 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:45:10.655020 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.030 seconds
[0m13:45:10.655877 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m13:45:10.658737 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m13:45:10.662167 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:45:10.662407 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m13:45:10.662546 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:45:10.671796 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m13:45:10.672114 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:45:10.672330 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m13:45:10.680276 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.008 seconds
[0m13:45:10.681264 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m13:45:10.683549 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m13:45:10.686729 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:10.686942 [debug] [MainThread]: On master: BEGIN
[0m13:45:10.687081 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:45:10.695783 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m13:45:10.695989 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:10.696182 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:45:10.709534 [debug] [MainThread]: SQL status: SELECT 13 in 0.013 seconds
[0m13:45:10.711074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07be1add-8b84-4b3c-a40c-767054ac2f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11674bad0>]}
[0m13:45:10.711328 [debug] [MainThread]: On master: ROLLBACK
[0m13:45:10.711687 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:10.711828 [debug] [MainThread]: On master: BEGIN
[0m13:45:10.712210 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:45:10.712353 [debug] [MainThread]: On master: COMMIT
[0m13:45:10.712479 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:10.712604 [debug] [MainThread]: On master: COMMIT
[0m13:45:10.712830 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:45:10.712964 [debug] [MainThread]: On master: Close
[0m13:45:10.720517 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:10.720843 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_monthly_sales_summary .............. [RUN]
[0m13:45:10.721091 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_monthly_sales_summary)
[0m13:45:10.721278 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:10.725692 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:10.726610 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:10.746178 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:10.747212 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:10.747468 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: BEGIN
[0m13:45:10.747635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:45:10.760431 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m13:45:10.760801 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:10.761115 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_monthly_sales_summary"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_monthly_sales_summary__dbt_tmp"
  
  
    as
  
  (
    /*
    Monthly Sales Summary Mart
    
    Business Purpose:
    - Track monthly revenue trends and growth
    - Monitor order volume patterns
    - Identify seasonal trends
    - Executive dashboard ready
    
    Grain: One row per month
    
    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Customer count
    - Growth rates
*/



WITH monthly_base AS (
    SELECT
        -- Time dimension
        DATE_TRUNC('month', order_purchase_timestamp) AS order_month,
        
        -- Aggregated metrics
        COUNT(DISTINCT order_id) AS total_orders,
        COUNT(DISTINCT customer_id) AS unique_customers,
        SUM(total_item_value) AS total_revenue,
        SUM(price) AS total_product_revenue,
        SUM(freight_value) AS total_shipping_revenue,
        
        -- Calculate averages
        AVG(total_item_value) AS avg_order_value,
        COUNT(*) AS total_order_items
        
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    WHERE order_purchase_timestamp IS NOT NULL
    GROUP BY DATE_TRUNC('month', order_purchase_timestamp)
),

monthly_with_growth AS (
    SELECT 
        order_month,
        total_orders,
        unique_customers,
        total_revenue,
        total_product_revenue,
        total_shipping_revenue,
        avg_order_value,
        total_order_items,
        
        -- Calculate items per order
        ROUND(total_order_items::NUMERIC / total_orders, 2) AS avg_items_per_order,
        
        -- Calculate revenue per customer
        ROUND(total_revenue / unique_customers, 2) AS revenue_per_customer,
        
        -- Month-over-month growth calculations
        LAG(total_revenue) OVER (ORDER BY order_month) AS prev_month_revenue,
        LAG(total_orders) OVER (ORDER BY order_month) AS prev_month_orders,
        
        -- Calculate growth rates
        CASE 
            WHEN LAG(total_revenue) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_revenue - LAG(total_revenue) OVER (ORDER BY order_month)) / 
                 LAG(total_revenue) OVER (ORDER BY order_month)) * 100, 2
            )
            ELSE NULL
        END AS revenue_growth_rate,
        
        CASE 
            WHEN LAG(total_orders) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_orders - LAG(total_orders) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_orders) OVER (ORDER BY order_month)) * 100, 2
            )
            ELSE NULL
        END AS order_growth_rate
        
    FROM monthly_base
)

SELECT 
    order_month,
    total_orders,
    unique_customers,
    total_revenue,
    total_product_revenue,
    total_shipping_revenue,
    avg_order_value,
    total_order_items,
    avg_items_per_order,
    revenue_per_customer,
    prev_month_revenue,
    prev_month_orders,
    revenue_growth_rate,
    order_growth_rate,
    
    -- Add business insights flags
    CASE 
        WHEN revenue_growth_rate > 10 THEN 'High Growth'
        WHEN revenue_growth_rate > 0 THEN 'Growing'
        WHEN revenue_growth_rate = 0 THEN 'Flat'
        WHEN revenue_growth_rate < 0 THEN 'Declining'
        ELSE 'No Prior Data'
    END AS growth_category

FROM monthly_with_growth
ORDER BY order_month
  );
  
[0m13:45:10.772645 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function round(double precision, integer) does not exist
LINE 69:         ROUND(total_revenue / unique_customers, 2) AS revenu...
                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m13:45:10.772896 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: ROLLBACK
[0m13:45:10.773256 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: Close
[0m13:45:10.780143 [debug] [Thread-1 (]: Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 69:         ROUND(total_revenue / unique_customers, 2) AS revenu...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:10.781408 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07be1add-8b84-4b3c-a40c-767054ac2f68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1175a87d0>]}
[0m13:45:10.781888 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_monthly_sales_summary ..... [[31mERROR[0m in 0.06s]
[0m13:45:10.782232 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:10.782565 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_monthly_sales_summary' to be skipped because of status 'error'.  Reason: Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 69:         ROUND(total_revenue / unique_customers, 2) AS revenu...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql.
[0m13:45:10.783619 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:10.783796 [debug] [MainThread]: On master: BEGIN
[0m13:45:10.783934 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:45:10.791060 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m13:45:10.791326 [debug] [MainThread]: On master: COMMIT
[0m13:45:10.791487 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:10.791628 [debug] [MainThread]: On master: COMMIT
[0m13:45:10.791908 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:45:10.792113 [debug] [MainThread]: On master: Close
[0m13:45:10.792470 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:45:10.792668 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_monthly_sales_summary' was properly closed.
[0m13:45:10.792826 [info ] [MainThread]: 
[0m13:45:10.792990 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m13:45:10.793345 [debug] [MainThread]: Command end result
[0m13:45:10.806465 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:45:10.807905 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:45:10.811247 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m13:45:10.811466 [info ] [MainThread]: 
[0m13:45:10.811673 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:45:10.811828 [info ] [MainThread]: 
[0m13:45:10.812013 [error] [MainThread]: [31mFailure in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)[0m
[0m13:45:10.812198 [error] [MainThread]:   Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 69:         ROUND(total_revenue / unique_customers, 2) AS revenu...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:10.812341 [info ] [MainThread]: 
[0m13:45:10.812497 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:10.812628 [info ] [MainThread]: 
[0m13:45:10.812779 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m13:45:10.814944 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9278207, "process_in_blocks": "0", "process_kernel_time": 0.352394, "process_mem_max_rss": "151502848", "process_out_blocks": "0", "process_user_time": 1.762557}
[0m13:45:10.815313 [debug] [MainThread]: Command `dbt run` failed at 13:45:10.815256 after 0.93 seconds
[0m13:45:10.815614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1163f5e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117637570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117636df0>]}
[0m13:45:10.815872 [debug] [MainThread]: Flushing usage events
[0m13:45:11.543043 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:45:21.447670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118df2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b1ffd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b1ffc50>]}


============================== 13:45:21.452217 | 0a47a9c8-d545-4dd7-87fc-30a89b4d69ae ==============================
[0m13:45:21.452217 [info ] [MainThread]: Running with dbt=1.10.15
[0m13:45:21.452690 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'write_json': 'True', 'log_format': 'default', 'profiles_dir': '/Users/raramesh/.dbt', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'target_path': 'None', 'version_check': 'True', 'partial_parse': 'True', 'empty': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select mart_monthly_sales_summary', 'no_print': 'None', 'quiet': 'False', 'introspect': 'True', 'printer_width': '80', 'debug': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager'}
[0m13:45:21.574130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a47a9c8-d545-4dd7-87fc-30a89b4d69ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11990a650>]}
[0m13:45:21.605466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0a47a9c8-d545-4dd7-87fc-30a89b4d69ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a797bd0>]}
[0m13:45:21.608251 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:45:21.665083 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m13:45:21.740674 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:45:21.740958 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:45:21.757643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0a47a9c8-d545-4dd7-87fc-30a89b4d69ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c3c0c50>]}
[0m13:45:21.792838 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:45:21.794287 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:45:21.814268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0a47a9c8-d545-4dd7-87fc-30a89b4d69ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b80fe30>]}
[0m13:45:21.814532 [info ] [MainThread]: Found 9 models, 9 sources, 459 macros
[0m13:45:21.814710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a47a9c8-d545-4dd7-87fc-30a89b4d69ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5165f0>]}
[0m13:45:21.815598 [info ] [MainThread]: 
[0m13:45:21.815775 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:45:21.815907 [info ] [MainThread]: 
[0m13:45:21.816154 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:45:21.816564 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m13:45:21.869334 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m13:45:21.869591 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m13:45:21.869744 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:45:21.896009 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.026 seconds
[0m13:45:21.896868 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m13:45:21.899217 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m13:45:21.902039 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:45:21.902227 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m13:45:21.902422 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:45:21.912715 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m13:45:21.912902 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:45:21.913059 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m13:45:21.919177 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.006 seconds
[0m13:45:21.919905 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m13:45:21.920162 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m13:45:21.923015 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:21.923190 [debug] [MainThread]: On master: BEGIN
[0m13:45:21.923328 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:45:21.931610 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m13:45:21.931789 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:21.931980 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:45:21.938338 [debug] [MainThread]: SQL status: SELECT 13 in 0.006 seconds
[0m13:45:21.939602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a47a9c8-d545-4dd7-87fc-30a89b4d69ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d170a10>]}
[0m13:45:21.939848 [debug] [MainThread]: On master: ROLLBACK
[0m13:45:21.940150 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:21.940295 [debug] [MainThread]: On master: BEGIN
[0m13:45:21.940770 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:45:21.940935 [debug] [MainThread]: On master: COMMIT
[0m13:45:21.941071 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:21.941203 [debug] [MainThread]: On master: COMMIT
[0m13:45:21.941468 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:45:21.941611 [debug] [MainThread]: On master: Close
[0m13:45:21.945471 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:21.945781 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_monthly_sales_summary .............. [RUN]
[0m13:45:21.946020 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_monthly_sales_summary)
[0m13:45:21.946203 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:21.950553 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:21.951161 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:21.972032 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:21.972764 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:21.972945 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: BEGIN
[0m13:45:21.973103 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:45:21.991246 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m13:45:21.991494 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:21.991787 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_monthly_sales_summary"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_monthly_sales_summary__dbt_tmp"
  
  
    as
  
  (
    /*
    Monthly Sales Summary Mart
    
    Business Purpose:
    - Track monthly revenue trends and growth
    - Monitor order volume patterns
    - Identify seasonal trends
    - Executive dashboard ready
    
    Grain: One row per month
    
    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Customer count
    - Growth rates
*/



WITH monthly_base AS (
    SELECT
        -- Time dimension
        DATE_TRUNC('month', order_purchase_timestamp) AS order_month,
        
        -- Aggregated metrics
        COUNT(DISTINCT order_id) AS total_orders,
        COUNT(DISTINCT customer_id) AS unique_customers,
        SUM(total_item_value) AS total_revenue,
        SUM(price) AS total_product_revenue,
        SUM(freight_value) AS total_shipping_revenue,
        
        -- Calculate averages
        AVG(total_item_value) AS avg_order_value,
        COUNT(*) AS total_order_items
        
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    WHERE order_purchase_timestamp IS NOT NULL
    GROUP BY DATE_TRUNC('month', order_purchase_timestamp)
),

monthly_with_growth AS (
    SELECT 
        order_month,
        total_orders,
        unique_customers,
        total_revenue,
        total_product_revenue,
        total_shipping_revenue,
        avg_order_value,
        total_order_items,
        
        -- Calculate items per order
        ROUND(total_order_items::NUMERIC / total_orders, 2) AS avg_items_per_order,
        
        -- Calculate revenue per customer
        ROUND(total_revenue / unique_customers, 2) AS revenue_per_customer,
        
        -- Month-over-month growth calculations
        LAG(total_revenue) OVER (ORDER BY order_month) AS prev_month_revenue,
        LAG(total_orders) OVER (ORDER BY order_month) AS prev_month_orders,
        
        -- Calculate growth rates
        CASE 
            WHEN LAG(total_revenue) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_revenue - LAG(total_revenue) OVER (ORDER BY order_month)) / 
                 LAG(total_revenue) OVER (ORDER BY order_month)) * 100, 2
            )
            ELSE NULL
        END AS revenue_growth_rate,
        
        CASE 
            WHEN LAG(total_orders) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_orders - LAG(total_orders) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_orders) OVER (ORDER BY order_month)) * 100, 2
            )
            ELSE NULL
        END AS order_growth_rate
        
    FROM monthly_base
)

SELECT 
    order_month,
    total_orders,
    unique_customers,
    total_revenue,
    total_product_revenue,
    total_shipping_revenue,
    avg_order_value,
    total_order_items,
    avg_items_per_order,
    revenue_per_customer,
    prev_month_revenue,
    prev_month_orders,
    revenue_growth_rate,
    order_growth_rate,
    
    -- Add business insights flags
    CASE 
        WHEN revenue_growth_rate > 10 THEN 'High Growth'
        WHEN revenue_growth_rate > 0 THEN 'Growing'
        WHEN revenue_growth_rate = 0 THEN 'Flat'
        WHEN revenue_growth_rate < 0 THEN 'Declining'
        ELSE 'No Prior Data'
    END AS growth_category

FROM monthly_with_growth
ORDER BY order_month
  );
  
[0m13:45:21.994877 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function round(double precision, integer) does not exist
LINE 69:         ROUND(total_revenue / unique_customers, 2) AS revenu...
                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m13:45:21.995085 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: ROLLBACK
[0m13:45:21.995421 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: Close
[0m13:45:22.005732 [debug] [Thread-1 (]: Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 69:         ROUND(total_revenue / unique_customers, 2) AS revenu...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:22.007678 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a47a9c8-d545-4dd7-87fc-30a89b4d69ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c53ff50>]}
[0m13:45:22.008066 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_monthly_sales_summary ..... [[31mERROR[0m in 0.06s]
[0m13:45:22.008394 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:22.008660 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_monthly_sales_summary' to be skipped because of status 'error'.  Reason: Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 69:         ROUND(total_revenue / unique_customers, 2) AS revenu...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql.
[0m13:45:22.009618 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:22.009782 [debug] [MainThread]: On master: BEGIN
[0m13:45:22.009920 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:45:22.021377 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m13:45:22.021652 [debug] [MainThread]: On master: COMMIT
[0m13:45:22.021826 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:22.021982 [debug] [MainThread]: On master: COMMIT
[0m13:45:22.022419 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:45:22.022717 [debug] [MainThread]: On master: Close
[0m13:45:22.022967 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:45:22.023116 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_monthly_sales_summary' was properly closed.
[0m13:45:22.023270 [info ] [MainThread]: 
[0m13:45:22.023438 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m13:45:22.023784 [debug] [MainThread]: Command end result
[0m13:45:22.036420 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:45:22.037822 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:45:22.041322 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m13:45:22.041525 [info ] [MainThread]: 
[0m13:45:22.041722 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:45:22.041873 [info ] [MainThread]: 
[0m13:45:22.042067 [error] [MainThread]: [31mFailure in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)[0m
[0m13:45:22.042249 [error] [MainThread]:   Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 69:         ROUND(total_revenue / unique_customers, 2) AS revenu...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:22.042416 [info ] [MainThread]: 
[0m13:45:22.042575 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:22.042709 [info ] [MainThread]: 
[0m13:45:22.042876 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m13:45:22.044722 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.64318013, "process_in_blocks": "0", "process_kernel_time": 0.242436, "process_mem_max_rss": "148881408", "process_out_blocks": "0", "process_user_time": 1.583554}
[0m13:45:22.044996 [debug] [MainThread]: Command `dbt run` failed at 13:45:22.044952 after 0.64 seconds
[0m13:45:22.045203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d08de90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d1a36b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d1a2f30>]}
[0m13:45:22.045380 [debug] [MainThread]: Flushing usage events
[0m13:45:22.604605 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:45:48.645674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b32900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110efbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110efbc50>]}


============================== 13:45:48.649452 | 097c0e8f-1513-460d-be0b-49c733b97a4e ==============================
[0m13:45:48.649452 [info ] [MainThread]: Running with dbt=1.10.15
[0m13:45:48.649888 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run --select mart_monthly_sales_summary', 'write_json': 'True', 'warn_error': 'None', 'printer_width': '80', 'indirect_selection': 'eager', 'target_path': 'None', 'empty': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'static_parser': 'True', 'use_colors': 'True', 'debug': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:45:48.772929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '097c0e8f-1513-460d-be0b-49c733b97a4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11000e650>]}
[0m13:45:48.805401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '097c0e8f-1513-460d-be0b-49c733b97a4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d93bd0>]}
[0m13:45:48.806547 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:45:48.866027 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m13:45:49.012666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:45:49.013150 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_monthly_sales_summary.sql
[0m13:45:49.141977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '097c0e8f-1513-460d-be0b-49c733b97a4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ff0a50>]}
[0m13:45:49.177932 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:45:49.184169 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:45:49.206529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '097c0e8f-1513-460d-be0b-49c733b97a4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ce7b60>]}
[0m13:45:49.206821 [info ] [MainThread]: Found 9 models, 9 sources, 459 macros
[0m13:45:49.206993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '097c0e8f-1513-460d-be0b-49c733b97a4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eff3f0>]}
[0m13:45:49.207859 [info ] [MainThread]: 
[0m13:45:49.208034 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:45:49.208159 [info ] [MainThread]: 
[0m13:45:49.208388 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:45:49.208774 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m13:45:49.273108 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m13:45:49.273397 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m13:45:49.273560 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:45:49.304611 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.031 seconds
[0m13:45:49.305577 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m13:45:49.308310 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m13:45:49.311498 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:45:49.311716 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m13:45:49.311859 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:45:49.322667 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m13:45:49.322974 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:45:49.323159 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m13:45:49.327817 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.004 seconds
[0m13:45:49.328667 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m13:45:49.329116 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m13:45:49.332350 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:49.332582 [debug] [MainThread]: On master: BEGIN
[0m13:45:49.332724 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:45:49.341325 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m13:45:49.341594 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:49.341797 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:45:49.348856 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m13:45:49.350357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '097c0e8f-1513-460d-be0b-49c733b97a4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11274bad0>]}
[0m13:45:49.350606 [debug] [MainThread]: On master: ROLLBACK
[0m13:45:49.351030 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:49.351259 [debug] [MainThread]: On master: BEGIN
[0m13:45:49.353519 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m13:45:49.353701 [debug] [MainThread]: On master: COMMIT
[0m13:45:49.353865 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:49.353995 [debug] [MainThread]: On master: COMMIT
[0m13:45:49.354221 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:45:49.354376 [debug] [MainThread]: On master: Close
[0m13:45:49.356900 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:49.357330 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_monthly_sales_summary .............. [RUN]
[0m13:45:49.357625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_monthly_sales_summary)
[0m13:45:49.357829 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:49.362339 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:49.363328 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:49.383363 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:49.384205 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:49.384470 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: BEGIN
[0m13:45:49.384654 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:45:49.390831 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m13:45:49.391096 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:45:49.391360 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_monthly_sales_summary"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_monthly_sales_summary__dbt_tmp"
  
  
    as
  
  (
    /*
    Monthly Sales Summary Mart
    
    Business Purpose:
    - Track monthly revenue trends and growth
    - Monitor order volume patterns
    - Identify seasonal trends
    - Executive dashboard ready
    
    Grain: One row per month
    
    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Customer count
    - Growth rates
*/



WITH monthly_base AS (
    SELECT
        -- Time dimension
        DATE_TRUNC('month', order_purchase_timestamp) AS order_month,
        
        -- Aggregated metrics
        COUNT(DISTINCT order_id) AS total_orders,
        COUNT(DISTINCT customer_id) AS unique_customers,
        SUM(total_item_value) AS total_revenue,
        SUM(price) AS total_product_revenue,
        SUM(freight_value) AS total_shipping_revenue,
        
        -- Calculate averages
        AVG(total_item_value) AS avg_order_value,
        COUNT(*) AS total_order_items
        
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    WHERE order_purchase_timestamp IS NOT NULL
    GROUP BY DATE_TRUNC('month', order_purchase_timestamp)
),

monthly_with_growth AS (
    SELECT 
        order_month,
        total_orders,
        unique_customers,
        total_revenue,
        total_product_revenue,
        total_shipping_revenue,
        avg_order_value,
        total_order_items,
        
        -- Calculate items per order
        ROUND(total_order_items::NUMERIC / total_orders, 2) AS avg_items_per_order,
        
        -- Calculate revenue per customer
        ROUND(total_revenue::NUMERIC / unique_customers, 2) AS revenue_per_customer,
        
        -- Month-over-month growth calculations
        LAG(total_revenue) OVER (ORDER BY order_month) AS prev_month_revenue,
        LAG(total_orders) OVER (ORDER BY order_month) AS prev_month_orders,
        
        -- Calculate growth rates
        CASE 
            WHEN LAG(total_revenue) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_revenue - LAG(total_revenue) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_revenue) OVER (ORDER BY order_month)) * 100, 2
            )
            ELSE NULL
        END AS revenue_growth_rate,
        
        CASE 
            WHEN LAG(total_orders) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_orders - LAG(total_orders) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_orders) OVER (ORDER BY order_month)) * 100, 2
            )
            ELSE NULL
        END AS order_growth_rate
        
    FROM monthly_base
)

SELECT 
    order_month,
    total_orders,
    unique_customers,
    total_revenue,
    total_product_revenue,
    total_shipping_revenue,
    avg_order_value,
    total_order_items,
    avg_items_per_order,
    revenue_per_customer,
    prev_month_revenue,
    prev_month_orders,
    revenue_growth_rate,
    order_growth_rate,
    
    -- Add business insights flags
    CASE 
        WHEN revenue_growth_rate > 10 THEN 'High Growth'
        WHEN revenue_growth_rate > 0 THEN 'Growing'
        WHEN revenue_growth_rate = 0 THEN 'Flat'
        WHEN revenue_growth_rate < 0 THEN 'Declining'
        ELSE 'No Prior Data'
    END AS growth_category

FROM monthly_with_growth
ORDER BY order_month
  );
  
[0m13:45:49.397203 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function round(double precision, integer) does not exist
LINE 78:             THEN ROUND(
                          ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m13:45:49.397476 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: ROLLBACK
[0m13:45:49.397844 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: Close
[0m13:45:49.407723 [debug] [Thread-1 (]: Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 78:             THEN ROUND(
                            ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:49.409129 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '097c0e8f-1513-460d-be0b-49c733b97a4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128f0710>]}
[0m13:45:49.409532 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_monthly_sales_summary ..... [[31mERROR[0m in 0.05s]
[0m13:45:49.409863 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:45:49.410158 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_monthly_sales_summary' to be skipped because of status 'error'.  Reason: Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 78:             THEN ROUND(
                            ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql.
[0m13:45:49.411210 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:49.411413 [debug] [MainThread]: On master: BEGIN
[0m13:45:49.411561 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:45:49.421988 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m13:45:49.422240 [debug] [MainThread]: On master: COMMIT
[0m13:45:49.422392 [debug] [MainThread]: Using postgres connection "master"
[0m13:45:49.422525 [debug] [MainThread]: On master: COMMIT
[0m13:45:49.422921 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:45:49.423139 [debug] [MainThread]: On master: Close
[0m13:45:49.423544 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:45:49.423757 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_monthly_sales_summary' was properly closed.
[0m13:45:49.423912 [info ] [MainThread]: 
[0m13:45:49.424067 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m13:45:49.424390 [debug] [MainThread]: Command end result
[0m13:45:49.436978 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:45:49.438488 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:45:49.442006 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m13:45:49.442222 [info ] [MainThread]: 
[0m13:45:49.442427 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:45:49.442596 [info ] [MainThread]: 
[0m13:45:49.442802 [error] [MainThread]: [31mFailure in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)[0m
[0m13:45:49.443015 [error] [MainThread]:   Database Error in model mart_monthly_sales_summary (models/marts/mart_monthly_sales_summary.sql)
  function round(double precision, integer) does not exist
  LINE 78:             THEN ROUND(
                            ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:49.443215 [info ] [MainThread]: 
[0m13:45:49.443421 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_monthly_sales_summary.sql
[0m13:45:49.443565 [info ] [MainThread]: 
[0m13:45:49.443737 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m13:45:49.445896 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8625364, "process_in_blocks": "0", "process_kernel_time": 0.30413, "process_mem_max_rss": "155140096", "process_out_blocks": "0", "process_user_time": 1.768522}
[0m13:45:49.446160 [debug] [MainThread]: Command `dbt run` failed at 13:45:49.446116 after 0.86 seconds
[0m13:45:49.446375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125fa200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11296cf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11296edf0>]}
[0m13:45:49.446579 [debug] [MainThread]: Flushing usage events
[0m13:45:50.034463 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:46:20.655296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10542e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068f7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068f7c50>]}


============================== 13:46:20.658914 | 4f04628b-8d41-48a1-992d-0fecbeaae725 ==============================
[0m13:46:20.658914 [info ] [MainThread]: Running with dbt=1.10.15
[0m13:46:20.659302 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run --select mart_monthly_sales_summary', 'empty': 'False', 'use_colors': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'target_path': 'None', 'write_json': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'printer_width': '80', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'log_cache_events': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'version_check': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'introspect': 'True'}
[0m13:46:20.788451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f04628b-8d41-48a1-992d-0fecbeaae725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10590a650>]}
[0m13:46:20.820891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f04628b-8d41-48a1-992d-0fecbeaae725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106793bd0>]}
[0m13:46:20.821993 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:46:20.887490 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m13:46:20.979342 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:46:20.979759 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_monthly_sales_summary.sql
[0m13:46:21.100757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f04628b-8d41-48a1-992d-0fecbeaae725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10824ca50>]}
[0m13:46:21.137074 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:46:21.138915 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:46:21.166322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f04628b-8d41-48a1-992d-0fecbeaae725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078bbb60>]}
[0m13:46:21.166619 [info ] [MainThread]: Found 9 models, 9 sources, 459 macros
[0m13:46:21.166801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f04628b-8d41-48a1-992d-0fecbeaae725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068ff3f0>]}
[0m13:46:21.167678 [info ] [MainThread]: 
[0m13:46:21.167879 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:46:21.168019 [info ] [MainThread]: 
[0m13:46:21.168282 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:46:21.168697 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m13:46:21.244431 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m13:46:21.244710 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m13:46:21.244867 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:46:21.273398 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.028 seconds
[0m13:46:21.274270 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m13:46:21.276694 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m13:46:21.279612 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:46:21.279796 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m13:46:21.279936 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:46:21.288354 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m13:46:21.288556 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:46:21.288714 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m13:46:21.293894 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.005 seconds
[0m13:46:21.294638 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m13:46:21.295090 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m13:46:21.298014 [debug] [MainThread]: Using postgres connection "master"
[0m13:46:21.298199 [debug] [MainThread]: On master: BEGIN
[0m13:46:21.298333 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:46:21.308679 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m13:46:21.308886 [debug] [MainThread]: Using postgres connection "master"
[0m13:46:21.309084 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:46:21.315694 [debug] [MainThread]: SQL status: SELECT 13 in 0.006 seconds
[0m13:46:21.317023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f04628b-8d41-48a1-992d-0fecbeaae725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108847ad0>]}
[0m13:46:21.317263 [debug] [MainThread]: On master: ROLLBACK
[0m13:46:21.317559 [debug] [MainThread]: Using postgres connection "master"
[0m13:46:21.317697 [debug] [MainThread]: On master: BEGIN
[0m13:46:21.318966 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m13:46:21.319103 [debug] [MainThread]: On master: COMMIT
[0m13:46:21.319230 [debug] [MainThread]: Using postgres connection "master"
[0m13:46:21.319353 [debug] [MainThread]: On master: COMMIT
[0m13:46:21.319650 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:46:21.319792 [debug] [MainThread]: On master: Close
[0m13:46:21.322795 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:46:21.323254 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_monthly_sales_summary .............. [RUN]
[0m13:46:21.323515 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_monthly_sales_summary)
[0m13:46:21.323706 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_monthly_sales_summary
[0m13:46:21.328100 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:21.328720 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_monthly_sales_summary
[0m13:46:21.349093 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:21.349820 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:21.350008 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: BEGIN
[0m13:46:21.350161 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:46:21.364910 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m13:46:21.365132 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:21.365386 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_monthly_sales_summary"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_monthly_sales_summary__dbt_tmp"
  
  
    as
  
  (
    /*
    Monthly Sales Summary Mart
    
    Business Purpose:
    - Track monthly revenue trends and growth
    - Monitor order volume patterns
    - Identify seasonal trends
    - Executive dashboard ready
    
    Grain: One row per month
    
    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Customer count
    - Growth rates
*/



WITH monthly_base AS (
    SELECT
        -- Time dimension
        DATE_TRUNC('month', order_purchase_timestamp) AS order_month,
        
        -- Aggregated metrics
        COUNT(DISTINCT order_id) AS total_orders,
        COUNT(DISTINCT customer_id) AS unique_customers,
        SUM(total_item_value) AS total_revenue,
        SUM(price) AS total_product_revenue,
        SUM(freight_value) AS total_shipping_revenue,
        
        -- Calculate averages
        AVG(total_item_value) AS avg_order_value,
        COUNT(*) AS total_order_items
        
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    WHERE order_purchase_timestamp IS NOT NULL
    GROUP BY DATE_TRUNC('month', order_purchase_timestamp)
),

monthly_with_growth AS (
    SELECT 
        order_month,
        total_orders,
        unique_customers,
        total_revenue,
        total_product_revenue,
        total_shipping_revenue,
        avg_order_value,
        total_order_items,
        
        -- Calculate items per order
        ROUND(total_order_items::NUMERIC / total_orders, 2) AS avg_items_per_order,
        
        -- Calculate revenue per customer
        ROUND(total_revenue::NUMERIC / unique_customers, 2) AS revenue_per_customer,
        
        -- Month-over-month growth calculations
        LAG(total_revenue) OVER (ORDER BY order_month) AS prev_month_revenue,
        LAG(total_orders) OVER (ORDER BY order_month) AS prev_month_orders,
        
        -- Calculate growth rates
        CASE 
            WHEN LAG(total_revenue) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_revenue - LAG(total_revenue) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_revenue) OVER (ORDER BY order_month)::NUMERIC) * 100, 2
            )
            ELSE NULL
        END AS revenue_growth_rate,
        
        CASE 
            WHEN LAG(total_orders) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_orders - LAG(total_orders) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_orders) OVER (ORDER BY order_month)::NUMERIC) * 100, 2
            )
            ELSE NULL
        END AS order_growth_rate
        
    FROM monthly_base
)

SELECT 
    order_month,
    total_orders,
    unique_customers,
    total_revenue,
    total_product_revenue,
    total_shipping_revenue,
    avg_order_value,
    total_order_items,
    avg_items_per_order,
    revenue_per_customer,
    prev_month_revenue,
    prev_month_orders,
    revenue_growth_rate,
    order_growth_rate,
    
    -- Add business insights flags
    CASE 
        WHEN revenue_growth_rate > 10 THEN 'High Growth'
        WHEN revenue_growth_rate > 0 THEN 'Growing'
        WHEN revenue_growth_rate = 0 THEN 'Flat'
        WHEN revenue_growth_rate < 0 THEN 'Declining'
        ELSE 'No Prior Data'
    END AS growth_category

FROM monthly_with_growth
ORDER BY order_month
  );
  
[0m13:46:22.355225 [debug] [Thread-1 (]: SQL status: SELECT 24 in 0.989 seconds
[0m13:46:22.372060 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:22.372546 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_monthly_sales_summary"} */
alter table "ecommerce_db"."analytics"."mart_monthly_sales_summary__dbt_tmp" rename to "mart_monthly_sales_summary"
[0m13:46:22.373374 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:46:22.380987 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: COMMIT
[0m13:46:22.381259 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:22.381463 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: COMMIT
[0m13:46:22.382225 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m13:46:22.385844 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."mart_monthly_sales_summary__dbt_backup"
[0m13:46:22.388956 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:22.389267 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_monthly_sales_summary"} */
drop table if exists "ecommerce_db"."analytics"."mart_monthly_sales_summary__dbt_backup" cascade
[0m13:46:22.389801 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.000 seconds
[0m13:46:22.391294 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: Close
[0m13:46:22.393247 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f04628b-8d41-48a1-992d-0fecbeaae725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089f0f50>]}
[0m13:46:22.393665 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.mart_monthly_sales_summary ......... [[32mSELECT 24[0m in 1.07s]
[0m13:46:22.393994 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:46:22.394716 [debug] [MainThread]: Using postgres connection "master"
[0m13:46:22.394922 [debug] [MainThread]: On master: BEGIN
[0m13:46:22.395084 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:46:22.399238 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m13:46:22.399467 [debug] [MainThread]: On master: COMMIT
[0m13:46:22.399629 [debug] [MainThread]: Using postgres connection "master"
[0m13:46:22.399781 [debug] [MainThread]: On master: COMMIT
[0m13:46:22.400061 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:46:22.400219 [debug] [MainThread]: On master: Close
[0m13:46:22.400498 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:46:22.400709 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_monthly_sales_summary' was properly closed.
[0m13:46:22.400905 [info ] [MainThread]: 
[0m13:46:22.401107 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m13:46:22.401483 [debug] [MainThread]: Command end result
[0m13:46:22.419002 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:46:22.421874 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:46:22.425677 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m13:46:22.425898 [info ] [MainThread]: 
[0m13:46:22.426135 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:46:22.426296 [info ] [MainThread]: 
[0m13:46:22.426477 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:46:22.432349 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8409377, "process_in_blocks": "0", "process_kernel_time": 0.280624, "process_mem_max_rss": "152846336", "process_out_blocks": "0", "process_user_time": 1.735793}
[0m13:46:22.432686 [debug] [MainThread]: Command `dbt run` succeeded at 13:46:22.432628 after 1.84 seconds
[0m13:46:22.432925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108585de0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10856ac10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10856acb0>]}
[0m13:46:22.433144 [debug] [MainThread]: Flushing usage events
[0m13:46:23.006315 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:46:33.433211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d62900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062efd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062efc50>]}


============================== 13:46:33.436192 | 06ecce67-e10a-4556-9879-9b2fc76f700e ==============================
[0m13:46:33.436192 [info ] [MainThread]: Running with dbt=1.10.15
[0m13:46:33.436553 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'fail_fast': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'static_parser': 'True', 'write_json': 'True', 'warn_error': 'None', 'version_check': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'no_print': 'None', 'target_path': 'None', 'debug': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt show --select mart_monthly_sales_summary --limit 8', 'printer_width': '80', 'empty': 'None', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'quiet': 'False', 'partial_parse': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m13:46:33.550506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06ecce67-e10a-4556-9879-9b2fc76f700e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105602650>]}
[0m13:46:33.582213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06ecce67-e10a-4556-9879-9b2fc76f700e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106187bd0>]}
[0m13:46:33.600606 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m13:46:33.656042 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m13:46:33.732375 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:46:33.732651 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:46:33.749714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06ecce67-e10a-4556-9879-9b2fc76f700e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106db8b50>]}
[0m13:46:33.786164 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:46:33.787609 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:46:33.793056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06ecce67-e10a-4556-9879-9b2fc76f700e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10697fe30>]}
[0m13:46:33.793327 [info ] [MainThread]: Found 9 models, 9 sources, 459 macros
[0m13:46:33.793505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06ecce67-e10a-4556-9879-9b2fc76f700e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d96510>]}
[0m13:46:33.794503 [info ] [MainThread]: 
[0m13:46:33.794715 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:46:33.794857 [info ] [MainThread]: 
[0m13:46:33.795126 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:46:33.797116 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m13:46:33.857156 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:46:33.857430 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m13:46:33.857582 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:46:33.883251 [debug] [ThreadPool]: SQL status: BEGIN in 0.026 seconds
[0m13:46:33.883531 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m13:46:33.883700 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m13:46:33.888253 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m13:46:33.889085 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m13:46:33.891015 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m13:46:33.894237 [debug] [MainThread]: Using postgres connection "master"
[0m13:46:33.894448 [debug] [MainThread]: On master: BEGIN
[0m13:46:33.894593 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:46:33.904417 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m13:46:33.904596 [debug] [MainThread]: Using postgres connection "master"
[0m13:46:33.904790 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m13:46:33.911593 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m13:46:33.912913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06ecce67-e10a-4556-9879-9b2fc76f700e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c98530>]}
[0m13:46:33.913146 [debug] [MainThread]: On master: ROLLBACK
[0m13:46:33.913427 [debug] [MainThread]: On master: Close
[0m13:46:33.915994 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:46:33.916217 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_monthly_sales_summary)
[0m13:46:33.916402 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_monthly_sales_summary
[0m13:46:33.921289 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:33.921961 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_monthly_sales_summary
[0m13:46:33.925530 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m13:46:33.925824 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_monthly_sales_summary"} */

  
  /*
    Monthly Sales Summary Mart
    
    Business Purpose:
    - Track monthly revenue trends and growth
    - Monitor order volume patterns
    - Identify seasonal trends
    - Executive dashboard ready
    
    Grain: One row per month
    
    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Customer count
    - Growth rates
*/



WITH monthly_base AS (
    SELECT
        -- Time dimension
        DATE_TRUNC('month', order_purchase_timestamp) AS order_month,
        
        -- Aggregated metrics
        COUNT(DISTINCT order_id) AS total_orders,
        COUNT(DISTINCT customer_id) AS unique_customers,
        SUM(total_item_value) AS total_revenue,
        SUM(price) AS total_product_revenue,
        SUM(freight_value) AS total_shipping_revenue,
        
        -- Calculate averages
        AVG(total_item_value) AS avg_order_value,
        COUNT(*) AS total_order_items
        
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    WHERE order_purchase_timestamp IS NOT NULL
    GROUP BY DATE_TRUNC('month', order_purchase_timestamp)
),

monthly_with_growth AS (
    SELECT 
        order_month,
        total_orders,
        unique_customers,
        total_revenue,
        total_product_revenue,
        total_shipping_revenue,
        avg_order_value,
        total_order_items,
        
        -- Calculate items per order
        ROUND(total_order_items::NUMERIC / total_orders, 2) AS avg_items_per_order,
        
        -- Calculate revenue per customer
        ROUND(total_revenue::NUMERIC / unique_customers, 2) AS revenue_per_customer,
        
        -- Month-over-month growth calculations
        LAG(total_revenue) OVER (ORDER BY order_month) AS prev_month_revenue,
        LAG(total_orders) OVER (ORDER BY order_month) AS prev_month_orders,
        
        -- Calculate growth rates
        CASE 
            WHEN LAG(total_revenue) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_revenue - LAG(total_revenue) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_revenue) OVER (ORDER BY order_month)::NUMERIC) * 100, 2
            )
            ELSE NULL
        END AS revenue_growth_rate,
        
        CASE 
            WHEN LAG(total_orders) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_orders - LAG(total_orders) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_orders) OVER (ORDER BY order_month)::NUMERIC) * 100, 2
            )
            ELSE NULL
        END AS order_growth_rate
        
    FROM monthly_base
)

SELECT 
    order_month,
    total_orders,
    unique_customers,
    total_revenue,
    total_product_revenue,
    total_shipping_revenue,
    avg_order_value,
    total_order_items,
    avg_items_per_order,
    revenue_per_customer,
    prev_month_revenue,
    prev_month_orders,
    revenue_growth_rate,
    order_growth_rate,
    
    -- Add business insights flags
    CASE 
        WHEN revenue_growth_rate > 10 THEN 'High Growth'
        WHEN revenue_growth_rate > 0 THEN 'Growing'
        WHEN revenue_growth_rate = 0 THEN 'Flat'
        WHEN revenue_growth_rate < 0 THEN 'Declining'
        ELSE 'No Prior Data'
    END AS growth_category

FROM monthly_with_growth
ORDER BY order_month
  
  limit 8

[0m13:46:33.926096 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:46:34.292111 [debug] [Thread-1 (]: SQL status: SELECT 8 in 0.366 seconds
[0m13:46:34.298004 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: Close
[0m13:46:34.298505 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_monthly_sales_summary
[0m13:46:34.299154 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:46:34.299344 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_monthly_sales_summary' was properly closed.
[0m13:46:34.299686 [debug] [MainThread]: Command end result
[0m13:46:34.317803 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m13:46:34.319549 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m13:46:34.325056 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m13:46:34.326134 [info ] [MainThread]: Previewing node 'mart_monthly_sales_summary':
|         order_month | total_orders | unique_customers | total_revenue | total_product_rev... | total_shipping_re... | ... |
| ------------------- | ------------ | ---------------- | ------------- | -------------------- | -------------------- | --- |
| 2016-09-01 00:00:00 |            3 |                3 |      354.750… |             267.360… |              87.390… | ... |
| 2016-10-01 00:00:00 |          308 |              308 |   56,808.840… |          49,507.660… |           7,301.180… | ... |
| 2016-12-01 00:00:00 |            1 |                1 |       19.620… |              10.900… |               8.720… | ... |
| 2017-01-01 00:00:00 |          789 |              789 |  137,188.490… |         120,312.870… |          16,875.620… | ... |
| 2017-02-01 00:00:00 |         1733 |             1733 |  286,280.620… |         247,303.020… |          38,977.600… | ... |
| 2017-03-01 00:00:00 |         2641 |             2641 |  432,048.590… |         374,344.300… |          57,704.290… | ... |
| 2017-04-01 00:00:00 |         2391 |             2391 |  412,422.240… |         359,927.230… |          52,495.010… | ... |
| 2017-05-01 00:00:00 |         3660 |             3660 |  586,190.950… |         506,071.140… |          80,119.810… | ... |

[0m13:46:34.328971 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 0.95051575, "process_in_blocks": "0", "process_kernel_time": 0.242465, "process_mem_max_rss": "150257664", "process_out_blocks": "0", "process_user_time": 1.571906}
[0m13:46:34.329354 [debug] [MainThread]: Command `dbt show` succeeded at 13:46:34.329284 after 0.95 seconds
[0m13:46:34.329628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062e0590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1209ee0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1209ee150>]}
[0m13:46:34.329879 [debug] [MainThread]: Flushing usage events
[0m13:46:34.980192 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:53:22.152289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074f2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110ffd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110ffc50>]}


============================== 14:53:22.156193 | 2b6fa682-9cc1-4442-912d-95a2210ea604 ==============================
[0m14:53:22.156193 [info ] [MainThread]: Running with dbt=1.10.15
[0m14:53:22.156528 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt show --select int_orders_joined --limit 3', 'cache_selected_only': 'False', 'fail_fast': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'printer_width': '80', 'target_path': 'None', 'indirect_selection': 'eager', 'log_format': 'default', 'debug': 'False', 'static_parser': 'True', 'no_print': 'None', 'write_json': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'send_anonymous_usage_stats': 'True', 'empty': 'None', 'introspect': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False'}
[0m14:53:22.298438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2b6fa682-9cc1-4442-912d-95a2210ea604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11000a650>]}
[0m14:53:22.330018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2b6fa682-9cc1-4442-912d-95a2210ea604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e93bd0>]}
[0m14:53:22.349854 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:53:22.409874 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m14:53:22.490871 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:53:22.491155 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:53:22.508421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2b6fa682-9cc1-4442-912d-95a2210ea604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b80b50>]}
[0m14:53:22.546275 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m14:53:22.548222 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m14:53:22.550343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2b6fa682-9cc1-4442-912d-95a2210ea604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120b7e30>]}
[0m14:53:22.550589 [info ] [MainThread]: Found 9 models, 9 sources, 459 macros
[0m14:53:22.550759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b6fa682-9cc1-4442-912d-95a2210ea604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b5a510>]}
[0m14:53:22.551695 [info ] [MainThread]: 
[0m14:53:22.551898 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:53:22.552032 [info ] [MainThread]: 
[0m14:53:22.552283 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:53:22.554344 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m14:53:22.630263 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m14:53:22.630535 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m14:53:22.630694 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:53:22.662826 [debug] [ThreadPool]: SQL status: BEGIN in 0.032 seconds
[0m14:53:22.663115 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m14:53:22.663292 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m14:53:22.671419 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.008 seconds
[0m14:53:22.672313 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m14:53:22.672640 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m14:53:22.676019 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:22.676219 [debug] [MainThread]: On master: BEGIN
[0m14:53:22.676364 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:53:22.684116 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:53:22.684296 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:22.684485 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:53:22.697930 [debug] [MainThread]: SQL status: SELECT 13 in 0.013 seconds
[0m14:53:22.699388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b6fa682-9cc1-4442-912d-95a2210ea604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f30600>]}
[0m14:53:22.699654 [debug] [MainThread]: On master: ROLLBACK
[0m14:53:22.699995 [debug] [MainThread]: On master: Close
[0m14:53:22.701851 [debug] [Thread-1 (]: Began running node model.ecom_analytics.int_orders_joined
[0m14:53:22.702100 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.int_orders_joined)
[0m14:53:22.702303 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.int_orders_joined
[0m14:53:22.707650 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.int_orders_joined"
[0m14:53:22.708726 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.int_orders_joined
[0m14:53:22.712309 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.int_orders_joined"
[0m14:53:22.712643 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.int_orders_joined"} */

  
  /*
    Intermediate model joining core business entities
    - Combines orders, order items, customers, products, sellers, and category translations
    - Creates wide analytical dataset at order line item grain
    - Foundation for business analytics and reporting
    - Includes calculated fields for business insights
*/

WITH order_base AS (
    SELECT
        -- Order information
        order_id,
        customer_id,
        order_status,
        order_purchase_timestamp,
        order_approved_at,
        order_delivered_carrier_date,
        order_delivered_customer_date,
        order_estimated_delivery_date
    FROM "ecommerce_db"."analytics"."stg_orders"
),

order_items_base AS (
    SELECT
        order_id,
        order_item_id,
        product_id,
        seller_id,
        shipping_limit_date,
        price,
        freight_value
    FROM "ecommerce_db"."analytics"."stg_order_items"
),

customers_base AS (
    SELECT
        customer_id,
        customer_unique_id,
        customer_zip_code_prefix,
        customer_city,
        customer_state
    FROM "ecommerce_db"."analytics"."stg_customers"
),

products_base AS (
    SELECT
        product_id,
        product_category_name,
        product_name_lenght,
        product_description_lenght,
        product_photos_qty,
        product_weight_g,
        product_length_cm,
        product_height_cm,
        product_width_cm
    FROM "ecommerce_db"."analytics"."stg_products"
),

sellers_base AS (
    SELECT
        seller_id,
        seller_zip_code_prefix,
        seller_city,
        seller_state
    FROM "ecommerce_db"."analytics"."stg_sellers"
),

category_translation AS (
    SELECT
        product_category_name,
        product_category_name_english
    FROM "ecommerce_db"."analytics"."stg_product_category_name_translation"
)

SELECT
    -- Order identifiers
    oi.order_id,
    oi.order_item_id,
    
    -- Order details
    o.order_status,
    o.order_purchase_timestamp,
    o.order_approved_at,
    o.order_delivered_carrier_date,
    o.order_delivered_customer_date,
    o.order_estimated_delivery_date,
    
    -- Customer information
    o.customer_id,
    c.customer_unique_id,
    c.customer_city,
    c.customer_state,
    c.customer_zip_code_prefix,
    
    -- Product information
    oi.product_id,
    p.product_category_name,
    ct.product_category_name_english,
    p.product_weight_g,
    p.product_length_cm,
    p.product_height_cm,
    p.product_width_cm,
    p.product_photos_qty,
    
    -- Seller information
    oi.seller_id,
    s.seller_city,
    s.seller_state,
    s.seller_zip_code_prefix AS seller_zip_code_prefix,
    
    -- Financial information
    oi.price,
    oi.freight_value,
    oi.shipping_limit_date,
    
    -- Calculated fields
    (oi.price + oi.freight_value) AS total_item_value,
    
    CASE 
        WHEN o.order_delivered_customer_date IS NOT NULL 
             AND o.order_purchase_timestamp IS NOT NULL
        THEN EXTRACT(DAY FROM (o.order_delivered_customer_date - o.order_purchase_timestamp))
        ELSE NULL
    END AS delivery_days,
    
    CASE 
        WHEN o.order_delivered_customer_date > o.order_estimated_delivery_date
        THEN TRUE
        ELSE FALSE
    END AS is_late_delivery

FROM order_items_base oi
LEFT JOIN order_base o ON oi.order_id = o.order_id
LEFT JOIN customers_base c ON o.customer_id = c.customer_id
LEFT JOIN products_base p ON oi.product_id = p.product_id
LEFT JOIN category_translation ct ON p.product_category_name = ct.product_category_name
LEFT JOIN sellers_base s ON oi.seller_id = s.seller_id
  
  limit 3

[0m14:53:22.712942 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:53:22.860953 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.148 seconds
[0m14:53:22.862585 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: Close
[0m14:53:22.863003 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.int_orders_joined
[0m14:53:22.863577 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:53:22.863729 [debug] [MainThread]: Connection 'model.ecom_analytics.int_orders_joined' was properly closed.
[0m14:53:22.864049 [debug] [MainThread]: Command end result
[0m14:53:22.887297 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m14:53:22.892587 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m14:53:22.898223 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m14:53:22.898695 [info ] [MainThread]: Previewing node 'int_orders_joined':
| order_id             | order_item_id | order_status | order_purchase_ti... |   order_approved_at | order_delivered_c... | ... |
| -------------------- | ------------- | ------------ | -------------------- | ------------------- | -------------------- | --- |
| 00061f2a7bc09da83... |             1 | delivered    |  2018-03-24 22:16:10 | 2018-03-24 22:28:09 |  2018-03-27 05:26:55 | ... |
| 0014ae671de39511f... |             1 | delivered    |  2017-05-22 13:49:03 | 2017-05-23 03:15:24 |  2017-05-29 09:04:02 | ... |
| 0046176ff0dbc2a17... |             1 | delivered    |  2018-05-29 19:22:17 | 2018-05-29 19:35:18 |  2018-05-30 11:29:00 | ... |

[0m14:53:22.901489 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 0.810263, "process_in_blocks": "0", "process_kernel_time": 0.316743, "process_mem_max_rss": "148881408", "process_out_blocks": "0", "process_user_time": 1.574392}
[0m14:53:22.901885 [debug] [MainThread]: Command `dbt show` succeeded at 14:53:22.901820 after 0.81 seconds
[0m14:53:22.902170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110ec590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c7e150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c7e0a0>]}
[0m14:53:22.902424 [debug] [MainThread]: Flushing usage events
[0m14:53:23.595030 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:53:33.583172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10992a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8fbc50>]}


============================== 14:53:33.587987 | c19bc4dd-40fd-416a-a1f1-a0c53ab79150 ==============================
[0m14:53:33.587987 [info ] [MainThread]: Running with dbt=1.10.15
[0m14:53:33.588358 [debug] [MainThread]: running dbt with arguments {'empty': 'None', 'log_format': 'default', 'no_print': 'None', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'write_json': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'quiet': 'False', 'printer_width': '80', 'partial_parse': 'True', 'target_path': 'None', 'debug': 'False', 'invocation_command': 'dbt show --select mart_monthly_sales_summary --limit 3', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'introspect': 'True', 'version_check': 'True'}
[0m14:53:33.698723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c19bc4dd-40fd-416a-a1f1-a0c53ab79150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a012650>]}
[0m14:53:33.730520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c19bc4dd-40fd-416a-a1f1-a0c53ab79150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b793bd0>]}
[0m14:53:33.755214 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m14:53:33.809803 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m14:53:33.888059 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:53:33.888337 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:53:33.906014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c19bc4dd-40fd-416a-a1f1-a0c53ab79150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cae0b50>]}
[0m14:53:33.942249 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m14:53:33.943683 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m14:53:33.945332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c19bc4dd-40fd-416a-a1f1-a0c53ab79150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf87e30>]}
[0m14:53:33.945587 [info ] [MainThread]: Found 9 models, 9 sources, 459 macros
[0m14:53:33.945761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c19bc4dd-40fd-416a-a1f1-a0c53ab79150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cad6510>]}
[0m14:53:33.946677 [info ] [MainThread]: 
[0m14:53:33.946858 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:53:33.946991 [info ] [MainThread]: 
[0m14:53:33.947244 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:53:33.949249 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m14:53:34.015599 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m14:53:34.015886 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m14:53:34.016045 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:53:34.038628 [debug] [ThreadPool]: SQL status: BEGIN in 0.023 seconds
[0m14:53:34.038908 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m14:53:34.039070 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m14:53:34.045612 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m14:53:34.046459 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m14:53:34.046764 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m14:53:34.049850 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:34.050051 [debug] [MainThread]: On master: BEGIN
[0m14:53:34.050198 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:53:34.056445 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m14:53:34.056605 [debug] [MainThread]: Using postgres connection "master"
[0m14:53:34.056790 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m14:53:34.063880 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m14:53:34.065101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c19bc4dd-40fd-416a-a1f1-a0c53ab79150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cea4530>]}
[0m14:53:34.065321 [debug] [MainThread]: On master: ROLLBACK
[0m14:53:34.065656 [debug] [MainThread]: On master: Close
[0m14:53:34.067294 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_monthly_sales_summary
[0m14:53:34.067509 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_monthly_sales_summary)
[0m14:53:34.067690 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_monthly_sales_summary
[0m14:53:34.072388 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_monthly_sales_summary"
[0m14:53:34.073081 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_monthly_sales_summary
[0m14:53:34.076539 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_monthly_sales_summary"
[0m14:53:34.076826 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_monthly_sales_summary"} */

  
  /*
    Monthly Sales Summary Mart
    
    Business Purpose:
    - Track monthly revenue trends and growth
    - Monitor order volume patterns
    - Identify seasonal trends
    - Executive dashboard ready
    
    Grain: One row per month
    
    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Customer count
    - Growth rates
*/



WITH monthly_base AS (
    SELECT
        -- Time dimension
        DATE_TRUNC('month', order_purchase_timestamp) AS order_month,
        
        -- Aggregated metrics
        COUNT(DISTINCT order_id) AS total_orders,
        COUNT(DISTINCT customer_id) AS unique_customers,
        SUM(total_item_value) AS total_revenue,
        SUM(price) AS total_product_revenue,
        SUM(freight_value) AS total_shipping_revenue,
        
        -- Calculate averages
        AVG(total_item_value) AS avg_order_value,
        COUNT(*) AS total_order_items
        
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    WHERE order_purchase_timestamp IS NOT NULL
    GROUP BY DATE_TRUNC('month', order_purchase_timestamp)
),

monthly_with_growth AS (
    SELECT 
        order_month,
        total_orders,
        unique_customers,
        total_revenue,
        total_product_revenue,
        total_shipping_revenue,
        avg_order_value,
        total_order_items,
        
        -- Calculate items per order
        ROUND(total_order_items::NUMERIC / total_orders, 2) AS avg_items_per_order,
        
        -- Calculate revenue per customer
        ROUND(total_revenue::NUMERIC / unique_customers, 2) AS revenue_per_customer,
        
        -- Month-over-month growth calculations
        LAG(total_revenue) OVER (ORDER BY order_month) AS prev_month_revenue,
        LAG(total_orders) OVER (ORDER BY order_month) AS prev_month_orders,
        
        -- Calculate growth rates
        CASE 
            WHEN LAG(total_revenue) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_revenue - LAG(total_revenue) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_revenue) OVER (ORDER BY order_month)::NUMERIC) * 100, 2
            )
            ELSE NULL
        END AS revenue_growth_rate,
        
        CASE 
            WHEN LAG(total_orders) OVER (ORDER BY order_month) IS NOT NULL 
            THEN ROUND(
                ((total_orders - LAG(total_orders) OVER (ORDER BY order_month))::NUMERIC / 
                 LAG(total_orders) OVER (ORDER BY order_month)::NUMERIC) * 100, 2
            )
            ELSE NULL
        END AS order_growth_rate
        
    FROM monthly_base
)

SELECT 
    order_month,
    total_orders,
    unique_customers,
    total_revenue,
    total_product_revenue,
    total_shipping_revenue,
    avg_order_value,
    total_order_items,
    avg_items_per_order,
    revenue_per_customer,
    prev_month_revenue,
    prev_month_orders,
    revenue_growth_rate,
    order_growth_rate,
    
    -- Add business insights flags
    CASE 
        WHEN revenue_growth_rate > 10 THEN 'High Growth'
        WHEN revenue_growth_rate > 0 THEN 'Growing'
        WHEN revenue_growth_rate = 0 THEN 'Flat'
        WHEN revenue_growth_rate < 0 THEN 'Declining'
        ELSE 'No Prior Data'
    END AS growth_category

FROM monthly_with_growth
ORDER BY order_month
  
  limit 3

[0m14:53:34.077083 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:53:34.374155 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.297 seconds
[0m14:53:34.377088 [debug] [Thread-1 (]: On model.ecom_analytics.mart_monthly_sales_summary: Close
[0m14:53:34.380291 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_monthly_sales_summary
[0m14:53:34.401497 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:53:34.411838 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_monthly_sales_summary' was properly closed.
[0m14:53:34.412651 [debug] [MainThread]: Command end result
[0m14:53:34.426383 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m14:53:34.428293 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m14:53:34.432488 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m14:53:34.433179 [info ] [MainThread]: Previewing node 'mart_monthly_sales_summary':
|         order_month | total_orders | unique_customers | total_revenue | total_product_rev... | total_shipping_re... | ... |
| ------------------- | ------------ | ---------------- | ------------- | -------------------- | -------------------- | --- |
| 2016-09-01 00:00:00 |            3 |                3 |      354.750… |             267.360… |              87.390… | ... |
| 2016-10-01 00:00:00 |          308 |              308 |   56,808.840… |          49,507.660… |           7,301.180… | ... |
| 2016-12-01 00:00:00 |            1 |                1 |       19.620… |              10.900… |               8.720… | ... |

[0m14:53:34.435194 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 0.9079546, "process_in_blocks": "0", "process_kernel_time": 0.260117, "process_mem_max_rss": "147767296", "process_out_blocks": "0", "process_user_time": 1.546676}
[0m14:53:34.435470 [debug] [MainThread]: Command `dbt show` succeeded at 14:53:34.435420 after 0.91 seconds
[0m14:53:34.435709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8ec590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbedbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbedd30>]}
[0m14:53:34.435958 [debug] [MainThread]: Flushing usage events
[0m14:53:34.912410 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:13:42.750273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105502900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106affd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106affc50>]}


============================== 10:13:42.754319 | 864cdf34-a30a-47a7-941f-963076423c0a ==============================
[0m10:13:42.754319 [info ] [MainThread]: Running with dbt=1.10.15
[0m10:13:42.754772 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'empty': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'log_format': 'default', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'warn_error': 'None', 'static_parser': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'no_print': 'None', 'quiet': 'False', 'invocation_command': 'dbt run --select mart_customer_analytics', 'use_colors': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'version_check': 'True', 'use_experimental_parser': 'False', 'printer_width': '80'}
[0m10:13:42.952480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '864cdf34-a30a-47a7-941f-963076423c0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c0e650>]}
[0m10:13:42.987425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '864cdf34-a30a-47a7-941f-963076423c0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106893bd0>]}
[0m10:13:42.989249 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m10:13:43.047612 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m10:13:43.125557 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m10:13:43.126024 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/marts/mart_customer_analytics.sql
[0m10:13:43.256404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '864cdf34-a30a-47a7-941f-963076423c0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bc2250>]}
[0m10:13:43.295107 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:13:43.297078 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:13:43.322703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '864cdf34-a30a-47a7-941f-963076423c0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b7b60>]}
[0m10:13:43.323061 [info ] [MainThread]: Found 10 models, 9 sources, 459 macros
[0m10:13:43.323243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '864cdf34-a30a-47a7-941f-963076423c0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ed6c10>]}
[0m10:13:43.324240 [info ] [MainThread]: 
[0m10:13:43.324427 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:13:43.324570 [info ] [MainThread]: 
[0m10:13:43.324821 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:13:43.325276 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m10:13:43.389568 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m10:13:43.389829 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m10:13:43.389974 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:13:43.440925 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.051 seconds
[0m10:13:43.441785 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m10:13:43.444538 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m10:13:43.447669 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:13:43.447886 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m10:13:43.448065 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:13:43.457328 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m10:13:43.457589 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:13:43.457770 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m10:13:43.468741 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.011 seconds
[0m10:13:43.469718 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m10:13:43.470253 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m10:13:43.473668 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:43.473858 [debug] [MainThread]: On master: BEGIN
[0m10:13:43.473996 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:13:43.483221 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m10:13:43.483506 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:43.483711 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m10:13:43.495226 [debug] [MainThread]: SQL status: SELECT 13 in 0.011 seconds
[0m10:13:43.496512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '864cdf34-a30a-47a7-941f-963076423c0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11824bc70>]}
[0m10:13:43.496740 [debug] [MainThread]: On master: ROLLBACK
[0m10:13:43.497239 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:43.497409 [debug] [MainThread]: On master: BEGIN
[0m10:13:43.497828 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m10:13:43.498107 [debug] [MainThread]: On master: COMMIT
[0m10:13:43.498295 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:43.498438 [debug] [MainThread]: On master: COMMIT
[0m10:13:43.498750 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:13:43.498973 [debug] [MainThread]: On master: Close
[0m10:13:43.501284 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_customer_analytics
[0m10:13:43.501565 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_customer_analytics ................. [RUN]
[0m10:13:43.501786 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_customer_analytics)
[0m10:13:43.501959 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_customer_analytics
[0m10:13:43.506241 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_customer_analytics"
[0m10:13:43.506844 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_customer_analytics
[0m10:13:43.527683 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_customer_analytics"
[0m10:13:43.528424 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m10:13:43.528638 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: BEGIN
[0m10:13:43.528802 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:43.537096 [debug] [Thread-1 (]: SQL status: BEGIN in 0.008 seconds
[0m10:13:43.537378 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m10:13:43.537625 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_customer_analytics"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_customer_analytics__dbt_tmp"
  
  
    as
  
  (
    /*
    Customer analytics Summary Mart
    
    Business Purpose:
    - Track customer behavior and preferences
    - Monitor customer lifetime value (CLV)
    - Identify high-value customer segments

    Grain: One row per customer

    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Favourite product category
*/



WITH customer_first_info AS (
    SELECT DISTINCT
        customer_id,
        FIRST_VALUE(customer_city) OVER (
            PARTITION BY customer_id 
            ORDER BY order_purchase_timestamp
        ) AS customer_city,
        FIRST_VALUE(customer_state) OVER (
            PARTITION BY customer_id 
            ORDER BY order_purchase_timestamp  
        ) AS customer_state
    FROM "ecommerce_db"."analytics"."int_orders_joined"
),

category_counts AS (
    SELECT 
        customer_id,
        product_category_name_english,
        COUNT(*) as category_purchase_count,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY COUNT(*) DESC
        ) as category_rank
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    GROUP BY customer_id, product_category_name_english
),

favorite_categories AS (
    SELECT 
        customer_id, 
        product_category_name_english AS favorite_category
    FROM category_counts
    WHERE category_rank = 1
)

SELECT
    base.customer_id,
    info.customer_city,
    info.customer_state,
    SUM(total_item_value) AS total_lifetime_revenue,
    COUNT(DISTINCT order_id) AS total_orders,
    AVG(total_item_value) AS avg_order_value,
    MIN(order_purchase_timestamp) AS first_order_date,
    MAX(order_purchase_timestamp) AS last_order_date,
    fav.favorite_category,
    CASE WHEN COUNT(DISTINCT order_id) > 1 THEN TRUE ELSE FALSE END AS is_repeat_customer

FROM "ecommerce_db"."analytics"."int_orders_joined" base
LEFT JOIN customer_first_info info ON base.customer_id = info.customer_id
LEFT JOIN favorite_categories fav ON base.customer_id = fav.customer_id
GROUP BY base.customer_id, info.customer_city, info.customer_state, fav.favorite_category
  );
  
[0m10:13:46.487511 [debug] [Thread-1 (]: SQL status: SELECT 98666 in 2.949 seconds
[0m10:13:46.499149 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m10:13:46.499766 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_customer_analytics"} */
alter table "ecommerce_db"."analytics"."mart_customer_analytics__dbt_tmp" rename to "mart_customer_analytics"
[0m10:13:46.500996 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m10:13:46.511244 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: COMMIT
[0m10:13:46.511660 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m10:13:46.511965 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: COMMIT
[0m10:13:46.514217 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m10:13:46.518448 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."mart_customer_analytics__dbt_backup"
[0m10:13:46.522681 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m10:13:46.523086 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_customer_analytics"} */
drop table if exists "ecommerce_db"."analytics"."mart_customer_analytics__dbt_backup" cascade
[0m10:13:46.523643 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.000 seconds
[0m10:13:46.525334 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: Close
[0m10:13:46.526965 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '864cdf34-a30a-47a7-941f-963076423c0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1183f9010>]}
[0m10:13:46.527444 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.mart_customer_analytics ............ [[32mSELECT 98666[0m in 3.02s]
[0m10:13:46.527905 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_customer_analytics
[0m10:13:46.528765 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:46.528977 [debug] [MainThread]: On master: BEGIN
[0m10:13:46.529132 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:13:46.533187 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m10:13:46.533421 [debug] [MainThread]: On master: COMMIT
[0m10:13:46.533589 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:46.533747 [debug] [MainThread]: On master: COMMIT
[0m10:13:46.533992 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:13:46.534148 [debug] [MainThread]: On master: Close
[0m10:13:46.534439 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:13:46.534617 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_customer_analytics' was properly closed.
[0m10:13:46.534796 [info ] [MainThread]: 
[0m10:13:46.534988 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.21 seconds (3.21s).
[0m10:13:46.535390 [debug] [MainThread]: Command end result
[0m10:13:46.554319 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:13:46.557176 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:13:46.561405 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m10:13:46.561646 [info ] [MainThread]: 
[0m10:13:46.561879 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:13:46.562044 [info ] [MainThread]: 
[0m10:13:46.562233 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m10:13:46.564496 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8875835, "process_in_blocks": "0", "process_kernel_time": 0.374766, "process_mem_max_rss": "154927104", "process_out_blocks": "0", "process_user_time": 1.80933}
[0m10:13:46.564819 [debug] [MainThread]: Command `dbt run` succeeded at 10:13:46.564767 after 3.89 seconds
[0m10:13:46.565039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ffaaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fe2cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fe2d50>]}
[0m10:13:46.565244 [debug] [MainThread]: Flushing usage events
[0m10:13:47.237177 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:14:19.010298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b2e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1160f7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1160f7c50>]}


============================== 10:14:19.013750 | f157d253-9e93-4d4e-be57-095874242b39 ==============================
[0m10:14:19.013750 [info ] [MainThread]: Running with dbt=1.10.15
[0m10:14:19.014198 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt show --select mart_customer_analytics --limit 5', 'static_parser': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'use_colors': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'quiet': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'debug': 'False', 'printer_width': '80', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'empty': 'None', 'warn_error': 'None'}
[0m10:14:19.137448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f157d253-9e93-4d4e-be57-095874242b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11520a650>]}
[0m10:14:19.171382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f157d253-9e93-4d4e-be57-095874242b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115f8fbd0>]}
[0m10:14:19.185310 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m10:14:19.240711 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m10:14:19.369247 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:14:19.369539 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:14:19.388941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f157d253-9e93-4d4e-be57-095874242b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117175050>]}
[0m10:14:19.429643 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:14:19.431868 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:14:19.437231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f157d253-9e93-4d4e-be57-095874242b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1167a3e30>]}
[0m10:14:19.437611 [info ] [MainThread]: Found 10 models, 9 sources, 459 macros
[0m10:14:19.437986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f157d253-9e93-4d4e-be57-095874242b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117152510>]}
[0m10:14:19.439226 [info ] [MainThread]: 
[0m10:14:19.439496 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:14:19.439651 [info ] [MainThread]: 
[0m10:14:19.439941 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:14:19.442230 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m10:14:19.598602 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:14:19.598894 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m10:14:19.599109 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:14:19.620462 [debug] [ThreadPool]: SQL status: BEGIN in 0.021 seconds
[0m10:14:19.620772 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m10:14:19.620952 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m10:14:19.625032 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.004 seconds
[0m10:14:19.626100 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m10:14:19.626636 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m10:14:19.630886 [debug] [MainThread]: Using postgres connection "master"
[0m10:14:19.631179 [debug] [MainThread]: On master: BEGIN
[0m10:14:19.631314 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:14:19.638288 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m10:14:19.638518 [debug] [MainThread]: Using postgres connection "master"
[0m10:14:19.638951 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m10:14:19.644936 [debug] [MainThread]: SQL status: SELECT 13 in 0.006 seconds
[0m10:14:19.646421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f157d253-9e93-4d4e-be57-095874242b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11752c530>]}
[0m10:14:19.646759 [debug] [MainThread]: On master: ROLLBACK
[0m10:14:19.647079 [debug] [MainThread]: On master: Close
[0m10:14:19.649142 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_customer_analytics
[0m10:14:19.649409 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_customer_analytics)
[0m10:14:19.649581 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_customer_analytics
[0m10:14:19.654638 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_customer_analytics"
[0m10:14:19.655391 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_customer_analytics
[0m10:14:19.658950 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m10:14:19.659299 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_customer_analytics"} */

  
  /*
    Customer analytics Summary Mart
    
    Business Purpose:
    - Track customer behavior and preferences
    - Monitor customer lifetime value (CLV)
    - Identify high-value customer segments

    Grain: One row per customer

    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Favourite product category
*/



WITH customer_first_info AS (
    SELECT DISTINCT
        customer_id,
        FIRST_VALUE(customer_city) OVER (
            PARTITION BY customer_id 
            ORDER BY order_purchase_timestamp
        ) AS customer_city,
        FIRST_VALUE(customer_state) OVER (
            PARTITION BY customer_id 
            ORDER BY order_purchase_timestamp  
        ) AS customer_state
    FROM "ecommerce_db"."analytics"."int_orders_joined"
),

category_counts AS (
    SELECT 
        customer_id,
        product_category_name_english,
        COUNT(*) as category_purchase_count,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY COUNT(*) DESC
        ) as category_rank
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    GROUP BY customer_id, product_category_name_english
),

favorite_categories AS (
    SELECT 
        customer_id, 
        product_category_name_english AS favorite_category
    FROM category_counts
    WHERE category_rank = 1
)

SELECT
    base.customer_id,
    info.customer_city,
    info.customer_state,
    SUM(total_item_value) AS total_lifetime_revenue,
    COUNT(DISTINCT order_id) AS total_orders,
    AVG(total_item_value) AS avg_order_value,
    MIN(order_purchase_timestamp) AS first_order_date,
    MAX(order_purchase_timestamp) AS last_order_date,
    fav.favorite_category,
    CASE WHEN COUNT(DISTINCT order_id) > 1 THEN TRUE ELSE FALSE END AS is_repeat_customer

FROM "ecommerce_db"."analytics"."int_orders_joined" base
LEFT JOIN customer_first_info info ON base.customer_id = info.customer_id
LEFT JOIN favorite_categories fav ON base.customer_id = fav.customer_id
GROUP BY base.customer_id, info.customer_city, info.customer_state, fav.favorite_category
  
  limit 5

[0m10:14:19.659603 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:14:21.532194 [debug] [Thread-1 (]: SQL status: SELECT 5 in 1.872 seconds
[0m10:14:21.537810 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: Close
[0m10:14:21.538598 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_customer_analytics
[0m10:14:21.539376 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:14:21.539555 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_customer_analytics' was properly closed.
[0m10:14:21.539909 [debug] [MainThread]: Command end result
[0m10:14:21.555388 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m10:14:21.557182 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m10:14:21.562802 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m10:14:21.563556 [info ] [MainThread]: Previewing node 'mart_customer_analytics':
| customer_id          | customer_city | customer_state | total_lifetime_re... | total_orders | avg_order_value | ... |
| -------------------- | ------------- | -------------- | -------------------- | ------------ | --------------- | --- |
| 00012a2ce6f8dcda2... | osasco        | SP             |             114.740… |            1 |        114.740… | ... |
| 000161a058600d590... | itapecerica   | MG             |              67.410… |            1 |         67.410… | ... |
| 0001fd6190edaaf88... | nova venecia  | ES             |             195.420… |            1 |        195.420… | ... |
| 0002414f953443074... | mendonca      | MG             |             179.350… |            1 |        179.350… | ... |
| 000379cdec6255224... | sao paulo     | SP             |             107.010… |            1 |        107.010… | ... |

[0m10:14:21.566142 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 2.6157882, "process_in_blocks": "0", "process_kernel_time": 0.33442, "process_mem_max_rss": "149405696", "process_out_blocks": "0", "process_user_time": 1.648154}
[0m10:14:21.566504 [debug] [MainThread]: Command `dbt show` succeeded at 10:14:21.566430 after 2.62 seconds
[0m10:14:21.566806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1160e8590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117271ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1172720a0>]}
[0m10:14:21.567087 [debug] [MainThread]: Flushing usage events
[0m10:14:22.034352 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:00:35.281847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f5e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064efd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064efc50>]}


============================== 11:00:35.285556 | 9976a714-9a1c-4586-b76a-0a038870116b ==============================
[0m11:00:35.285556 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:00:35.285916 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'warn_error': 'None', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'partial_parse': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'version_check': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'cache_selected_only': 'False', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'no_print': 'None', 'invocation_command': 'dbt run --select mart_customer_analytics', 'empty': 'False'}
[0m11:00:35.423756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9976a714-9a1c-4586-b76a-0a038870116b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105802650>]}
[0m11:00:35.455353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9976a714-9a1c-4586-b76a-0a038870116b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106387bd0>]}
[0m11:00:35.456281 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:00:35.515565 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:00:35.599163 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:00:35.599598 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_customer_analytics.sql
[0m11:00:35.721599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9976a714-9a1c-4586-b76a-0a038870116b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10743d050>]}
[0m11:00:35.756214 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:00:35.757991 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:00:35.778664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9976a714-9a1c-4586-b76a-0a038870116b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b834d0>]}
[0m11:00:35.778932 [info ] [MainThread]: Found 10 models, 9 sources, 459 macros
[0m11:00:35.779106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9976a714-9a1c-4586-b76a-0a038870116b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10759cc90>]}
[0m11:00:35.779998 [info ] [MainThread]: 
[0m11:00:35.780180 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:00:35.780318 [info ] [MainThread]: 
[0m11:00:35.780598 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:00:35.781120 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:00:35.842080 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:00:35.842359 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:00:35.842514 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:00:35.872182 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.030 seconds
[0m11:00:35.873248 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:00:35.875918 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:00:35.879101 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:00:35.879282 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:00:35.879421 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:00:35.889740 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m11:00:35.889940 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:00:35.890096 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:00:35.896666 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.006 seconds
[0m11:00:35.897535 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:00:35.897829 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:00:35.900833 [debug] [MainThread]: Using postgres connection "master"
[0m11:00:35.901035 [debug] [MainThread]: On master: BEGIN
[0m11:00:35.901184 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:00:35.911748 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m11:00:35.911938 [debug] [MainThread]: Using postgres connection "master"
[0m11:00:35.912128 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:00:35.923508 [debug] [MainThread]: SQL status: SELECT 13 in 0.011 seconds
[0m11:00:35.924924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9976a714-9a1c-4586-b76a-0a038870116b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078c3ba0>]}
[0m11:00:35.925187 [debug] [MainThread]: On master: ROLLBACK
[0m11:00:35.925525 [debug] [MainThread]: Using postgres connection "master"
[0m11:00:35.925671 [debug] [MainThread]: On master: BEGIN
[0m11:00:35.926206 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:00:35.926357 [debug] [MainThread]: On master: COMMIT
[0m11:00:35.926495 [debug] [MainThread]: Using postgres connection "master"
[0m11:00:35.926630 [debug] [MainThread]: On master: COMMIT
[0m11:00:35.926935 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:00:35.927088 [debug] [MainThread]: On master: Close
[0m11:00:35.929378 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_customer_analytics
[0m11:00:35.929714 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_customer_analytics ................. [RUN]
[0m11:00:35.929988 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_customer_analytics)
[0m11:00:35.930192 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_customer_analytics
[0m11:00:35.934964 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_customer_analytics"
[0m11:00:35.935826 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_customer_analytics
[0m11:00:35.957036 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_customer_analytics"
[0m11:00:35.957994 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m11:00:35.958179 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: BEGIN
[0m11:00:35.958345 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:00:35.965607 [debug] [Thread-1 (]: SQL status: BEGIN in 0.007 seconds
[0m11:00:35.965819 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m11:00:35.966041 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_customer_analytics"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_customer_analytics__dbt_tmp"
  
  
    as
  
  (
    /*
    Customer analytics Summary Mart
    
    Business Purpose:
    - Track customer behavior and preferences
    - Monitor customer lifetime value (CLV)
    - Identify high-value customer segments

    Grain: One row per customer

    Key Metrics:
    - Total revenue
    - Order count
    - Average order value
    - Favourite product category
*/



WITH customer_first_info AS (
    SELECT DISTINCT
        customer_id,
        FIRST_VALUE(customer_city) OVER (
            PARTITION BY customer_id 
            ORDER BY order_purchase_timestamp
        ) AS customer_city,
        FIRST_VALUE(customer_state) OVER (
            PARTITION BY customer_id 
            ORDER BY order_purchase_timestamp  
        ) AS customer_state
    FROM "ecommerce_db"."analytics"."int_orders_joined"
),

category_counts AS (
    SELECT 
        customer_id,
        product_category_name_english,
        COUNT(*) as category_purchase_count,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY COUNT(*) DESC
        ) as category_rank
    FROM "ecommerce_db"."analytics"."int_orders_joined"
    GROUP BY customer_id, product_category_name_english
),

favorite_categories AS (
    SELECT 
        customer_id, 
        product_category_name_english AS favorite_category
    FROM category_counts
    WHERE category_rank = 1
)

SELECT
    base.customer_id,
    info.customer_city,
    info.customer_state,
    SUM(total_item_value) AS total_lifetime_revenue,
    COUNT(DISTINCT order_id) AS total_orders,
    SUM(total_item_value) / COUNT(DISTINCT order_id) AS avg_order_value,
    MIN(order_purchase_timestamp) AS first_order_date,
    MAX(order_purchase_timestamp) AS last_order_date,
    fav.favorite_category,
    CASE WHEN COUNT(DISTINCT order_id) > 1 THEN TRUE ELSE FALSE END AS is_repeat_customer

FROM "ecommerce_db"."analytics"."int_orders_joined" base
LEFT JOIN customer_first_info info ON base.customer_id = info.customer_id
LEFT JOIN favorite_categories fav ON base.customer_id = fav.customer_id
GROUP BY base.customer_id, info.customer_city, info.customer_state, fav.favorite_category
  );
  
[0m11:00:38.685074 [debug] [Thread-1 (]: SQL status: SELECT 98666 in 2.718 seconds
[0m11:00:38.698105 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m11:00:38.698701 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_customer_analytics"} */
alter table "ecommerce_db"."analytics"."mart_customer_analytics" rename to "mart_customer_analytics__dbt_backup"
[0m11:00:38.699529 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:00:38.701537 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m11:00:38.701762 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_customer_analytics"} */
alter table "ecommerce_db"."analytics"."mart_customer_analytics__dbt_tmp" rename to "mart_customer_analytics"
[0m11:00:38.702380 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:00:38.715582 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: COMMIT
[0m11:00:38.715992 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m11:00:38.716297 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: COMMIT
[0m11:00:38.718477 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m11:00:38.722397 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."mart_customer_analytics__dbt_backup"
[0m11:00:38.726494 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_customer_analytics"
[0m11:00:38.726807 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_customer_analytics"} */
drop table if exists "ecommerce_db"."analytics"."mart_customer_analytics__dbt_backup" cascade
[0m11:00:38.731546 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m11:00:38.733337 [debug] [Thread-1 (]: On model.ecom_analytics.mart_customer_analytics: Close
[0m11:00:38.734985 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9976a714-9a1c-4586-b76a-0a038870116b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a74350>]}
[0m11:00:38.735468 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.mart_customer_analytics ............ [[32mSELECT 98666[0m in 2.80s]
[0m11:00:38.735856 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_customer_analytics
[0m11:00:38.736716 [debug] [MainThread]: Using postgres connection "master"
[0m11:00:38.736962 [debug] [MainThread]: On master: BEGIN
[0m11:00:38.737149 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:00:38.741405 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m11:00:38.741657 [debug] [MainThread]: On master: COMMIT
[0m11:00:38.741842 [debug] [MainThread]: Using postgres connection "master"
[0m11:00:38.742010 [debug] [MainThread]: On master: COMMIT
[0m11:00:38.742277 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:00:38.742474 [debug] [MainThread]: On master: Close
[0m11:00:38.742721 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:00:38.742899 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_customer_analytics' was properly closed.
[0m11:00:38.743093 [info ] [MainThread]: 
[0m11:00:38.743292 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.96 seconds (2.96s).
[0m11:00:38.743719 [debug] [MainThread]: Command end result
[0m11:00:38.762186 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:00:38.763732 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:00:38.767691 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:00:38.767907 [info ] [MainThread]: 
[0m11:00:38.768140 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:00:38.768306 [info ] [MainThread]: 
[0m11:00:38.768487 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:00:38.770627 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.547099, "process_in_blocks": "0", "process_kernel_time": 0.303144, "process_mem_max_rss": "150716416", "process_out_blocks": "0", "process_user_time": 1.728242}
[0m11:00:38.770922 [debug] [MainThread]: Command `dbt run` succeeded at 11:00:38.770864 after 3.55 seconds
[0m11:00:38.771160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107772410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10775ab70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10775ac10>]}
[0m11:00:38.771387 [debug] [MainThread]: Flushing usage events
[0m11:00:39.487530 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:31:04.155496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cb4a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2fbc50>]}


============================== 11:31:04.159454 | 6d961875-a872-4ed5-af78-aba43f507a48 ==============================
[0m11:31:04.159454 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:31:04.159866 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'log_format': 'default', 'warn_error': 'None', 'quiet': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'version_check': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run --select mart_product_performance', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'empty': 'False', 'profiles_dir': '/Users/raramesh/.dbt', 'debug': 'False', 'partial_parse': 'True', 'no_print': 'None', 'use_colors': 'True', 'static_parser': 'True'}
[0m11:31:04.304706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6d961875-a872-4ed5-af78-aba43f507a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d30e650>]}
[0m11:31:04.337425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6d961875-a872-4ed5-af78-aba43f507a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e193bd0>]}
[0m11:31:04.338404 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:31:04.396794 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:31:04.480963 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m11:31:04.481457 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/marts/mart_product_performance.sql
[0m11:31:04.610299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6d961875-a872-4ed5-af78-aba43f507a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2f5050>]}
[0m11:31:04.646255 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:31:04.648372 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:31:04.670088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6d961875-a872-4ed5-af78-aba43f507a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea374d0>]}
[0m11:31:04.670374 [info ] [MainThread]: Found 11 models, 9 sources, 459 macros
[0m11:31:04.670552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d961875-a872-4ed5-af78-aba43f507a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f452a50>]}
[0m11:31:04.671461 [info ] [MainThread]: 
[0m11:31:04.671638 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:31:04.671772 [info ] [MainThread]: 
[0m11:31:04.672019 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:31:04.672457 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:31:04.742156 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:31:04.742519 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:31:04.742684 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:31:04.767770 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.025 seconds
[0m11:31:04.768632 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:31:04.771090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:31:04.774311 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:31:04.774532 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:31:04.774678 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:31:04.781577 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m11:31:04.781783 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:31:04.781951 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:31:04.792454 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.010 seconds
[0m11:31:04.793493 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:31:04.793871 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:31:04.797235 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:04.797456 [debug] [MainThread]: On master: BEGIN
[0m11:31:04.797644 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:31:04.804412 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:31:04.804616 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:04.804812 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:31:04.815185 [debug] [MainThread]: SQL status: SELECT 13 in 0.010 seconds
[0m11:31:04.816589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d961875-a872-4ed5-af78-aba43f507a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f94f930>]}
[0m11:31:04.816844 [debug] [MainThread]: On master: ROLLBACK
[0m11:31:04.817169 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:04.817313 [debug] [MainThread]: On master: BEGIN
[0m11:31:04.817736 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:31:04.817876 [debug] [MainThread]: On master: COMMIT
[0m11:31:04.818003 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:04.818128 [debug] [MainThread]: On master: COMMIT
[0m11:31:04.818422 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:31:04.818558 [debug] [MainThread]: On master: Close
[0m11:31:04.821380 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_product_performance
[0m11:31:04.821653 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_product_performance ................ [RUN]
[0m11:31:04.821874 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_product_performance)
[0m11:31:04.822048 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_product_performance
[0m11:31:04.826432 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_product_performance"
[0m11:31:04.827339 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_product_performance
[0m11:31:04.847109 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_product_performance"
[0m11:31:04.848014 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:04.848315 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: BEGIN
[0m11:31:04.848513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:31:04.864683 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m11:31:04.864938 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:04.865174 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_product_performance"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_product_performance__dbt_tmp"
  
  
    as
  
  (
    /*
    Product Performance Mart (Category Level)
    
    Business Purpose:
    - Analyze product category performance and revenue contribution
    - Identify top-performing categories for strategic focus
    - Support product portfolio optimization decisions
    - Enable category-level business intelligence and reporting

    Grain: One row per product category

    Key Metrics:
    - Total revenue and order volume per category
    - Customer reach and market penetration
    - Average pricing and profitability insights
    - Performance rankings for strategic prioritization
*/



SELECT
    -- Category identification
    product_category_name_english,
    
    -- Volume metrics
    COUNT(DISTINCT order_id) AS total_orders,
    COUNT(*) AS total_items_sold,
    COUNT(DISTINCT customer_id) AS unique_customers,
    
    -- Financial metrics  
    SUM(price) AS total_product_revenue,
    AVG(price) AS avg_product_price,
    SUM(total_item_value) AS total_revenue_with_shipping,
    SUM(freight_value) AS total_shipping_revenue,
    
    -- Customer behavior metrics
    ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id), 2) AS revenue_per_customer,
    ROUND(COUNT(*)::NUMERIC / COUNT(DISTINCT order_id), 2) AS avg_items_per_order,
    
    -- Performance rankings
    ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) AS revenue_rank,
    ROW_NUMBER() OVER (ORDER BY COUNT(DISTINCT order_id) DESC) AS order_volume_rank,
    ROW_NUMBER() OVER (ORDER BY COUNT(DISTINCT customer_id) DESC) AS customer_reach_rank,
    
    -- Business insights
    CASE 
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 5 THEN 'Top Performer'
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 15 THEN 'Strong Performer' 
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 30 THEN 'Average Performer'
        ELSE 'Focus Area'
    END AS performance_tier
    
FROM "ecommerce_db"."analytics"."int_orders_joined"
WHERE product_category_name_english IS NOT NULL
GROUP BY product_category_name_english
ORDER BY total_product_revenue DESC
  );
  
[0m11:31:04.867077 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function round(double precision, integer) does not exist
LINE 48:     ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id...
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m11:31:04.867268 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: ROLLBACK
[0m11:31:04.867567 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: Close
[0m11:31:04.875161 [debug] [Thread-1 (]: Database Error in model mart_product_performance (models/marts/mart_product_performance.sql)
  function round(double precision, integer) does not exist
  LINE 48:     ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_product_performance.sql
[0m11:31:04.876381 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d961875-a872-4ed5-af78-aba43f507a48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10faec7d0>]}
[0m11:31:04.876753 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_product_performance ....... [[31mERROR[0m in 0.05s]
[0m11:31:04.877084 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_product_performance
[0m11:31:04.877355 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_product_performance' to be skipped because of status 'error'.  Reason: Database Error in model mart_product_performance (models/marts/mart_product_performance.sql)
  function round(double precision, integer) does not exist
  LINE 48:     ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_product_performance.sql.
[0m11:31:04.878291 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:04.878449 [debug] [MainThread]: On master: BEGIN
[0m11:31:04.878576 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:31:04.885439 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:31:04.885679 [debug] [MainThread]: On master: COMMIT
[0m11:31:04.885828 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:04.885959 [debug] [MainThread]: On master: COMMIT
[0m11:31:04.886219 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:31:04.886348 [debug] [MainThread]: On master: Close
[0m11:31:04.886546 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:31:04.886672 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_product_performance' was properly closed.
[0m11:31:04.886827 [info ] [MainThread]: 
[0m11:31:04.886985 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m11:31:04.887309 [debug] [MainThread]: Command end result
[0m11:31:04.900154 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:31:04.901586 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:31:04.905380 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:31:04.905574 [info ] [MainThread]: 
[0m11:31:04.905788 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:31:04.905954 [info ] [MainThread]: 
[0m11:31:04.906149 [error] [MainThread]: [31mFailure in model mart_product_performance (models/marts/mart_product_performance.sql)[0m
[0m11:31:04.906393 [error] [MainThread]:   Database Error in model mart_product_performance (models/marts/mart_product_performance.sql)
  function round(double precision, integer) does not exist
  LINE 48:     ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_product_performance.sql
[0m11:31:04.906614 [info ] [MainThread]: 
[0m11:31:04.906789 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_product_performance.sql
[0m11:31:04.906923 [info ] [MainThread]: 
[0m11:31:04.907083 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:31:04.909093 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.81609327, "process_in_blocks": "0", "process_kernel_time": 0.320675, "process_mem_max_rss": "153567232", "process_out_blocks": "0", "process_user_time": 1.716838}
[0m11:31:04.909418 [debug] [MainThread]: Command `dbt run` failed at 11:31:04.909358 after 0.82 seconds
[0m11:31:04.909626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f626c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aef8eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa83b10>]}
[0m11:31:04.909817 [debug] [MainThread]: Flushing usage events
[0m11:31:05.591888 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:31:09.879348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cfa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080fbc50>]}


============================== 11:31:09.882698 | 6b5f9404-64cf-4ef5-b6c9-1d52f9c7f6dc ==============================
[0m11:31:09.882698 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:31:09.883047 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'debug': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run --select mart_product_performance', 'printer_width': '80', 'version_check': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error': 'None', 'target_path': 'None', 'partial_parse': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'write_json': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'static_parser': 'True'}
[0m11:31:09.998073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b5f9404-64cf-4ef5-b6c9-1d52f9c7f6dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10670a650>]}
[0m11:31:10.030366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b5f9404-64cf-4ef5-b6c9-1d52f9c7f6dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e93bd0>]}
[0m11:31:10.031496 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:31:10.087638 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:31:10.162225 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:31:10.162448 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:31:10.179543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b5f9404-64cf-4ef5-b6c9-1d52f9c7f6dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f45150>]}
[0m11:31:10.216368 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:31:10.217731 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:31:10.259762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b5f9404-64cf-4ef5-b6c9-1d52f9c7f6dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10870fe30>]}
[0m11:31:10.260120 [info ] [MainThread]: Found 11 models, 9 sources, 459 macros
[0m11:31:10.260312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b5f9404-64cf-4ef5-b6c9-1d52f9c7f6dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10921a5f0>]}
[0m11:31:10.261281 [info ] [MainThread]: 
[0m11:31:10.261536 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:31:10.261684 [info ] [MainThread]: 
[0m11:31:10.261949 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:31:10.262454 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:31:10.321181 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:31:10.321463 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:31:10.321624 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:31:10.346983 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.025 seconds
[0m11:31:10.347833 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:31:10.350272 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:31:10.353355 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:31:10.353562 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:31:10.353702 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:31:10.362716 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m11:31:10.362899 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:31:10.363053 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:31:10.370379 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.007 seconds
[0m11:31:10.371122 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:31:10.371465 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:31:10.374507 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:10.374686 [debug] [MainThread]: On master: BEGIN
[0m11:31:10.374834 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:31:10.383257 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m11:31:10.383436 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:10.383633 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:31:10.392279 [debug] [MainThread]: SQL status: SELECT 13 in 0.008 seconds
[0m11:31:10.393608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b5f9404-64cf-4ef5-b6c9-1d52f9c7f6dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109524870>]}
[0m11:31:10.393850 [debug] [MainThread]: On master: ROLLBACK
[0m11:31:10.394226 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:10.394379 [debug] [MainThread]: On master: BEGIN
[0m11:31:10.394829 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:31:10.394967 [debug] [MainThread]: On master: COMMIT
[0m11:31:10.395092 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:10.395215 [debug] [MainThread]: On master: COMMIT
[0m11:31:10.395449 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:31:10.395583 [debug] [MainThread]: On master: Close
[0m11:31:10.399881 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_product_performance
[0m11:31:10.400239 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_product_performance ................ [RUN]
[0m11:31:10.400489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_product_performance)
[0m11:31:10.400675 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_product_performance
[0m11:31:10.404999 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_product_performance"
[0m11:31:10.405592 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_product_performance
[0m11:31:10.426104 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_product_performance"
[0m11:31:10.426871 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:10.427044 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: BEGIN
[0m11:31:10.427201 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:31:10.441977 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m11:31:10.442196 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:10.442421 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_product_performance"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_product_performance__dbt_tmp"
  
  
    as
  
  (
    /*
    Product Performance Mart (Category Level)
    
    Business Purpose:
    - Analyze product category performance and revenue contribution
    - Identify top-performing categories for strategic focus
    - Support product portfolio optimization decisions
    - Enable category-level business intelligence and reporting

    Grain: One row per product category

    Key Metrics:
    - Total revenue and order volume per category
    - Customer reach and market penetration
    - Average pricing and profitability insights
    - Performance rankings for strategic prioritization
*/



SELECT
    -- Category identification
    product_category_name_english,
    
    -- Volume metrics
    COUNT(DISTINCT order_id) AS total_orders,
    COUNT(*) AS total_items_sold,
    COUNT(DISTINCT customer_id) AS unique_customers,
    
    -- Financial metrics  
    SUM(price) AS total_product_revenue,
    AVG(price) AS avg_product_price,
    SUM(total_item_value) AS total_revenue_with_shipping,
    SUM(freight_value) AS total_shipping_revenue,
    
    -- Customer behavior metrics
    ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id), 2) AS revenue_per_customer,
    ROUND(COUNT(*)::NUMERIC / COUNT(DISTINCT order_id), 2) AS avg_items_per_order,
    
    -- Performance rankings
    ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) AS revenue_rank,
    ROW_NUMBER() OVER (ORDER BY COUNT(DISTINCT order_id) DESC) AS order_volume_rank,
    ROW_NUMBER() OVER (ORDER BY COUNT(DISTINCT customer_id) DESC) AS customer_reach_rank,
    
    -- Business insights
    CASE 
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 5 THEN 'Top Performer'
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 15 THEN 'Strong Performer' 
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 30 THEN 'Average Performer'
        ELSE 'Focus Area'
    END AS performance_tier
    
FROM "ecommerce_db"."analytics"."int_orders_joined"
WHERE product_category_name_english IS NOT NULL
GROUP BY product_category_name_english
ORDER BY total_product_revenue DESC
  );
  
[0m11:31:10.445011 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function round(double precision, integer) does not exist
LINE 48:     ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id...
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m11:31:10.445195 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: ROLLBACK
[0m11:31:10.445523 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: Close
[0m11:31:10.454529 [debug] [Thread-1 (]: Database Error in model mart_product_performance (models/marts/mart_product_performance.sql)
  function round(double precision, integer) does not exist
  LINE 48:     ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_product_performance.sql
[0m11:31:10.455856 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b5f9404-64cf-4ef5-b6c9-1d52f9c7f6dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091f3f50>]}
[0m11:31:10.456239 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_product_performance ....... [[31mERROR[0m in 0.05s]
[0m11:31:10.456552 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_product_performance
[0m11:31:10.456824 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_product_performance' to be skipped because of status 'error'.  Reason: Database Error in model mart_product_performance (models/marts/mart_product_performance.sql)
  function round(double precision, integer) does not exist
  LINE 48:     ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_product_performance.sql.
[0m11:31:10.457748 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:10.457900 [debug] [MainThread]: On master: BEGIN
[0m11:31:10.458026 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:31:10.464599 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:31:10.464794 [debug] [MainThread]: On master: COMMIT
[0m11:31:10.464931 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:10.465057 [debug] [MainThread]: On master: COMMIT
[0m11:31:10.465450 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:31:10.465593 [debug] [MainThread]: On master: Close
[0m11:31:10.465778 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:31:10.465901 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_product_performance' was properly closed.
[0m11:31:10.466034 [info ] [MainThread]: 
[0m11:31:10.466183 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m11:31:10.466491 [debug] [MainThread]: Command end result
[0m11:31:10.480483 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:31:10.481923 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:31:10.485115 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:31:10.485290 [info ] [MainThread]: 
[0m11:31:10.485488 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:31:10.485659 [info ] [MainThread]: 
[0m11:31:10.485963 [error] [MainThread]: [31mFailure in model mart_product_performance (models/marts/mart_product_performance.sql)[0m
[0m11:31:10.486160 [error] [MainThread]:   Database Error in model mart_product_performance (models/marts/mart_product_performance.sql)
  function round(double precision, integer) does not exist
  LINE 48:     ROUND(SUM(total_item_value) / COUNT(DISTINCT customer_id...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/ecom_analytics/models/marts/mart_product_performance.sql
[0m11:31:10.486308 [info ] [MainThread]: 
[0m11:31:10.486463 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_product_performance.sql
[0m11:31:10.486586 [info ] [MainThread]: 
[0m11:31:10.486740 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:31:10.488721 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.65995914, "process_in_blocks": "0", "process_kernel_time": 0.259043, "process_mem_max_rss": "149716992", "process_out_blocks": "0", "process_user_time": 1.592648}
[0m11:31:10.489057 [debug] [MainThread]: Command `dbt run` failed at 11:31:10.489002 after 0.66 seconds
[0m11:31:10.489280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109491ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095c37f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095c2b70>]}
[0m11:31:10.489485 [debug] [MainThread]: Flushing usage events
[0m11:31:11.141358 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:31:28.429530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a32900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125f7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125f7c50>]}


============================== 11:31:28.432318 | 97bb4113-1b4f-4aa4-96ab-57302e7ed873 ==============================
[0m11:31:28.432318 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:31:28.432641 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/raramesh/.dbt', 'debug': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'version_check': 'True', 'log_format': 'default', 'no_print': 'None', 'warn_error': 'None', 'write_json': 'True', 'log_cache_events': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'invocation_command': 'dbt run --select mart_product_performance', 'target_path': 'None', 'use_colors': 'True', 'static_parser': 'True', 'introspect': 'True', 'fail_fast': 'False'}
[0m11:31:28.542432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '97bb4113-1b4f-4aa4-96ab-57302e7ed873', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11050e650>]}
[0m11:31:28.573628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '97bb4113-1b4f-4aa4-96ab-57302e7ed873', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11248fbd0>]}
[0m11:31:28.574363 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:31:28.627317 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:31:28.695631 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:31:28.696004 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_product_performance.sql
[0m11:31:28.817241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '97bb4113-1b4f-4aa4-96ab-57302e7ed873', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135f1050>]}
[0m11:31:28.851752 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:31:28.853241 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:31:28.878380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '97bb4113-1b4f-4aa4-96ab-57302e7ed873', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112d30140>]}
[0m11:31:28.878674 [info ] [MainThread]: Found 11 models, 9 sources, 459 macros
[0m11:31:28.878852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97bb4113-1b4f-4aa4-96ab-57302e7ed873', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113922270>]}
[0m11:31:28.879760 [info ] [MainThread]: 
[0m11:31:28.879951 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:31:28.880090 [info ] [MainThread]: 
[0m11:31:28.880337 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:31:28.880786 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:31:28.940356 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:31:28.940619 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:31:28.940777 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:31:28.964446 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.024 seconds
[0m11:31:28.965309 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:31:28.967791 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:31:28.970832 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:31:28.971013 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:31:28.971145 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:31:28.978649 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m11:31:28.978843 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:31:28.979001 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:31:28.985819 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.007 seconds
[0m11:31:28.986606 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:31:28.986910 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:31:28.989841 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:28.990010 [debug] [MainThread]: On master: BEGIN
[0m11:31:28.990142 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:31:28.996619 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m11:31:28.996811 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:28.997005 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:31:29.004549 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m11:31:29.005788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97bb4113-1b4f-4aa4-96ab-57302e7ed873', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d4b930>]}
[0m11:31:29.006016 [debug] [MainThread]: On master: ROLLBACK
[0m11:31:29.006299 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:29.006433 [debug] [MainThread]: On master: BEGIN
[0m11:31:29.006912 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:31:29.007056 [debug] [MainThread]: On master: COMMIT
[0m11:31:29.007182 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:29.007320 [debug] [MainThread]: On master: COMMIT
[0m11:31:29.007554 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:31:29.007690 [debug] [MainThread]: On master: Close
[0m11:31:29.009405 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_product_performance
[0m11:31:29.009676 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_product_performance ................ [RUN]
[0m11:31:29.009900 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_product_performance)
[0m11:31:29.010080 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_product_performance
[0m11:31:29.014489 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_product_performance"
[0m11:31:29.015100 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_product_performance
[0m11:31:29.036080 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_product_performance"
[0m11:31:29.037167 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:29.037414 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: BEGIN
[0m11:31:29.037585 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:31:29.046427 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m11:31:29.046621 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:29.046834 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_product_performance"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_product_performance__dbt_tmp"
  
  
    as
  
  (
    /*
    Product Performance Mart (Category Level)
    
    Business Purpose:
    - Analyze product category performance and revenue contribution
    - Identify top-performing categories for strategic focus
    - Support product portfolio optimization decisions
    - Enable category-level business intelligence and reporting

    Grain: One row per product category

    Key Metrics:
    - Total revenue and order volume per category
    - Customer reach and market penetration
    - Average pricing and profitability insights
    - Performance rankings for strategic prioritization
*/



SELECT
    -- Category identification
    product_category_name_english,
    
    -- Volume metrics
    COUNT(DISTINCT order_id) AS total_orders,
    COUNT(*) AS total_items_sold,
    COUNT(DISTINCT customer_id) AS unique_customers,
    
    -- Financial metrics  
    SUM(price) AS total_product_revenue,
    AVG(price) AS avg_product_price,
    SUM(total_item_value) AS total_revenue_with_shipping,
    SUM(freight_value) AS total_shipping_revenue,
    
    -- Customer behavior metrics
    ROUND(SUM(total_item_value)::NUMERIC / COUNT(DISTINCT customer_id), 2) AS revenue_per_customer,
    ROUND(COUNT(*)::NUMERIC / COUNT(DISTINCT order_id), 2) AS avg_items_per_order,
    
    -- Performance rankings
    ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) AS revenue_rank,
    ROW_NUMBER() OVER (ORDER BY COUNT(DISTINCT order_id) DESC) AS order_volume_rank,
    ROW_NUMBER() OVER (ORDER BY COUNT(DISTINCT customer_id) DESC) AS customer_reach_rank,
    
    -- Business insights
    CASE 
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 5 THEN 'Top Performer'
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 15 THEN 'Strong Performer' 
        WHEN ROW_NUMBER() OVER (ORDER BY SUM(price) DESC) <= 30 THEN 'Average Performer'
        ELSE 'Focus Area'
    END AS performance_tier
    
FROM "ecommerce_db"."analytics"."int_orders_joined"
WHERE product_category_name_english IS NOT NULL
GROUP BY product_category_name_english
ORDER BY total_product_revenue DESC
  );
  
[0m11:31:29.983303 [debug] [Thread-1 (]: SQL status: SELECT 71 in 0.935 seconds
[0m11:31:29.998319 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:29.998775 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_product_performance"} */
alter table "ecommerce_db"."analytics"."mart_product_performance__dbt_tmp" rename to "mart_product_performance"
[0m11:31:29.999787 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:31:30.009675 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: COMMIT
[0m11:31:30.010086 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:30.010394 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: COMMIT
[0m11:31:30.011317 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m11:31:30.014933 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."mart_product_performance__dbt_backup"
[0m11:31:30.017715 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_product_performance"
[0m11:31:30.018017 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_product_performance"} */
drop table if exists "ecommerce_db"."analytics"."mart_product_performance__dbt_backup" cascade
[0m11:31:30.018520 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.000 seconds
[0m11:31:30.019979 [debug] [Thread-1 (]: On model.ecom_analytics.mart_product_performance: Close
[0m11:31:30.021201 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97bb4113-1b4f-4aa4-96ab-57302e7ed873', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ef9010>]}
[0m11:31:30.021606 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.mart_product_performance ........... [[32mSELECT 71[0m in 1.01s]
[0m11:31:30.021949 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_product_performance
[0m11:31:30.022673 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:30.022871 [debug] [MainThread]: On master: BEGIN
[0m11:31:30.023035 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:31:30.027332 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m11:31:30.027613 [debug] [MainThread]: On master: COMMIT
[0m11:31:30.027817 [debug] [MainThread]: Using postgres connection "master"
[0m11:31:30.027979 [debug] [MainThread]: On master: COMMIT
[0m11:31:30.028249 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:31:30.028431 [debug] [MainThread]: On master: Close
[0m11:31:30.028660 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:31:30.028818 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_product_performance' was properly closed.
[0m11:31:30.028982 [info ] [MainThread]: 
[0m11:31:30.029163 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.15 seconds (1.15s).
[0m11:31:30.029531 [debug] [MainThread]: Command end result
[0m11:31:30.047482 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:31:30.049888 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:31:30.053749 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:31:30.053970 [info ] [MainThread]: 
[0m11:31:30.054200 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:31:30.054372 [info ] [MainThread]: 
[0m11:31:30.054561 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:31:30.056476 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.6803339, "process_in_blocks": "0", "process_kernel_time": 0.261725, "process_mem_max_rss": "154255360", "process_out_blocks": "0", "process_user_time": 1.703794}
[0m11:31:30.056765 [debug] [MainThread]: Command `dbt run` succeeded at 11:31:30.056706 after 1.68 seconds
[0m11:31:30.056984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113af2ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a66cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a66d50>]}
[0m11:31:30.057194 [debug] [MainThread]: Flushing usage events
[0m11:31:30.708459 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:51:13.997010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10794a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111fbc50>]}


============================== 11:51:14.000901 | ae83329c-7bf5-402f-a7de-30682b1b1e1e ==============================
[0m11:51:14.000901 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:51:14.001255 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_experimental_parser': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'empty': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'printer_width': '80', 'warn_error': 'None', 'profiles_dir': '/Users/raramesh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'invocation_command': 'dbt run --models mart_individual_products', 'write_json': 'True', 'log_format': 'default', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'debug': 'False', 'target_path': 'None', 'partial_parse': 'True', 'introspect': 'True', 'indirect_selection': 'eager'}
[0m11:51:14.001529 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m11:51:14.001716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ae83329c-7bf5-402f-a7de-30682b1b1e1e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111112c40>]}
[0m11:51:14.152873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae83329c-7bf5-402f-a7de-30682b1b1e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d93bd0>]}
[0m11:51:14.187051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ae83329c-7bf5-402f-a7de-30682b1b1e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111272950>]}
[0m11:51:14.188164 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:51:14.283992 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:51:14.375435 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m11:51:14.375869 [debug] [MainThread]: Partial parsing: added file: ecom_analytics://models/marts/mart_individual_products.sql
[0m11:51:14.505217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ae83329c-7bf5-402f-a7de-30682b1b1e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fef980>]}
[0m11:51:14.542241 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:51:14.544296 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:51:14.573527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ae83329c-7bf5-402f-a7de-30682b1b1e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111ff5b0>]}
[0m11:51:14.573805 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:51:14.573972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae83329c-7bf5-402f-a7de-30682b1b1e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132b28f0>]}
[0m11:51:14.574858 [info ] [MainThread]: 
[0m11:51:14.575031 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:51:14.575166 [info ] [MainThread]: 
[0m11:51:14.575402 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:51:14.575889 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:51:14.640129 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:51:14.640364 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:51:14.640499 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:51:14.668765 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.028 seconds
[0m11:51:14.669643 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:51:14.672186 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:51:14.675350 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:51:14.675550 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:51:14.675688 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:51:14.684308 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m11:51:14.684604 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:51:14.684797 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:51:14.691454 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.006 seconds
[0m11:51:14.692360 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:51:14.692693 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:51:14.695966 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:14.696178 [debug] [MainThread]: On master: BEGIN
[0m11:51:14.696320 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:51:14.706377 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m11:51:14.706584 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:14.706775 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:51:14.713572 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m11:51:14.715127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae83329c-7bf5-402f-a7de-30682b1b1e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135f0710>]}
[0m11:51:14.715371 [debug] [MainThread]: On master: ROLLBACK
[0m11:51:14.715716 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:14.715974 [debug] [MainThread]: On master: BEGIN
[0m11:51:14.716410 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:51:14.716570 [debug] [MainThread]: On master: COMMIT
[0m11:51:14.716708 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:14.716833 [debug] [MainThread]: On master: COMMIT
[0m11:51:14.717066 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:51:14.717231 [debug] [MainThread]: On master: Close
[0m11:51:14.719843 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_individual_products
[0m11:51:14.720254 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_individual_products ................ [RUN]
[0m11:51:14.720547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_individual_products)
[0m11:51:14.720772 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_individual_products
[0m11:51:14.724981 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_individual_products"
[0m11:51:14.726041 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_individual_products
[0m11:51:14.745796 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_individual_products"
[0m11:51:14.746715 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:51:14.746991 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: BEGIN
[0m11:51:14.747173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:51:14.755764 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m11:51:14.756040 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:51:14.756361 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp"
  
  
    as
  
  (
    -- Product-level performance mart
-- One row per product_id with detailed product metrics
WITH product_metrics AS (
    SELECT 
        p.product_id,
        p.product_category_name_english,
        p.product_name_length,
        p.product_description_length,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm,
        
        -- Order metrics
        COUNT(DISTINCT oj.order_id) as total_orders,
        COUNT(DISTINCT oj.customer_id) as unique_customers,
        SUM(oj.quantity) as total_quantity_sold,
        
        -- Revenue metrics  
        SUM(oj.total_item_value) as total_product_revenue,
        AVG(oj.price) as average_selling_price,
        AVG(oj.total_item_value) as average_order_value,
        
        -- Performance metrics
        AVG(oj.review_score) as average_review_score,
        COUNT(CASE WHEN oj.review_score >= 4 THEN 1 END) * 100.0 / COUNT(oj.review_score) as positive_review_percentage,
        
        -- Delivery metrics
        AVG(oj.delivery_days) as average_delivery_days,
        COUNT(CASE WHEN oj.is_late_delivery THEN 1 END) * 100.0 / COUNT(oj.order_id) as late_delivery_percentage,
        
        -- Time analysis
        MIN(oj.order_purchase_timestamp) as first_order_date,
        MAX(oj.order_purchase_timestamp) as last_order_date,
        
        -- Customer behavior
        AVG(oj.payment_value) as average_payment_value
        
    FROM "ecommerce_db"."analytics"."stg_products" p
    LEFT JOIN "ecommerce_db"."analytics"."int_orders_joined" oj 
        ON p.product_id = oj.product_id
    GROUP BY 
        p.product_id,
        p.product_category_name_english,
        p.product_name_length,
        p.product_description_length,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm
),

product_rankings AS (
    SELECT 
        *,
        -- Revenue rankings
        ROW_NUMBER() OVER (ORDER BY total_product_revenue DESC NULLS LAST) as revenue_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_product_revenue DESC NULLS LAST) as category_revenue_rank,
        
        -- Volume rankings
        ROW_NUMBER() OVER (ORDER BY total_quantity_sold DESC NULLS LAST) as volume_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_quantity_sold DESC NULLS LAST) as category_volume_rank,
        
        -- Quality rankings  
        ROW_NUMBER() OVER (ORDER BY average_review_score DESC NULLS LAST) as quality_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY average_review_score DESC NULLS LAST) as category_quality_rank,
        
        -- Performance tiers
        CASE 
            WHEN total_product_revenue >= 50000 THEN 'Star Product'
            WHEN total_product_revenue >= 10000 THEN 'Strong Performer'  
            WHEN total_product_revenue >= 1000 THEN 'Average Performer'
            WHEN total_product_revenue > 0 THEN 'Low Performer'
            ELSE 'No Sales'
        END as performance_tier
        
    FROM product_metrics
)

SELECT 
    product_id,
    product_category_name_english,
    
    -- Product attributes
    product_name_length,
    product_description_length, 
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm,
    
    -- Sales metrics
    total_orders,
    unique_customers,
    total_quantity_sold,
    
    -- Revenue metrics
    ROUND(total_product_revenue::NUMERIC, 2) as total_product_revenue,
    ROUND(average_selling_price::NUMERIC, 2) as average_selling_price,
    ROUND(average_order_value::NUMERIC, 2) as average_order_value,
    
    -- Quality metrics
    ROUND(average_review_score::NUMERIC, 2) as average_review_score,
    ROUND(positive_review_percentage::NUMERIC, 2) as positive_review_percentage,
    
    -- Delivery metrics  
    ROUND(average_delivery_days::NUMERIC, 1) as average_delivery_days,
    ROUND(late_delivery_percentage::NUMERIC, 2) as late_delivery_percentage,
    
    -- Time metrics
    first_order_date,
    last_order_date,
    ROUND(average_payment_value::NUMERIC, 2) as average_payment_value,
    
    -- Rankings
    revenue_rank,
    category_revenue_rank,
    volume_rank,
    category_volume_rank,
    quality_rank,
    category_quality_rank,
    
    -- Classification
    performance_tier
    
FROM product_rankings
ORDER BY revenue_rank
  );
  
[0m11:51:14.760306 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column p.product_category_name_english does not exist
LINE 17:         p.product_category_name_english,
                 ^
HINT:  Perhaps you meant to reference the column "oj.product_category_name_english".

[0m11:51:14.760611 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: ROLLBACK
[0m11:51:14.760960 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: Close
[0m11:51:14.769607 [debug] [Thread-1 (]: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column p.product_category_name_english does not exist
  LINE 17:         p.product_category_name_english,
                   ^
  HINT:  Perhaps you meant to reference the column "oj.product_category_name_english".
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:51:14.770902 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae83329c-7bf5-402f-a7de-30682b1b1e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132eedb0>]}
[0m11:51:14.771276 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_individual_products ....... [[31mERROR[0m in 0.05s]
[0m11:51:14.771584 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_individual_products
[0m11:51:14.771888 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_individual_products' to be skipped because of status 'error'.  Reason: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column p.product_category_name_english does not exist
  LINE 17:         p.product_category_name_english,
                   ^
  HINT:  Perhaps you meant to reference the column "oj.product_category_name_english".
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql.
[0m11:51:14.772891 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:14.773103 [debug] [MainThread]: On master: BEGIN
[0m11:51:14.773340 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:51:14.780607 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:51:14.780910 [debug] [MainThread]: On master: COMMIT
[0m11:51:14.781057 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:14.781230 [debug] [MainThread]: On master: COMMIT
[0m11:51:14.781532 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:51:14.781684 [debug] [MainThread]: On master: Close
[0m11:51:14.781887 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:51:14.782012 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_individual_products' was properly closed.
[0m11:51:14.782147 [info ] [MainThread]: 
[0m11:51:14.782295 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m11:51:14.782602 [debug] [MainThread]: Command end result
[0m11:51:14.795145 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:51:14.796609 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:51:14.800732 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:51:14.800985 [info ] [MainThread]: 
[0m11:51:14.801181 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:51:14.801359 [info ] [MainThread]: 
[0m11:51:14.801562 [error] [MainThread]: [31mFailure in model mart_individual_products (models/marts/mart_individual_products.sql)[0m
[0m11:51:14.801747 [error] [MainThread]:   Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column p.product_category_name_english does not exist
  LINE 17:         p.product_category_name_english,
                   ^
  HINT:  Perhaps you meant to reference the column "oj.product_category_name_english".
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:51:14.801883 [info ] [MainThread]: 
[0m11:51:14.802041 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:51:14.802169 [info ] [MainThread]: 
[0m11:51:14.802316 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:51:14.802581 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m11:51:14.804599 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8731908, "process_in_blocks": "0", "process_kernel_time": 0.319872, "process_mem_max_rss": "151601152", "process_out_blocks": "0", "process_user_time": 1.720097}
[0m11:51:14.804879 [debug] [MainThread]: Command `dbt run` failed at 11:51:14.804832 after 0.87 seconds
[0m11:51:14.805135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ceceb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134c70b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113243cd0>]}
[0m11:51:14.805317 [debug] [MainThread]: Flushing usage events
[0m11:51:15.510256 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:51:39.997359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044fe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a93d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a93c50>]}


============================== 11:51:40.000938 | fb9c4ba8-ce48-4ed0-a6ca-2ae650a2b39f ==============================
[0m11:51:40.000938 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:51:40.001291 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'log_format': 'default', 'cache_selected_only': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'empty': 'None', 'introspect': 'True', 'warn_error': 'None', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'debug': 'False', 'quiet': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'invocation_command': 'dbt show --models stg_products --limit 1', 'partial_parse': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'version_check': 'True', 'printer_width': '80'}
[0m11:51:40.001573 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
Usage of `--models`, `--model`, and `-m` is deprecated in favor of `--select` or
`-s`.
[0m11:51:40.001756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'fb9c4ba8-ce48-4ed0-a6ca-2ae650a2b39f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059aac40>]}
[0m11:51:40.123024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb9c4ba8-ce48-4ed0-a6ca-2ae650a2b39f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10592fbd0>]}
[0m11:51:40.155767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb9c4ba8-ce48-4ed0-a6ca-2ae650a2b39f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b0e950>]}
[0m11:51:40.171394 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:51:40.230491 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:51:40.305841 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:51:40.306135 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:51:40.322858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb9c4ba8-ce48-4ed0-a6ca-2ae650a2b39f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10692f110>]}
[0m11:51:40.358349 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:51:40.359955 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:51:40.362564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb9c4ba8-ce48-4ed0-a6ca-2ae650a2b39f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106afa7b0>]}
[0m11:51:40.362813 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:51:40.362988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb9c4ba8-ce48-4ed0-a6ca-2ae650a2b39f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b53ba0>]}
[0m11:51:40.363891 [info ] [MainThread]: 
[0m11:51:40.364076 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:51:40.364205 [info ] [MainThread]: 
[0m11:51:40.364494 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:51:40.366662 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m11:51:40.428429 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:51:40.428702 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:51:40.428850 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:51:40.452932 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m11:51:40.453200 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:51:40.453365 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:51:40.466324 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.013 seconds
[0m11:51:40.467266 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:51:40.467608 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:51:40.470866 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:40.471051 [debug] [MainThread]: On master: BEGIN
[0m11:51:40.471189 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:51:40.480795 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m11:51:40.480996 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:40.481276 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:51:40.488761 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m11:51:40.490076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb9c4ba8-ce48-4ed0-a6ca-2ae650a2b39f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b63a10>]}
[0m11:51:40.490331 [debug] [MainThread]: On master: ROLLBACK
[0m11:51:40.490619 [debug] [MainThread]: On master: Close
[0m11:51:40.492343 [debug] [Thread-1 (]: Began running node model.ecom_analytics.stg_products
[0m11:51:40.492599 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.stg_products)
[0m11:51:40.492794 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.stg_products
[0m11:51:40.497161 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.stg_products"
[0m11:51:40.497921 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.stg_products
[0m11:51:40.501455 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.stg_products"
[0m11:51:40.501674 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.stg_products"} */

  
  /*
    Staging model for products table
    - Cleans and standardizes raw products data
*/

SELECT
    -- primary key
    product_id,
    -- business columns
    product_category_name,
    product_name_lenght,
    product_description_lenght,
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm

FROM "ecommerce_db"."public"."products"
  
  limit 1

[0m11:51:40.501856 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:51:40.509008 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.007 seconds
[0m11:51:40.510298 [debug] [Thread-1 (]: On model.ecom_analytics.stg_products: Close
[0m11:51:40.510711 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.stg_products
[0m11:51:40.511327 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:51:40.511482 [debug] [MainThread]: Connection 'model.ecom_analytics.stg_products' was properly closed.
[0m11:51:40.511804 [debug] [MainThread]: Command end result
[0m11:51:40.524437 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:51:40.525731 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:51:40.529338 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:51:40.529788 [info ] [MainThread]: Previewing node 'stg_products':
| product_id           | product_category_... | product_name_lenght | product_descripti... | product_photos_qty | product_weight_g | ... |
| -------------------- | -------------------- | ------------------- | -------------------- | ------------------ | ---------------- | --- |
| 1e9e8ef04dbcff454... | perfumaria           |                  40 |                  287 |                  1 |              225 | ... |

[0m11:51:40.530126 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- ModelParamUsageDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m11:51:40.532177 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 0.5837367, "process_in_blocks": "0", "process_kernel_time": 0.281281, "process_mem_max_rss": "146554880", "process_out_blocks": "0", "process_user_time": 1.560461}
[0m11:51:40.532473 [debug] [MainThread]: Command `dbt show` succeeded at 11:51:40.532423 after 0.58 seconds
[0m11:51:40.532684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c15ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e868f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e86850>]}
[0m11:51:40.532875 [debug] [MainThread]: Flushing usage events
[0m11:51:41.126037 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:51:49.372470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a64a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5fbc50>]}


============================== 11:51:49.375336 | b115eeb9-4236-4da3-9946-9a255869ad1e ==============================
[0m11:51:49.375336 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:51:49.375680 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'target_path': 'None', 'quiet': 'False', 'invocation_command': 'dbt show --select int_orders_joined --limit 1', 'write_json': 'True', 'version_check': 'True', 'fail_fast': 'False', 'empty': 'None', 'profiles_dir': '/Users/raramesh/.dbt', 'use_colors': 'True', 'no_print': 'None', 'warn_error': 'None', 'static_parser': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'partial_parse': 'True'}
[0m11:51:49.483921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b115eeb9-4236-4da3-9946-9a255869ad1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac0e650>]}
[0m11:51:49.515581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b115eeb9-4236-4da3-9946-9a255869ad1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c48fbd0>]}
[0m11:51:49.526869 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:51:49.580072 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:51:49.646689 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:51:49.646966 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:51:49.663923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b115eeb9-4236-4da3-9946-9a255869ad1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8fd050>]}
[0m11:51:49.699629 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:51:49.700992 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:51:49.705403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b115eeb9-4236-4da3-9946-9a255869ad1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc87e30>]}
[0m11:51:49.705675 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:51:49.705852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b115eeb9-4236-4da3-9946-9a255869ad1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8d9b70>]}
[0m11:51:49.706822 [info ] [MainThread]: 
[0m11:51:49.707005 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:51:49.707141 [info ] [MainThread]: 
[0m11:51:49.707404 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:51:49.709519 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m11:51:49.776477 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:51:49.776757 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:51:49.777014 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:51:49.794584 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m11:51:49.794853 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:51:49.795012 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:51:49.802146 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.007 seconds
[0m11:51:49.803024 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:51:49.803331 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:51:49.806445 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:49.806629 [debug] [MainThread]: On master: BEGIN
[0m11:51:49.806763 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:51:49.814618 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m11:51:49.814790 [debug] [MainThread]: Using postgres connection "master"
[0m11:51:49.814975 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:51:49.824910 [debug] [MainThread]: SQL status: SELECT 13 in 0.010 seconds
[0m11:51:49.826197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b115eeb9-4236-4da3-9946-9a255869ad1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dcb0050>]}
[0m11:51:49.826428 [debug] [MainThread]: On master: ROLLBACK
[0m11:51:49.826712 [debug] [MainThread]: On master: Close
[0m11:51:49.828210 [debug] [Thread-1 (]: Began running node model.ecom_analytics.int_orders_joined
[0m11:51:49.828467 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.int_orders_joined)
[0m11:51:49.828658 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.int_orders_joined
[0m11:51:49.833798 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.int_orders_joined"
[0m11:51:49.835431 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.int_orders_joined
[0m11:51:49.838912 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.int_orders_joined"
[0m11:51:49.839203 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.int_orders_joined"} */

  
  /*
    Intermediate model joining core business entities
    - Combines orders, order items, customers, products, sellers, and category translations
    - Creates wide analytical dataset at order line item grain
    - Foundation for business analytics and reporting
    - Includes calculated fields for business insights
*/

WITH order_base AS (
    SELECT
        -- Order information
        order_id,
        customer_id,
        order_status,
        order_purchase_timestamp,
        order_approved_at,
        order_delivered_carrier_date,
        order_delivered_customer_date,
        order_estimated_delivery_date
    FROM "ecommerce_db"."analytics"."stg_orders"
),

order_items_base AS (
    SELECT
        order_id,
        order_item_id,
        product_id,
        seller_id,
        shipping_limit_date,
        price,
        freight_value
    FROM "ecommerce_db"."analytics"."stg_order_items"
),

customers_base AS (
    SELECT
        customer_id,
        customer_unique_id,
        customer_zip_code_prefix,
        customer_city,
        customer_state
    FROM "ecommerce_db"."analytics"."stg_customers"
),

products_base AS (
    SELECT
        product_id,
        product_category_name,
        product_name_lenght,
        product_description_lenght,
        product_photos_qty,
        product_weight_g,
        product_length_cm,
        product_height_cm,
        product_width_cm
    FROM "ecommerce_db"."analytics"."stg_products"
),

sellers_base AS (
    SELECT
        seller_id,
        seller_zip_code_prefix,
        seller_city,
        seller_state
    FROM "ecommerce_db"."analytics"."stg_sellers"
),

category_translation AS (
    SELECT
        product_category_name,
        product_category_name_english
    FROM "ecommerce_db"."analytics"."stg_product_category_name_translation"
)

SELECT
    -- Order identifiers
    oi.order_id,
    oi.order_item_id,
    
    -- Order details
    o.order_status,
    o.order_purchase_timestamp,
    o.order_approved_at,
    o.order_delivered_carrier_date,
    o.order_delivered_customer_date,
    o.order_estimated_delivery_date,
    
    -- Customer information
    o.customer_id,
    c.customer_unique_id,
    c.customer_city,
    c.customer_state,
    c.customer_zip_code_prefix,
    
    -- Product information
    oi.product_id,
    p.product_category_name,
    ct.product_category_name_english,
    p.product_weight_g,
    p.product_length_cm,
    p.product_height_cm,
    p.product_width_cm,
    p.product_photos_qty,
    
    -- Seller information
    oi.seller_id,
    s.seller_city,
    s.seller_state,
    s.seller_zip_code_prefix AS seller_zip_code_prefix,
    
    -- Financial information
    oi.price,
    oi.freight_value,
    oi.shipping_limit_date,
    
    -- Calculated fields
    (oi.price + oi.freight_value) AS total_item_value,
    
    CASE 
        WHEN o.order_delivered_customer_date IS NOT NULL 
             AND o.order_purchase_timestamp IS NOT NULL
        THEN EXTRACT(DAY FROM (o.order_delivered_customer_date - o.order_purchase_timestamp))
        ELSE NULL
    END AS delivery_days,
    
    CASE 
        WHEN o.order_delivered_customer_date > o.order_estimated_delivery_date
        THEN TRUE
        ELSE FALSE
    END AS is_late_delivery

FROM order_items_base oi
LEFT JOIN order_base o ON oi.order_id = o.order_id
LEFT JOIN customers_base c ON o.customer_id = c.customer_id
LEFT JOIN products_base p ON oi.product_id = p.product_id
LEFT JOIN category_translation ct ON p.product_category_name = ct.product_category_name
LEFT JOIN sellers_base s ON oi.seller_id = s.seller_id
  
  limit 1

[0m11:51:49.839466 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:51:49.962748 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.123 seconds
[0m11:51:49.964468 [debug] [Thread-1 (]: On model.ecom_analytics.int_orders_joined: Close
[0m11:51:49.964946 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.int_orders_joined
[0m11:51:49.965685 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:51:49.965857 [debug] [MainThread]: Connection 'model.ecom_analytics.int_orders_joined' was properly closed.
[0m11:51:49.966189 [debug] [MainThread]: Command end result
[0m11:51:49.982292 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:51:49.983928 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:51:49.988754 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:51:49.989090 [info ] [MainThread]: Previewing node 'int_orders_joined':
| order_id             | order_item_id | order_status | order_purchase_ti... |   order_approved_at | order_delivered_c... | ... |
| -------------------- | ------------- | ------------ | -------------------- | ------------------- | -------------------- | --- |
| 00010242fe8c5a6d1... |             1 | delivered    |  2017-09-13 08:59:02 | 2017-09-13 09:45:35 |  2017-09-19 18:34:16 | ... |

[0m11:51:49.991889 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 0.6703631, "process_in_blocks": "0", "process_kernel_time": 0.25928, "process_mem_max_rss": "148930560", "process_out_blocks": "0", "process_user_time": 1.564984}
[0m11:51:49.992208 [debug] [MainThread]: Command `dbt show` succeeded at 11:51:49.992154 after 0.67 seconds
[0m11:51:49.992466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5ec590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9f5e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9f5c80>]}
[0m11:51:49.992683 [debug] [MainThread]: Flushing usage events
[0m11:51:50.467836 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:52:22.244850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9f6900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7f7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7f7c50>]}


============================== 11:52:22.249008 | 4dcdd80f-570a-4771-b9ce-ab6971fe603c ==============================
[0m11:52:22.249008 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:52:22.249512 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'log_cache_events': 'False', 'invocation_command': 'dbt run --select mart_individual_products', 'partial_parse': 'True', 'target_path': 'None', 'empty': 'False', 'introspect': 'True', 'warn_error': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'use_colors': 'True', 'quiet': 'False', 'static_parser': 'True', 'version_check': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'write_json': 'True'}
[0m11:52:22.376362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4dcdd80f-570a-4771-b9ce-ab6971fe603c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c50a650>]}
[0m11:52:22.410378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4dcdd80f-570a-4771-b9ce-ab6971fe603c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d48fbd0>]}
[0m11:52:22.414079 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:52:22.473776 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:52:22.550041 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:52:22.550460 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_individual_products.sql
[0m11:52:22.675074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4dcdd80f-570a-4771-b9ce-ab6971fe603c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e749050>]}
[0m11:52:22.713442 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:52:22.715817 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:52:22.736686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4dcdd80f-570a-4771-b9ce-ab6971fe603c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de88140>]}
[0m11:52:22.736984 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:52:22.737163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4dcdd80f-570a-4771-b9ce-ab6971fe603c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8a51d0>]}
[0m11:52:22.738077 [info ] [MainThread]: 
[0m11:52:22.738260 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:52:22.738401 [info ] [MainThread]: 
[0m11:52:22.738649 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:52:22.739083 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:52:22.804200 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:52:22.804478 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:52:22.804640 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:52:22.829247 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.025 seconds
[0m11:52:22.830117 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:52:22.832864 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:52:22.835949 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:52:22.836183 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:52:22.836322 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:52:22.843099 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m11:52:22.843320 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:52:22.843478 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:52:22.847653 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.004 seconds
[0m11:52:22.848493 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:52:22.848828 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:52:22.852081 [debug] [MainThread]: Using postgres connection "master"
[0m11:52:22.852331 [debug] [MainThread]: On master: BEGIN
[0m11:52:22.852465 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:52:22.858543 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m11:52:22.858765 [debug] [MainThread]: Using postgres connection "master"
[0m11:52:22.858953 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:52:22.868429 [debug] [MainThread]: SQL status: SELECT 13 in 0.009 seconds
[0m11:52:22.869765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4dcdd80f-570a-4771-b9ce-ab6971fe603c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ebdb5f0>]}
[0m11:52:22.869999 [debug] [MainThread]: On master: ROLLBACK
[0m11:52:22.870287 [debug] [MainThread]: Using postgres connection "master"
[0m11:52:22.870429 [debug] [MainThread]: On master: BEGIN
[0m11:52:22.870798 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:52:22.870932 [debug] [MainThread]: On master: COMMIT
[0m11:52:22.871055 [debug] [MainThread]: Using postgres connection "master"
[0m11:52:22.871173 [debug] [MainThread]: On master: COMMIT
[0m11:52:22.871381 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:52:22.871517 [debug] [MainThread]: On master: Close
[0m11:52:22.874064 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_individual_products
[0m11:52:22.874363 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_individual_products ................ [RUN]
[0m11:52:22.874589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_individual_products)
[0m11:52:22.874756 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_individual_products
[0m11:52:22.879046 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_individual_products"
[0m11:52:22.879834 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_individual_products
[0m11:52:22.899516 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_individual_products"
[0m11:52:22.900481 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:52:22.900746 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: BEGIN
[0m11:52:22.900937 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:52:22.912584 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m11:52:22.912834 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:52:22.913121 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp"
  
  
    as
  
  (
    -- Product-level performance mart
-- One row per product_id with detailed product metrics
WITH product_metrics AS (
    SELECT 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_length,
        p.product_description_length,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm,
        
        -- Order metrics
        COUNT(DISTINCT oj.order_id) as total_orders,
        COUNT(DISTINCT oj.customer_id) as unique_customers,
        SUM(oj.quantity) as total_quantity_sold,
        
        -- Revenue metrics  
        SUM(oj.total_item_value) as total_product_revenue,
        AVG(oj.price) as average_selling_price,
        AVG(oj.total_item_value) as average_order_value,
        
        -- Performance metrics
        AVG(oj.review_score) as average_review_score,
        COUNT(CASE WHEN oj.review_score >= 4 THEN 1 END) * 100.0 / COUNT(oj.review_score) as positive_review_percentage,
        
        -- Delivery metrics
        AVG(oj.delivery_days) as average_delivery_days,
        COUNT(CASE WHEN oj.is_late_delivery THEN 1 END) * 100.0 / COUNT(oj.order_id) as late_delivery_percentage,
        
        -- Time analysis
        MIN(oj.order_purchase_timestamp) as first_order_date,
        MAX(oj.order_purchase_timestamp) as last_order_date,
        
        -- Customer behavior
        AVG(oj.payment_value) as average_payment_value
        
    FROM "ecommerce_db"."analytics"."stg_products" p
    LEFT JOIN "ecommerce_db"."analytics"."int_orders_joined" oj 
        ON p.product_id = oj.product_id
    GROUP BY 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_length,
        p.product_description_length,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm
),

product_rankings AS (
    SELECT 
        *,
        -- Revenue rankings
        ROW_NUMBER() OVER (ORDER BY total_product_revenue DESC NULLS LAST) as revenue_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_product_revenue DESC NULLS LAST) as category_revenue_rank,
        
        -- Volume rankings
        ROW_NUMBER() OVER (ORDER BY total_quantity_sold DESC NULLS LAST) as volume_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_quantity_sold DESC NULLS LAST) as category_volume_rank,
        
        -- Quality rankings  
        ROW_NUMBER() OVER (ORDER BY average_review_score DESC NULLS LAST) as quality_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY average_review_score DESC NULLS LAST) as category_quality_rank,
        
        -- Performance tiers
        CASE 
            WHEN total_product_revenue >= 50000 THEN 'Star Product'
            WHEN total_product_revenue >= 10000 THEN 'Strong Performer'  
            WHEN total_product_revenue >= 1000 THEN 'Average Performer'
            WHEN total_product_revenue > 0 THEN 'Low Performer'
            ELSE 'No Sales'
        END as performance_tier
        
    FROM product_metrics
)

SELECT 
    product_id,
    product_category_name_english,
    
    -- Product attributes
    product_name_length,
    product_description_length, 
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm,
    
    -- Sales metrics
    total_orders,
    unique_customers,
    total_quantity_sold,
    
    -- Revenue metrics
    ROUND(total_product_revenue::NUMERIC, 2) as total_product_revenue,
    ROUND(average_selling_price::NUMERIC, 2) as average_selling_price,
    ROUND(average_order_value::NUMERIC, 2) as average_order_value,
    
    -- Quality metrics
    ROUND(average_review_score::NUMERIC, 2) as average_review_score,
    ROUND(positive_review_percentage::NUMERIC, 2) as positive_review_percentage,
    
    -- Delivery metrics  
    ROUND(average_delivery_days::NUMERIC, 1) as average_delivery_days,
    ROUND(late_delivery_percentage::NUMERIC, 2) as late_delivery_percentage,
    
    -- Time metrics
    first_order_date,
    last_order_date,
    ROUND(average_payment_value::NUMERIC, 2) as average_payment_value,
    
    -- Rankings
    revenue_rank,
    category_revenue_rank,
    volume_rank,
    category_volume_rank,
    quality_rank,
    category_quality_rank,
    
    -- Classification
    performance_tier
    
FROM product_rankings
ORDER BY revenue_rank
  );
  
[0m11:52:22.914826 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column p.product_name_length does not exist
LINE 18:         p.product_name_length,
                 ^
HINT:  Perhaps you meant to reference the column "p.product_name_lenght".

[0m11:52:22.915015 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: ROLLBACK
[0m11:52:22.915354 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: Close
[0m11:52:22.923535 [debug] [Thread-1 (]: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column p.product_name_length does not exist
  LINE 18:         p.product_name_length,
                   ^
  HINT:  Perhaps you meant to reference the column "p.product_name_lenght".
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:52:22.924827 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dcdd80f-570a-4771-b9ce-ab6971fe603c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed7c710>]}
[0m11:52:22.925209 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_individual_products ....... [[31mERROR[0m in 0.05s]
[0m11:52:22.925515 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_individual_products
[0m11:52:22.925796 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_individual_products' to be skipped because of status 'error'.  Reason: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column p.product_name_length does not exist
  LINE 18:         p.product_name_length,
                   ^
  HINT:  Perhaps you meant to reference the column "p.product_name_lenght".
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql.
[0m11:52:22.926712 [debug] [MainThread]: Using postgres connection "master"
[0m11:52:22.926882 [debug] [MainThread]: On master: BEGIN
[0m11:52:22.927013 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:52:22.933237 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m11:52:22.933441 [debug] [MainThread]: On master: COMMIT
[0m11:52:22.933578 [debug] [MainThread]: Using postgres connection "master"
[0m11:52:22.933701 [debug] [MainThread]: On master: COMMIT
[0m11:52:22.933923 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:52:22.934081 [debug] [MainThread]: On master: Close
[0m11:52:22.934278 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:52:22.934406 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_individual_products' was properly closed.
[0m11:52:22.934547 [info ] [MainThread]: 
[0m11:52:22.934702 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m11:52:22.935027 [debug] [MainThread]: Command end result
[0m11:52:22.947961 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:52:22.949617 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:52:22.953727 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:52:22.953983 [info ] [MainThread]: 
[0m11:52:22.954217 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:52:22.954440 [info ] [MainThread]: 
[0m11:52:22.954685 [error] [MainThread]: [31mFailure in model mart_individual_products (models/marts/mart_individual_products.sql)[0m
[0m11:52:22.954895 [error] [MainThread]:   Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column p.product_name_length does not exist
  LINE 18:         p.product_name_length,
                   ^
  HINT:  Perhaps you meant to reference the column "p.product_name_lenght".
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:52:22.955056 [info ] [MainThread]: 
[0m11:52:22.955229 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:52:22.955367 [info ] [MainThread]: 
[0m11:52:22.955537 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:52:22.957643 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.77037114, "process_in_blocks": "0", "process_kernel_time": 0.296483, "process_mem_max_rss": "153419776", "process_out_blocks": "0", "process_user_time": 1.714857}
[0m11:52:22.957917 [debug] [MainThread]: Command `dbt run` failed at 11:52:22.957873 after 0.77 seconds
[0m11:52:22.958131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea76d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2fceb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed0b890>]}
[0m11:52:22.958329 [debug] [MainThread]: Flushing usage events
[0m11:52:23.502170 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:53:02.431511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106236900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077fbc50>]}


============================== 11:53:02.436870 | 9b1b3a0d-e0f6-4a7b-9c47-4474b6150a06 ==============================
[0m11:53:02.436870 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:53:02.437248 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False', 'debug': 'False', 'log_format': 'default', 'write_json': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'empty': 'False', 'static_parser': 'True', 'quiet': 'False', 'version_check': 'True', 'use_colors': 'True', 'warn_error': 'None', 'invocation_command': 'dbt run --select mart_individual_products', 'introspect': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/raramesh/.dbt', 'printer_width': '80'}
[0m11:53:02.556195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9b1b3a0d-e0f6-4a7b-9c47-4474b6150a06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10660a650>]}
[0m11:53:02.589012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9b1b3a0d-e0f6-4a7b-9c47-4474b6150a06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10768fbd0>]}
[0m11:53:02.590119 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:53:02.647372 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:53:02.728709 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:53:02.729145 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_individual_products.sql
[0m11:53:02.858384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9b1b3a0d-e0f6-4a7b-9c47-4474b6150a06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a51050>]}
[0m11:53:02.896849 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:53:02.898825 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:53:02.922798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9b1b3a0d-e0f6-4a7b-9c47-4474b6150a06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f34140>]}
[0m11:53:02.923152 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:53:02.923337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b1b3a0d-e0f6-4a7b-9c47-4474b6150a06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bad1d0>]}
[0m11:53:02.924327 [info ] [MainThread]: 
[0m11:53:02.924542 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:53:02.924690 [info ] [MainThread]: 
[0m11:53:02.924943 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:53:02.925388 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:53:02.995304 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:53:02.995592 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:53:02.995757 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:53:03.016183 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.020 seconds
[0m11:53:03.017066 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:53:03.019809 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:53:03.022989 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:53:03.023220 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:53:03.023369 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:53:03.032162 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m11:53:03.032369 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:53:03.032514 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:53:03.038013 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.005 seconds
[0m11:53:03.038835 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:53:03.039135 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:53:03.042203 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:03.042373 [debug] [MainThread]: On master: BEGIN
[0m11:53:03.042503 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:53:03.049821 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:53:03.049984 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:03.050159 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:53:03.055442 [debug] [MainThread]: SQL status: SELECT 13 in 0.005 seconds
[0m11:53:03.056699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b1b3a0d-e0f6-4a7b-9c47-4474b6150a06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110edb5f0>]}
[0m11:53:03.056931 [debug] [MainThread]: On master: ROLLBACK
[0m11:53:03.057244 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:03.057373 [debug] [MainThread]: On master: BEGIN
[0m11:53:03.057727 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:53:03.057898 [debug] [MainThread]: On master: COMMIT
[0m11:53:03.058040 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:03.058166 [debug] [MainThread]: On master: COMMIT
[0m11:53:03.058392 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:53:03.058532 [debug] [MainThread]: On master: Close
[0m11:53:03.060726 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_individual_products
[0m11:53:03.061035 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_individual_products ................ [RUN]
[0m11:53:03.061281 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_individual_products)
[0m11:53:03.061462 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_individual_products
[0m11:53:03.065682 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_individual_products"
[0m11:53:03.066322 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_individual_products
[0m11:53:03.086765 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_individual_products"
[0m11:53:03.087563 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:53:03.087771 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: BEGIN
[0m11:53:03.087951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:53:03.101590 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m11:53:03.101863 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:53:03.102176 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp"
  
  
    as
  
  (
    -- Product-level performance mart
-- One row per product_id with detailed product metrics
WITH product_metrics AS (
    SELECT 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm,
        
        -- Order metrics
        COUNT(DISTINCT oj.order_id) as total_orders,
        COUNT(DISTINCT oj.customer_id) as unique_customers,
        SUM(oj.quantity) as total_quantity_sold,
        
        -- Revenue metrics  
        SUM(oj.total_item_value) as total_product_revenue,
        AVG(oj.price) as average_selling_price,
        AVG(oj.total_item_value) as average_order_value,
        
        -- Performance metrics
        AVG(oj.review_score) as average_review_score,
        COUNT(CASE WHEN oj.review_score >= 4 THEN 1 END) * 100.0 / COUNT(oj.review_score) as positive_review_percentage,
        
        -- Delivery metrics
        AVG(oj.delivery_days) as average_delivery_days,
        COUNT(CASE WHEN oj.is_late_delivery THEN 1 END) * 100.0 / COUNT(oj.order_id) as late_delivery_percentage,
        
        -- Time analysis
        MIN(oj.order_purchase_timestamp) as first_order_date,
        MAX(oj.order_purchase_timestamp) as last_order_date,
        
        -- Customer behavior
        AVG(oj.payment_value) as average_payment_value
        
    FROM "ecommerce_db"."analytics"."stg_products" p
    LEFT JOIN "ecommerce_db"."analytics"."int_orders_joined" oj 
        ON p.product_id = oj.product_id
    GROUP BY 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm
),

product_rankings AS (
    SELECT 
        *,
        -- Revenue rankings
        ROW_NUMBER() OVER (ORDER BY total_product_revenue DESC NULLS LAST) as revenue_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_product_revenue DESC NULLS LAST) as category_revenue_rank,
        
        -- Volume rankings
        ROW_NUMBER() OVER (ORDER BY total_quantity_sold DESC NULLS LAST) as volume_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_quantity_sold DESC NULLS LAST) as category_volume_rank,
        
        -- Quality rankings  
        ROW_NUMBER() OVER (ORDER BY average_review_score DESC NULLS LAST) as quality_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY average_review_score DESC NULLS LAST) as category_quality_rank,
        
        -- Performance tiers
        CASE 
            WHEN total_product_revenue >= 50000 THEN 'Star Product'
            WHEN total_product_revenue >= 10000 THEN 'Strong Performer'  
            WHEN total_product_revenue >= 1000 THEN 'Average Performer'
            WHEN total_product_revenue > 0 THEN 'Low Performer'
            ELSE 'No Sales'
        END as performance_tier
        
    FROM product_metrics
)

SELECT 
    product_id,
    product_category_name_english,
    
    -- Product attributes
    product_name_lenght,
    product_description_lenght, 
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm,
    
    -- Sales metrics
    total_orders,
    unique_customers,
    total_quantity_sold,
    
    -- Revenue metrics
    ROUND(total_product_revenue::NUMERIC, 2) as total_product_revenue,
    ROUND(average_selling_price::NUMERIC, 2) as average_selling_price,
    ROUND(average_order_value::NUMERIC, 2) as average_order_value,
    
    -- Quality metrics
    ROUND(average_review_score::NUMERIC, 2) as average_review_score,
    ROUND(positive_review_percentage::NUMERIC, 2) as positive_review_percentage,
    
    -- Delivery metrics  
    ROUND(average_delivery_days::NUMERIC, 1) as average_delivery_days,
    ROUND(late_delivery_percentage::NUMERIC, 2) as late_delivery_percentage,
    
    -- Time metrics
    first_order_date,
    last_order_date,
    ROUND(average_payment_value::NUMERIC, 2) as average_payment_value,
    
    -- Rankings
    revenue_rank,
    category_revenue_rank,
    volume_rank,
    category_volume_rank,
    quality_rank,
    category_quality_rank,
    
    -- Classification
    performance_tier
    
FROM product_rankings
ORDER BY revenue_rank
  );
  
[0m11:53:03.104434 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column oj.quantity does not exist
LINE 29:         SUM(oj.quantity) as total_quantity_sold,
                     ^

[0m11:53:03.104633 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: ROLLBACK
[0m11:53:03.104954 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: Close
[0m11:53:03.111578 [debug] [Thread-1 (]: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.quantity does not exist
  LINE 29:         SUM(oj.quantity) as total_quantity_sold,
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:53:03.112875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b1b3a0d-e0f6-4a7b-9c47-4474b6150a06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118f4710>]}
[0m11:53:03.113231 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_individual_products ....... [[31mERROR[0m in 0.05s]
[0m11:53:03.113527 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_individual_products
[0m11:53:03.113773 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_individual_products' to be skipped because of status 'error'.  Reason: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.quantity does not exist
  LINE 29:         SUM(oj.quantity) as total_quantity_sold,
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql.
[0m11:53:03.114680 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:03.114867 [debug] [MainThread]: On master: BEGIN
[0m11:53:03.115007 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:53:03.129217 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m11:53:03.129459 [debug] [MainThread]: On master: COMMIT
[0m11:53:03.129641 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:03.129966 [debug] [MainThread]: On master: COMMIT
[0m11:53:03.130423 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:53:03.130677 [debug] [MainThread]: On master: Close
[0m11:53:03.130918 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:53:03.131054 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_individual_products' was properly closed.
[0m11:53:03.131204 [info ] [MainThread]: 
[0m11:53:03.131368 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m11:53:03.131722 [debug] [MainThread]: Command end result
[0m11:53:03.146285 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:53:03.147603 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:53:03.150929 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:53:03.151139 [info ] [MainThread]: 
[0m11:53:03.151369 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:53:03.151607 [info ] [MainThread]: 
[0m11:53:03.151876 [error] [MainThread]: [31mFailure in model mart_individual_products (models/marts/mart_individual_products.sql)[0m
[0m11:53:03.152113 [error] [MainThread]:   Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.quantity does not exist
  LINE 29:         SUM(oj.quantity) as total_quantity_sold,
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:53:03.152258 [info ] [MainThread]: 
[0m11:53:03.152417 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:53:03.152548 [info ] [MainThread]: 
[0m11:53:03.152716 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:53:03.154671 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.7790059, "process_in_blocks": "0", "process_kernel_time": 0.292548, "process_mem_max_rss": "151633920", "process_out_blocks": "0", "process_user_time": 1.708252}
[0m11:53:03.154974 [debug] [MainThread]: Command `dbt run` failed at 11:53:03.154927 after 0.78 seconds
[0m11:53:03.155185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d817b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111976850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111977110>]}
[0m11:53:03.155380 [debug] [MainThread]: Flushing usage events
[0m11:53:03.861931 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:53:35.190848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108aa6900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9fbc50>]}


============================== 11:53:35.193775 | 5c8f44c0-7f79-4dd4-9d87-86e311013896 ==============================
[0m11:53:35.193775 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:53:35.194126 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'no_print': 'None', 'log_format': 'default', 'quiet': 'False', 'partial_parse': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'static_parser': 'True', 'printer_width': '80', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'warn_error': 'None', 'target_path': 'None', 'empty': 'False', 'invocation_command': 'dbt run --select mart_individual_products'}
[0m11:53:35.307574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c8f44c0-7f79-4dd4-9d87-86e311013896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10910a650>]}
[0m11:53:35.338937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c8f44c0-7f79-4dd4-9d87-86e311013896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a893bd0>]}
[0m11:53:35.339867 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:53:35.393333 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:53:35.459662 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:53:35.460076 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_individual_products.sql
[0m11:53:35.581634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c8f44c0-7f79-4dd4-9d87-86e311013896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9c1050>]}
[0m11:53:35.615985 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:53:35.617294 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:53:35.637625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c8f44c0-7f79-4dd4-9d87-86e311013896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afb8140>]}
[0m11:53:35.637900 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:53:35.638073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c8f44c0-7f79-4dd4-9d87-86e311013896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb211d0>]}
[0m11:53:35.638935 [info ] [MainThread]: 
[0m11:53:35.639123 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:53:35.639260 [info ] [MainThread]: 
[0m11:53:35.639506 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:53:35.639979 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:53:35.692898 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:53:35.693156 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:53:35.693303 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:53:35.713719 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.020 seconds
[0m11:53:35.714574 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:53:35.717067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:53:35.719881 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:53:35.720057 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:53:35.720191 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:53:35.726447 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m11:53:35.726611 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:53:35.726751 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:53:35.734616 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.008 seconds
[0m11:53:35.735378 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:53:35.735721 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:53:35.738817 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:35.738986 [debug] [MainThread]: On master: BEGIN
[0m11:53:35.739118 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:53:35.748651 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m11:53:35.748840 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:35.749029 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:53:35.758304 [debug] [MainThread]: SQL status: SELECT 13 in 0.009 seconds
[0m11:53:35.759637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c8f44c0-7f79-4dd4-9d87-86e311013896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c04f5f0>]}
[0m11:53:35.759880 [debug] [MainThread]: On master: ROLLBACK
[0m11:53:35.760292 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:35.760424 [debug] [MainThread]: On master: BEGIN
[0m11:53:35.761025 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:53:35.761158 [debug] [MainThread]: On master: COMMIT
[0m11:53:35.761280 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:35.761398 [debug] [MainThread]: On master: COMMIT
[0m11:53:35.761712 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:53:35.761846 [debug] [MainThread]: On master: Close
[0m11:53:35.764291 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_individual_products
[0m11:53:35.764612 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_individual_products ................ [RUN]
[0m11:53:35.764924 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_individual_products)
[0m11:53:35.765194 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_individual_products
[0m11:53:35.769713 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_individual_products"
[0m11:53:35.771563 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_individual_products
[0m11:53:35.791992 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_individual_products"
[0m11:53:35.792846 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:53:35.793035 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: BEGIN
[0m11:53:35.793199 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:53:35.812657 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m11:53:35.812883 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:53:35.813164 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp"
  
  
    as
  
  (
    -- Product-level performance mart
-- One row per product_id with detailed product metrics
WITH product_metrics AS (
    SELECT 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm,
        
        -- Order metrics
        COUNT(DISTINCT oj.order_id) as total_orders,
        COUNT(DISTINCT oj.customer_id) as unique_customers,
        COUNT(oj.order_item_id) as total_quantity_sold,
        
        -- Revenue metrics  
        SUM(oj.total_item_value) as total_product_revenue,
        AVG(oj.price) as average_selling_price,
        AVG(oj.total_item_value) as average_order_value,
        
        -- Performance metrics
        AVG(oj.review_score) as average_review_score,
        COUNT(CASE WHEN oj.review_score >= 4 THEN 1 END) * 100.0 / COUNT(oj.review_score) as positive_review_percentage,
        
        -- Delivery metrics
        AVG(oj.delivery_days) as average_delivery_days,
        COUNT(CASE WHEN oj.is_late_delivery THEN 1 END) * 100.0 / COUNT(oj.order_id) as late_delivery_percentage,
        
        -- Time analysis
        MIN(oj.order_purchase_timestamp) as first_order_date,
        MAX(oj.order_purchase_timestamp) as last_order_date,
        
        -- Customer behavior
        AVG(oj.payment_value) as average_payment_value
        
    FROM "ecommerce_db"."analytics"."stg_products" p
    LEFT JOIN "ecommerce_db"."analytics"."int_orders_joined" oj 
        ON p.product_id = oj.product_id
    GROUP BY 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm
),

product_rankings AS (
    SELECT 
        *,
        -- Revenue rankings
        ROW_NUMBER() OVER (ORDER BY total_product_revenue DESC NULLS LAST) as revenue_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_product_revenue DESC NULLS LAST) as category_revenue_rank,
        
        -- Volume rankings
        ROW_NUMBER() OVER (ORDER BY total_quantity_sold DESC NULLS LAST) as volume_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_quantity_sold DESC NULLS LAST) as category_volume_rank,
        
        -- Quality rankings  
        ROW_NUMBER() OVER (ORDER BY average_review_score DESC NULLS LAST) as quality_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY average_review_score DESC NULLS LAST) as category_quality_rank,
        
        -- Performance tiers
        CASE 
            WHEN total_product_revenue >= 50000 THEN 'Star Product'
            WHEN total_product_revenue >= 10000 THEN 'Strong Performer'  
            WHEN total_product_revenue >= 1000 THEN 'Average Performer'
            WHEN total_product_revenue > 0 THEN 'Low Performer'
            ELSE 'No Sales'
        END as performance_tier
        
    FROM product_metrics
)

SELECT 
    product_id,
    product_category_name_english,
    
    -- Product attributes
    product_name_lenght,
    product_description_lenght, 
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm,
    
    -- Sales metrics
    total_orders,
    unique_customers,
    total_quantity_sold,
    
    -- Revenue metrics
    ROUND(total_product_revenue::NUMERIC, 2) as total_product_revenue,
    ROUND(average_selling_price::NUMERIC, 2) as average_selling_price,
    ROUND(average_order_value::NUMERIC, 2) as average_order_value,
    
    -- Quality metrics
    ROUND(average_review_score::NUMERIC, 2) as average_review_score,
    ROUND(positive_review_percentage::NUMERIC, 2) as positive_review_percentage,
    
    -- Delivery metrics  
    ROUND(average_delivery_days::NUMERIC, 1) as average_delivery_days,
    ROUND(late_delivery_percentage::NUMERIC, 2) as late_delivery_percentage,
    
    -- Time metrics
    first_order_date,
    last_order_date,
    ROUND(average_payment_value::NUMERIC, 2) as average_payment_value,
    
    -- Rankings
    revenue_rank,
    category_revenue_rank,
    volume_rank,
    category_volume_rank,
    quality_rank,
    category_quality_rank,
    
    -- Classification
    performance_tier
    
FROM product_rankings
ORDER BY revenue_rank
  );
  
[0m11:53:35.815889 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column oj.review_score does not exist
LINE 37:         AVG(oj.review_score) as average_review_score,
                     ^

[0m11:53:35.816081 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: ROLLBACK
[0m11:53:35.816417 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: Close
[0m11:53:35.830911 [debug] [Thread-1 (]: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.review_score does not exist
  LINE 37:         AVG(oj.review_score) as average_review_score,
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:53:35.832473 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c8f44c0-7f79-4dd4-9d87-86e311013896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1f4710>]}
[0m11:53:35.832941 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_individual_products ....... [[31mERROR[0m in 0.07s]
[0m11:53:35.833287 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_individual_products
[0m11:53:35.833590 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_individual_products' to be skipped because of status 'error'.  Reason: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.review_score does not exist
  LINE 37:         AVG(oj.review_score) as average_review_score,
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql.
[0m11:53:35.834631 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:35.834805 [debug] [MainThread]: On master: BEGIN
[0m11:53:35.834936 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:53:35.840877 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m11:53:35.841082 [debug] [MainThread]: On master: COMMIT
[0m11:53:35.841222 [debug] [MainThread]: Using postgres connection "master"
[0m11:53:35.841344 [debug] [MainThread]: On master: COMMIT
[0m11:53:35.841537 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:53:35.841658 [debug] [MainThread]: On master: Close
[0m11:53:35.841841 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:53:35.841955 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_individual_products' was properly closed.
[0m11:53:35.842086 [info ] [MainThread]: 
[0m11:53:35.842229 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m11:53:35.842538 [debug] [MainThread]: Command end result
[0m11:53:35.854967 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:53:35.856487 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:53:35.859728 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:53:35.859964 [info ] [MainThread]: 
[0m11:53:35.860259 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:53:35.860481 [info ] [MainThread]: 
[0m11:53:35.860703 [error] [MainThread]: [31mFailure in model mart_individual_products (models/marts/mart_individual_products.sql)[0m
[0m11:53:35.860883 [error] [MainThread]:   Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.review_score does not exist
  LINE 37:         AVG(oj.review_score) as average_review_score,
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:53:35.861013 [info ] [MainThread]: 
[0m11:53:35.861163 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:53:35.861282 [info ] [MainThread]: 
[0m11:53:35.861418 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:53:35.863511 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.7265877, "process_in_blocks": "0", "process_kernel_time": 0.249328, "process_mem_max_rss": "152928256", "process_out_blocks": "0", "process_user_time": 1.715803}
[0m11:53:35.863812 [debug] [MainThread]: Command `dbt run` failed at 11:53:35.863762 after 0.73 seconds
[0m11:53:35.864045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bcf2a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dfceb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c17f890>]}
[0m11:53:35.864239 [debug] [MainThread]: Flushing usage events
[0m11:53:36.408509 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:54:25.180254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10543a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070fbc50>]}


============================== 11:54:25.183983 | 60612153-753f-40cd-81b8-e360d46e07d0 ==============================
[0m11:54:25.183983 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:54:25.184358 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'write_json': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'log_format': 'default', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'warn_error': 'None', 'invocation_command': 'dbt run --select mart_individual_products', 'target_path': 'None', 'cache_selected_only': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'debug': 'False', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/raramesh/.dbt', 'no_print': 'None', 'quiet': 'False', 'use_experimental_parser': 'False'}
[0m11:54:25.304600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60612153-753f-40cd-81b8-e360d46e07d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10600e650>]}
[0m11:54:25.336683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60612153-753f-40cd-81b8-e360d46e07d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e93bd0>]}
[0m11:54:25.337869 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:54:25.394462 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:54:25.468737 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:54:25.469211 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_individual_products.sql
[0m11:54:25.592668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60612153-753f-40cd-81b8-e360d46e07d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cc1050>]}
[0m11:54:25.628662 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:54:25.630495 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:54:25.654018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60612153-753f-40cd-81b8-e360d46e07d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107784140>]}
[0m11:54:25.654300 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:54:25.654479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60612153-753f-40cd-81b8-e360d46e07d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e211d0>]}
[0m11:54:25.655395 [info ] [MainThread]: 
[0m11:54:25.655583 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:54:25.655712 [info ] [MainThread]: 
[0m11:54:25.655959 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:54:25.656381 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:54:25.728007 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:54:25.728260 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:54:25.728412 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:54:25.751529 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.023 seconds
[0m11:54:25.752472 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:54:25.754955 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:54:25.757910 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:54:25.758109 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:54:25.758246 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:54:25.765566 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m11:54:25.765745 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:54:25.765905 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:54:25.771276 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.005 seconds
[0m11:54:25.771999 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:54:25.772384 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:54:25.775341 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:25.775510 [debug] [MainThread]: On master: BEGIN
[0m11:54:25.775637 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:54:25.784970 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m11:54:25.785185 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:25.785369 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:54:25.791290 [debug] [MainThread]: SQL status: SELECT 13 in 0.006 seconds
[0m11:54:25.792534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60612153-753f-40cd-81b8-e360d46e07d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129535f0>]}
[0m11:54:25.792766 [debug] [MainThread]: On master: ROLLBACK
[0m11:54:25.793070 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:25.793202 [debug] [MainThread]: On master: BEGIN
[0m11:54:25.793656 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:54:25.793791 [debug] [MainThread]: On master: COMMIT
[0m11:54:25.794144 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:25.794297 [debug] [MainThread]: On master: COMMIT
[0m11:54:25.794568 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:54:25.794803 [debug] [MainThread]: On master: Close
[0m11:54:25.797247 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_individual_products
[0m11:54:25.797569 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_individual_products ................ [RUN]
[0m11:54:25.797813 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_individual_products)
[0m11:54:25.797991 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_individual_products
[0m11:54:25.802379 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_individual_products"
[0m11:54:25.803102 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_individual_products
[0m11:54:25.822624 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_individual_products"
[0m11:54:25.823459 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:54:25.823718 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: BEGIN
[0m11:54:25.823885 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:54:25.835259 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m11:54:25.835463 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:54:25.835918 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp"
  
  
    as
  
  (
    -- Product-level performance mart
-- One row per product_id with detailed product metrics
WITH product_metrics AS (
    SELECT 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm,
        
        -- Order metrics
        COUNT(DISTINCT oj.order_id) as total_orders,
        COUNT(DISTINCT oj.customer_id) as unique_customers,
        COUNT(oj.order_item_id) as total_quantity_sold,
        
        -- Revenue metrics  
        SUM(oj.total_item_value) as total_product_revenue,
        AVG(oj.price) as average_selling_price,
        AVG(oj.total_item_value) as average_order_value,
        
        -- Performance metrics (review data not available in int_orders_joined)
        -- AVG(oj.review_score) as average_review_score,
        -- COUNT(CASE WHEN oj.review_score >= 4 THEN 1 END) * 100.0 / COUNT(oj.review_score) as positive_review_percentage,
        
        -- Delivery metrics
        AVG(oj.delivery_days) as average_delivery_days,
        COUNT(CASE WHEN oj.is_late_delivery THEN 1 END) * 100.0 / COUNT(oj.order_id) as late_delivery_percentage,
        
        -- Time analysis
        MIN(oj.order_purchase_timestamp) as first_order_date,
        MAX(oj.order_purchase_timestamp) as last_order_date,
        
        -- Customer behavior
        AVG(oj.payment_value) as average_payment_value
        
    FROM "ecommerce_db"."analytics"."stg_products" p
    LEFT JOIN "ecommerce_db"."analytics"."int_orders_joined" oj 
        ON p.product_id = oj.product_id
    GROUP BY 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm
),

product_rankings AS (
    SELECT 
        *,
        -- Revenue rankings
        ROW_NUMBER() OVER (ORDER BY total_product_revenue DESC NULLS LAST) as revenue_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_product_revenue DESC NULLS LAST) as category_revenue_rank,
        
        -- Volume rankings
        ROW_NUMBER() OVER (ORDER BY total_quantity_sold DESC NULLS LAST) as volume_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_quantity_sold DESC NULLS LAST) as category_volume_rank,
        
        -- Quality rankings (not available)
        -- ROW_NUMBER() OVER (ORDER BY average_review_score DESC NULLS LAST) as quality_rank,
        -- ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY average_review_score DESC NULLS LAST) as category_quality_rank,
        
        -- Performance tiers
        CASE 
            WHEN total_product_revenue >= 50000 THEN 'Star Product'
            WHEN total_product_revenue >= 10000 THEN 'Strong Performer'  
            WHEN total_product_revenue >= 1000 THEN 'Average Performer'
            WHEN total_product_revenue > 0 THEN 'Low Performer'
            ELSE 'No Sales'
        END as performance_tier
        
    FROM product_metrics
)

SELECT 
    product_id,
    product_category_name_english,
    
    -- Product attributes
    product_name_lenght,
    product_description_lenght, 
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm,
    
    -- Sales metrics
    total_orders,
    unique_customers,
    total_quantity_sold,
    
    -- Revenue metrics
    ROUND(total_product_revenue::NUMERIC, 2) as total_product_revenue,
    ROUND(average_selling_price::NUMERIC, 2) as average_selling_price,
    ROUND(average_order_value::NUMERIC, 2) as average_order_value,
    
    -- Quality metrics (not available)
    -- ROUND(average_review_score::NUMERIC, 2) as average_review_score,
    -- ROUND(positive_review_percentage::NUMERIC, 2) as positive_review_percentage,
    
    -- Delivery metrics  
    ROUND(average_delivery_days::NUMERIC, 1) as average_delivery_days,
    ROUND(late_delivery_percentage::NUMERIC, 2) as late_delivery_percentage,
    
    -- Time metrics
    first_order_date,
    last_order_date,
    ROUND(average_payment_value::NUMERIC, 2) as average_payment_value,
    
    -- Rankings
    revenue_rank,
    category_revenue_rank,
    volume_rank,
    category_volume_rank,
    -- quality_rank,
    -- category_quality_rank,
    
    -- Classification
    performance_tier
    
FROM product_rankings
ORDER BY revenue_rank
  );
  
[0m11:54:25.839778 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column oj.payment_value does not exist
LINE 49:         AVG(oj.payment_value) as average_payment_value
                     ^

[0m11:54:25.839989 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: ROLLBACK
[0m11:54:25.840394 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: Close
[0m11:54:25.846286 [debug] [Thread-1 (]: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.payment_value does not exist
  LINE 49:         AVG(oj.payment_value) as average_payment_value
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:54:25.847556 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60612153-753f-40cd-81b8-e360d46e07d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112afc710>]}
[0m11:54:25.847936 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.mart_individual_products ....... [[31mERROR[0m in 0.05s]
[0m11:54:25.848247 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_individual_products
[0m11:54:25.848518 [debug] [Thread-4 (]: Marking all children of 'model.ecom_analytics.mart_individual_products' to be skipped because of status 'error'.  Reason: Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.payment_value does not exist
  LINE 49:         AVG(oj.payment_value) as average_payment_value
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql.
[0m11:54:25.849419 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:25.849576 [debug] [MainThread]: On master: BEGIN
[0m11:54:25.849705 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:54:25.855880 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m11:54:25.856086 [debug] [MainThread]: On master: COMMIT
[0m11:54:25.856227 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:25.856354 [debug] [MainThread]: On master: COMMIT
[0m11:54:25.856576 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:54:25.856703 [debug] [MainThread]: On master: Close
[0m11:54:25.856886 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:54:25.857008 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_individual_products' was properly closed.
[0m11:54:25.857142 [info ] [MainThread]: 
[0m11:54:25.857292 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m11:54:25.857610 [debug] [MainThread]: Command end result
[0m11:54:25.871688 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:54:25.873326 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:54:25.876714 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:54:25.876952 [info ] [MainThread]: 
[0m11:54:25.877175 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:54:25.877415 [info ] [MainThread]: 
[0m11:54:25.877614 [error] [MainThread]: [31mFailure in model mart_individual_products (models/marts/mart_individual_products.sql)[0m
[0m11:54:25.877796 [error] [MainThread]:   Database Error in model mart_individual_products (models/marts/mart_individual_products.sql)
  column oj.payment_value does not exist
  LINE 49:         AVG(oj.payment_value) as average_payment_value
                       ^
  compiled code at target/run/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:54:25.877934 [info ] [MainThread]: 
[0m11:54:25.878084 [info ] [MainThread]:   compiled code at target/compiled/ecom_analytics/models/marts/mart_individual_products.sql
[0m11:54:25.878209 [info ] [MainThread]: 
[0m11:54:25.878359 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:54:25.880286 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.75739175, "process_in_blocks": "0", "process_kernel_time": 0.29738, "process_mem_max_rss": "151977984", "process_out_blocks": "0", "process_user_time": 1.704975}
[0m11:54:25.880589 [debug] [MainThread]: Command `dbt run` failed at 11:54:25.880541 after 0.76 seconds
[0m11:54:25.880813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111feea40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033f8eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a87890>]}
[0m11:54:25.881014 [debug] [MainThread]: Flushing usage events
[0m11:54:26.559796 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:54:55.909908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118a3e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a2f7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a2f7c50>]}


============================== 11:54:55.915372 | f300af90-252e-483e-a8fc-50d6f2b66348 ==============================
[0m11:54:55.915372 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:54:55.915948 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'invocation_command': 'dbt run --select mart_individual_products', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'quiet': 'False', 'printer_width': '80', 'no_print': 'None', 'introspect': 'True', 'empty': 'False', 'debug': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'version_check': 'True', 'log_format': 'default', 'write_json': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'profiles_dir': '/Users/raramesh/.dbt'}
[0m11:54:56.037239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f300af90-252e-483e-a8fc-50d6f2b66348', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11900a650>]}
[0m11:54:56.068948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f300af90-252e-483e-a8fc-50d6f2b66348', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a193bd0>]}
[0m11:54:56.069856 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:54:56.126433 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:54:56.200833 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:54:56.201241 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_individual_products.sql
[0m11:54:56.325381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f300af90-252e-483e-a8fc-50d6f2b66348', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bdc1050>]}
[0m11:54:56.362617 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:54:56.364503 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:54:56.391196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f300af90-252e-483e-a8fc-50d6f2b66348', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b38c140>]}
[0m11:54:56.391535 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:54:56.391733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f300af90-252e-483e-a8fc-50d6f2b66348', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bf1d1d0>]}
[0m11:54:56.392678 [info ] [MainThread]: 
[0m11:54:56.392864 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:54:56.393023 [info ] [MainThread]: 
[0m11:54:56.393289 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:54:56.393738 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:54:56.476686 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:54:56.476972 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:54:56.477344 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:54:56.512206 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.035 seconds
[0m11:54:56.513152 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:54:56.515860 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:54:56.519313 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:54:56.519535 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:54:56.519673 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:54:56.531380 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m11:54:56.531666 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:54:56.531833 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:54:56.539845 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.008 seconds
[0m11:54:56.540815 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:54:56.541419 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:54:56.545040 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:56.545252 [debug] [MainThread]: On master: BEGIN
[0m11:54:56.545393 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:54:56.556586 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m11:54:56.556800 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:56.557024 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:54:56.568309 [debug] [MainThread]: SQL status: SELECT 13 in 0.011 seconds
[0m11:54:56.570003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f300af90-252e-483e-a8fc-50d6f2b66348', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c3535f0>]}
[0m11:54:56.570287 [debug] [MainThread]: On master: ROLLBACK
[0m11:54:56.570643 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:56.570884 [debug] [MainThread]: On master: BEGIN
[0m11:54:56.571358 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:54:56.571543 [debug] [MainThread]: On master: COMMIT
[0m11:54:56.571702 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:56.571847 [debug] [MainThread]: On master: COMMIT
[0m11:54:56.572085 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:54:56.572242 [debug] [MainThread]: On master: Close
[0m11:54:56.576862 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_individual_products
[0m11:54:56.577317 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_individual_products ................ [RUN]
[0m11:54:56.577587 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_individual_products)
[0m11:54:56.577786 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_individual_products
[0m11:54:56.582473 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_individual_products"
[0m11:54:56.583314 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_individual_products
[0m11:54:56.603697 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_individual_products"
[0m11:54:56.604517 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:54:56.604699 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: BEGIN
[0m11:54:56.604857 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:54:56.621342 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m11:54:56.621579 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:54:56.621862 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp"
  
  
    as
  
  (
    -- Product-level performance mart
-- One row per product_id with detailed product metrics
WITH product_metrics AS (
    SELECT 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm,
        
        -- Order metrics
        COUNT(DISTINCT oj.order_id) as total_orders,
        COUNT(DISTINCT oj.customer_id) as unique_customers,
        COUNT(oj.order_item_id) as total_quantity_sold,
        
        -- Revenue metrics  
        SUM(oj.total_item_value) as total_product_revenue,
        AVG(oj.price) as average_selling_price,
        AVG(oj.total_item_value) as average_order_value,
        
        -- Performance metrics (review data not available in int_orders_joined)
        -- AVG(oj.review_score) as average_review_score,
        -- COUNT(CASE WHEN oj.review_score >= 4 THEN 1 END) * 100.0 / COUNT(oj.review_score) as positive_review_percentage,
        
        -- Delivery metrics
        AVG(oj.delivery_days) as average_delivery_days,
        COUNT(CASE WHEN oj.is_late_delivery THEN 1 END) * 100.0 / COUNT(oj.order_id) as late_delivery_percentage,
        
        -- Time analysis
        MIN(oj.order_purchase_timestamp) as first_order_date,
        MAX(oj.order_purchase_timestamp) as last_order_date,
        
        -- Customer behavior
        AVG(oj.total_item_value) as average_item_value
        
    FROM "ecommerce_db"."analytics"."stg_products" p
    LEFT JOIN "ecommerce_db"."analytics"."int_orders_joined" oj 
        ON p.product_id = oj.product_id
    GROUP BY 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm
),

product_rankings AS (
    SELECT 
        *,
        -- Revenue rankings
        ROW_NUMBER() OVER (ORDER BY total_product_revenue DESC NULLS LAST) as revenue_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_product_revenue DESC NULLS LAST) as category_revenue_rank,
        
        -- Volume rankings
        ROW_NUMBER() OVER (ORDER BY total_quantity_sold DESC NULLS LAST) as volume_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_quantity_sold DESC NULLS LAST) as category_volume_rank,
        
        -- Quality rankings (not available)
        -- ROW_NUMBER() OVER (ORDER BY average_review_score DESC NULLS LAST) as quality_rank,
        -- ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY average_review_score DESC NULLS LAST) as category_quality_rank,
        
        -- Performance tiers
        CASE 
            WHEN total_product_revenue >= 50000 THEN 'Star Product'
            WHEN total_product_revenue >= 10000 THEN 'Strong Performer'  
            WHEN total_product_revenue >= 1000 THEN 'Average Performer'
            WHEN total_product_revenue > 0 THEN 'Low Performer'
            ELSE 'No Sales'
        END as performance_tier
        
    FROM product_metrics
)

SELECT 
    product_id,
    product_category_name_english,
    
    -- Product attributes
    product_name_lenght,
    product_description_lenght, 
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm,
    
    -- Sales metrics
    total_orders,
    unique_customers,
    total_quantity_sold,
    
    -- Revenue metrics
    ROUND(total_product_revenue::NUMERIC, 2) as total_product_revenue,
    ROUND(average_selling_price::NUMERIC, 2) as average_selling_price,
    ROUND(average_order_value::NUMERIC, 2) as average_order_value,
    
    -- Quality metrics (not available)
    -- ROUND(average_review_score::NUMERIC, 2) as average_review_score,
    -- ROUND(positive_review_percentage::NUMERIC, 2) as positive_review_percentage,
    
    -- Delivery metrics  
    ROUND(average_delivery_days::NUMERIC, 1) as average_delivery_days,
    ROUND(late_delivery_percentage::NUMERIC, 2) as late_delivery_percentage,
    
    -- Time metrics
    first_order_date,
    last_order_date,
    ROUND(average_item_value::NUMERIC, 2) as average_item_value,
    
    -- Rankings
    revenue_rank,
    category_revenue_rank,
    volume_rank,
    category_volume_rank,
    -- quality_rank,
    -- category_quality_rank,
    
    -- Classification
    performance_tier
    
FROM product_rankings
ORDER BY revenue_rank
  );
  
[0m11:54:58.133651 [debug] [Thread-1 (]: SQL status: SELECT 32951 in 1.511 seconds
[0m11:54:58.143481 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:54:58.144021 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */
alter table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp" rename to "mart_individual_products"
[0m11:54:58.145462 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:54:58.156138 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: COMMIT
[0m11:54:58.156605 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:54:58.156962 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: COMMIT
[0m11:54:58.161109 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m11:54:58.165422 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."mart_individual_products__dbt_backup"
[0m11:54:58.169342 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:54:58.169697 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */
drop table if exists "ecommerce_db"."analytics"."mart_individual_products__dbt_backup" cascade
[0m11:54:58.170279 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.000 seconds
[0m11:54:58.172309 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: Close
[0m11:54:58.174373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f300af90-252e-483e-a8fc-50d6f2b66348', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c4fd010>]}
[0m11:54:58.174865 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.mart_individual_products ........... [[32mSELECT 32951[0m in 1.60s]
[0m11:54:58.175240 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_individual_products
[0m11:54:58.176028 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:58.176216 [debug] [MainThread]: On master: BEGIN
[0m11:54:58.176380 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:54:58.180933 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m11:54:58.181208 [debug] [MainThread]: On master: COMMIT
[0m11:54:58.181480 [debug] [MainThread]: Using postgres connection "master"
[0m11:54:58.181857 [debug] [MainThread]: On master: COMMIT
[0m11:54:58.182474 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:54:58.182718 [debug] [MainThread]: On master: Close
[0m11:54:58.182995 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:54:58.183190 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_individual_products' was properly closed.
[0m11:54:58.183397 [info ] [MainThread]: 
[0m11:54:58.183613 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.79 seconds (1.79s).
[0m11:54:58.184065 [debug] [MainThread]: Command end result
[0m11:54:58.204384 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:54:58.206126 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:54:58.210276 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:54:58.210484 [info ] [MainThread]: 
[0m11:54:58.210708 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:54:58.210863 [info ] [MainThread]: 
[0m11:54:58.211048 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:54:58.213078 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.39145, "process_in_blocks": "0", "process_kernel_time": 0.323442, "process_mem_max_rss": "151584768", "process_out_blocks": "0", "process_user_time": 1.76052}
[0m11:54:58.213357 [debug] [MainThread]: Command `dbt run` succeeded at 11:54:58.213305 after 2.39 seconds
[0m11:54:58.213579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c0fac50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c072df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c072e90>]}
[0m11:54:58.213781 [debug] [MainThread]: Flushing usage events
[0m11:54:58.779687 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:55:11.709139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e32900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3fbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3fbc50>]}


============================== 11:55:11.713026 | 437859c3-a767-41a1-b708-6a68758f8c19 ==============================
[0m11:55:11.713026 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:55:11.713359 [debug] [MainThread]: running dbt with arguments {'empty': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'use_colors': 'True', 'version_check': 'True', 'quiet': 'False', 'fail_fast': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'debug': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'no_print': 'None', 'profiles_dir': '/Users/raramesh/.dbt', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'invocation_command': 'dbt show --select mart_individual_products --limit 10', 'warn_error': 'None', 'use_experimental_parser': 'False'}
[0m11:55:11.832942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '437859c3-a767-41a1-b708-6a68758f8c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11880a650>]}
[0m11:55:11.867138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '437859c3-a767-41a1-b708-6a68758f8c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a293bd0>]}
[0m11:55:11.885228 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:55:11.946288 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:55:12.022417 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:55:12.022700 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:55:12.040114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '437859c3-a767-41a1-b708-6a68758f8c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b7f1050>]}
[0m11:55:12.076126 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:55:12.077758 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:55:12.079846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '437859c3-a767-41a1-b708-6a68758f8c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b1ebe30>]}
[0m11:55:12.080106 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:55:12.080282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '437859c3-a767-41a1-b708-6a68758f8c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b7d9b70>]}
[0m11:55:12.081233 [info ] [MainThread]: 
[0m11:55:12.081423 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:55:12.081556 [info ] [MainThread]: 
[0m11:55:12.081806 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:55:12.083865 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db_analytics'
[0m11:55:12.158656 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:55:12.158942 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:55:12.159167 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:55:12.184481 [debug] [ThreadPool]: SQL status: BEGIN in 0.025 seconds
[0m11:55:12.184749 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:55:12.184913 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:55:12.189294 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.004 seconds
[0m11:55:12.190137 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:55:12.190451 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:55:12.193685 [debug] [MainThread]: Using postgres connection "master"
[0m11:55:12.193870 [debug] [MainThread]: On master: BEGIN
[0m11:55:12.193999 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:55:12.202009 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m11:55:12.202203 [debug] [MainThread]: Using postgres connection "master"
[0m11:55:12.202403 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:55:12.210079 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m11:55:12.212757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '437859c3-a767-41a1-b708-6a68758f8c19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b8efba0>]}
[0m11:55:12.213002 [debug] [MainThread]: On master: ROLLBACK
[0m11:55:12.218000 [debug] [MainThread]: On master: Close
[0m11:55:12.221052 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_individual_products
[0m11:55:12.221347 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_individual_products)
[0m11:55:12.221550 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_individual_products
[0m11:55:12.226398 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_individual_products"
[0m11:55:12.227114 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_individual_products
[0m11:55:12.230968 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:55:12.231319 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */

  
  -- Product-level performance mart
-- One row per product_id with detailed product metrics
WITH product_metrics AS (
    SELECT 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm,
        
        -- Order metrics
        COUNT(DISTINCT oj.order_id) as total_orders,
        COUNT(DISTINCT oj.customer_id) as unique_customers,
        COUNT(oj.order_item_id) as total_quantity_sold,
        
        -- Revenue metrics  
        SUM(oj.total_item_value) as total_product_revenue,
        AVG(oj.price) as average_selling_price,
        AVG(oj.total_item_value) as average_order_value,
        
        -- Performance metrics (review data not available in int_orders_joined)
        -- AVG(oj.review_score) as average_review_score,
        -- COUNT(CASE WHEN oj.review_score >= 4 THEN 1 END) * 100.0 / COUNT(oj.review_score) as positive_review_percentage,
        
        -- Delivery metrics
        AVG(oj.delivery_days) as average_delivery_days,
        COUNT(CASE WHEN oj.is_late_delivery THEN 1 END) * 100.0 / COUNT(oj.order_id) as late_delivery_percentage,
        
        -- Time analysis
        MIN(oj.order_purchase_timestamp) as first_order_date,
        MAX(oj.order_purchase_timestamp) as last_order_date,
        
        -- Customer behavior
        AVG(oj.total_item_value) as average_item_value
        
    FROM "ecommerce_db"."analytics"."stg_products" p
    LEFT JOIN "ecommerce_db"."analytics"."int_orders_joined" oj 
        ON p.product_id = oj.product_id
    GROUP BY 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm
),

product_rankings AS (
    SELECT 
        *,
        -- Revenue rankings
        ROW_NUMBER() OVER (ORDER BY total_product_revenue DESC NULLS LAST) as revenue_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_product_revenue DESC NULLS LAST) as category_revenue_rank,
        
        -- Volume rankings
        ROW_NUMBER() OVER (ORDER BY total_quantity_sold DESC NULLS LAST) as volume_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_quantity_sold DESC NULLS LAST) as category_volume_rank,
        
        -- Quality rankings (not available)
        -- ROW_NUMBER() OVER (ORDER BY average_review_score DESC NULLS LAST) as quality_rank,
        -- ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY average_review_score DESC NULLS LAST) as category_quality_rank,
        
        -- Performance tiers
        CASE 
            WHEN total_product_revenue >= 50000 THEN 'Star Product'
            WHEN total_product_revenue >= 10000 THEN 'Strong Performer'  
            WHEN total_product_revenue >= 1000 THEN 'Average Performer'
            WHEN total_product_revenue > 0 THEN 'Low Performer'
            ELSE 'No Sales'
        END as performance_tier
        
    FROM product_metrics
)

SELECT 
    product_id,
    product_category_name_english,
    
    -- Product attributes
    product_name_lenght,
    product_description_lenght, 
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm,
    
    -- Sales metrics
    total_orders,
    unique_customers,
    total_quantity_sold,
    
    -- Revenue metrics
    ROUND(total_product_revenue::NUMERIC, 2) as total_product_revenue,
    ROUND(average_selling_price::NUMERIC, 2) as average_selling_price,
    ROUND(average_order_value::NUMERIC, 2) as average_order_value,
    
    -- Quality metrics (not available)
    -- ROUND(average_review_score::NUMERIC, 2) as average_review_score,
    -- ROUND(positive_review_percentage::NUMERIC, 2) as positive_review_percentage,
    
    -- Delivery metrics  
    ROUND(average_delivery_days::NUMERIC, 1) as average_delivery_days,
    ROUND(late_delivery_percentage::NUMERIC, 2) as late_delivery_percentage,
    
    -- Time metrics
    first_order_date,
    last_order_date,
    ROUND(average_item_value::NUMERIC, 2) as average_item_value,
    
    -- Rankings
    revenue_rank,
    category_revenue_rank,
    volume_rank,
    category_volume_rank,
    -- quality_rank,
    -- category_quality_rank,
    
    -- Classification
    performance_tier
    
FROM product_rankings
ORDER BY revenue_rank
  
  limit 10

[0m11:55:12.231647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:55:13.541998 [debug] [Thread-1 (]: SQL status: SELECT 10 in 1.310 seconds
[0m11:55:13.548169 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: Close
[0m11:55:13.548938 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_individual_products
[0m11:55:13.549558 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:55:13.549739 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_individual_products' was properly closed.
[0m11:55:13.550073 [debug] [MainThread]: Command end result
[0m11:55:13.568212 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:55:13.570604 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:55:13.575820 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:55:13.577009 [info ] [MainThread]: Previewing node 'mart_individual_products':
| product_id           | product_category_... | product_name_lenght | product_descripti... | product_photos_qty | product_weight_g | ... |
| -------------------- | -------------------- | ------------------- | -------------------- | ------------------ | ---------------- | --- |
| bb50f2e236e5eea01... | health_beauty        |                  60 |                2,644 |                  6 |              400 | ... |
| d1c427060a0f73f6b... | computers_accesso... |                  59 |                1,893 |                  1 |            6,550 | ... |
| 6cdd53843498f9289... | health_beauty        |                  51 |                  625 |                  1 |              900 | ... |
| 99a4788cb24856965... | bed_bath_table       |                  54 |                  245 |                  1 |            1,383 | ... |
| d6160fb7873f18409... | computers            |                  55 |                3,632 |                  4 |            2,600 | ... |
| 3dd2a17168ec895c7... | computers_accesso... |                  48 |                  894 |                  1 |              533 | ... |
| aca2eb7d00ea1a7b8... | furniture_decor      |                  44 |                  903 |                  6 |            2,600 | ... |
| 5f504b3a1c75b73d6... | cool_stuff           |                  38 |                1,176 |                  3 |           15,350 | ... |
| 25c38557cf793876c... | baby                 |                  58 |                1,447 |                  5 |           15,800 | ... |
| 53b36df67ebb7c415... | watches_gifts        |                  33 |                  523 |                  3 |              584 | ... |

[0m11:55:13.579756 [debug] [MainThread]: Resource report: {"command_name": "show", "command_success": true, "command_wall_clock_time": 1.919384, "process_in_blocks": "0", "process_kernel_time": 0.292717, "process_mem_max_rss": "148930560", "process_out_blocks": "0", "process_user_time": 1.57898}
[0m11:55:13.580103 [debug] [MainThread]: Command `dbt show` succeeded at 11:55:13.580042 after 1.92 seconds
[0m11:55:13.580373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3e4590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b8f60a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b8f6150>]}
[0m11:55:13.580614 [debug] [MainThread]: Flushing usage events
[0m11:55:14.076680 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:58:26.322395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10593a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106efbd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106efbc50>]}


============================== 11:58:26.326497 | b77f89bc-13b6-4a8e-b548-becba3df70f1 ==============================
[0m11:58:26.326497 [info ] [MainThread]: Running with dbt=1.10.15
[0m11:58:26.326916 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'indirect_selection': 'eager', 'no_print': 'None', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select mart_individual_products', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'write_json': 'True', 'printer_width': '80', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'profiles_dir': '/Users/raramesh/.dbt', 'debug': 'False', 'log_cache_events': 'False'}
[0m11:58:26.493448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b77f89bc-13b6-4a8e-b548-becba3df70f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f0a650>]}
[0m11:58:26.528073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b77f89bc-13b6-4a8e-b548-becba3df70f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d93bd0>]}
[0m11:58:26.529142 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m11:58:26.590802 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m11:58:26.695493 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:58:26.695959 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_individual_products.sql
[0m11:58:26.827372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b77f89bc-13b6-4a8e-b548-becba3df70f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d49050>]}
[0m11:58:26.863759 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:58:26.865660 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:58:26.905431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b77f89bc-13b6-4a8e-b548-becba3df70f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107494140>]}
[0m11:58:26.905740 [info ] [MainThread]: Found 12 models, 9 sources, 459 macros
[0m11:58:26.905915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b77f89bc-13b6-4a8e-b548-becba3df70f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106efe510>]}
[0m11:58:26.906834 [info ] [MainThread]: 
[0m11:58:26.907017 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:58:26.907146 [info ] [MainThread]: 
[0m11:58:26.907381 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:58:26.907867 [debug] [ThreadPool]: Acquiring new postgres connection 'list_ecommerce_db'
[0m11:58:26.977957 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db"
[0m11:58:26.978233 [debug] [ThreadPool]: On list_ecommerce_db: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db"} */

    select distinct nspname from pg_namespace
  
[0m11:58:26.978385 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:27.016521 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.038 seconds
[0m11:58:27.017369 [debug] [ThreadPool]: On list_ecommerce_db: Close
[0m11:58:27.019994 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ecommerce_db, now list_ecommerce_db_analytics)
[0m11:58:27.023113 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:58:27.023351 [debug] [ThreadPool]: On list_ecommerce_db_analytics: BEGIN
[0m11:58:27.023493 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:58:27.031759 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m11:58:27.031979 [debug] [ThreadPool]: Using postgres connection "list_ecommerce_db_analytics"
[0m11:58:27.032138 [debug] [ThreadPool]: On list_ecommerce_db_analytics: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "list_ecommerce_db_analytics"} */
select
      'ecommerce_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'analytics'
    union all
    select
      'ecommerce_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'analytics'
  
[0m11:58:27.042258 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.010 seconds
[0m11:58:27.043113 [debug] [ThreadPool]: On list_ecommerce_db_analytics: ROLLBACK
[0m11:58:27.043423 [debug] [ThreadPool]: On list_ecommerce_db_analytics: Close
[0m11:58:27.046744 [debug] [MainThread]: Using postgres connection "master"
[0m11:58:27.046977 [debug] [MainThread]: On master: BEGIN
[0m11:58:27.047166 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:58:27.053623 [debug] [MainThread]: SQL status: BEGIN in 0.006 seconds
[0m11:58:27.053857 [debug] [MainThread]: Using postgres connection "master"
[0m11:58:27.054066 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "connection_name": "master"} */
select distinct
        dependent_namespace.nspname as dependent_schema,
        dependent_class.relname as dependent_name,
        referenced_namespace.nspname as referenced_schema,
        referenced_class.relname as referenced_name

    -- Query for views: views are entries in pg_class with an entry in pg_rewrite, but we avoid
    -- a seq scan on pg_rewrite by leveraging the fact there is an "internal" row in pg_depend for
    -- the view...
    from pg_class as dependent_class
    join pg_namespace as dependent_namespace on dependent_namespace.oid = dependent_class.relnamespace
    join pg_depend as dependent_depend on dependent_depend.refobjid = dependent_class.oid
        and dependent_depend.classid = 'pg_rewrite'::regclass
        and dependent_depend.refclassid = 'pg_class'::regclass
        and dependent_depend.deptype = 'i'

    -- ... and via pg_depend (that has a row per column, hence the need for "distinct" above, and
    -- making sure to exclude the internal row to avoid a view appearing to depend on itself)...
    join pg_depend as joining_depend on joining_depend.objid = dependent_depend.objid
        and joining_depend.classid = 'pg_rewrite'::regclass
        and joining_depend.refclassid = 'pg_class'::regclass
        and joining_depend.refobjid != dependent_depend.refobjid

    -- ... we can find the tables they query from in pg_class, but excluding system tables. Note we
    -- don't need need to exclude _dependent_ system tables, because they only query from other
    -- system tables, and so are automatically excluded by excluding _referenced_ system tables
    join pg_class as referenced_class on referenced_class.oid = joining_depend.refobjid
    join pg_namespace as referenced_namespace on referenced_namespace.oid = referenced_class.relnamespace
        and referenced_namespace.nspname != 'information_schema'
        and referenced_namespace.nspname not like 'pg\_%'

    order by
        dependent_schema, dependent_name, referenced_schema, referenced_name;
[0m11:58:27.060959 [debug] [MainThread]: SQL status: SELECT 13 in 0.007 seconds
[0m11:58:27.062365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b77f89bc-13b6-4a8e-b548-becba3df70f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120553ba0>]}
[0m11:58:27.062618 [debug] [MainThread]: On master: ROLLBACK
[0m11:58:27.062931 [debug] [MainThread]: Using postgres connection "master"
[0m11:58:27.063112 [debug] [MainThread]: On master: BEGIN
[0m11:58:27.063439 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:58:27.063598 [debug] [MainThread]: On master: COMMIT
[0m11:58:27.063730 [debug] [MainThread]: Using postgres connection "master"
[0m11:58:27.063854 [debug] [MainThread]: On master: COMMIT
[0m11:58:27.064082 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:58:27.064251 [debug] [MainThread]: On master: Close
[0m11:58:27.066970 [debug] [Thread-1 (]: Began running node model.ecom_analytics.mart_individual_products
[0m11:58:27.067299 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.mart_individual_products ................ [RUN]
[0m11:58:27.067534 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ecommerce_db_analytics, now model.ecom_analytics.mart_individual_products)
[0m11:58:27.067715 [debug] [Thread-1 (]: Began compiling node model.ecom_analytics.mart_individual_products
[0m11:58:27.072088 [debug] [Thread-1 (]: Writing injected SQL for node "model.ecom_analytics.mart_individual_products"
[0m11:58:27.076523 [debug] [Thread-1 (]: Began executing node model.ecom_analytics.mart_individual_products
[0m11:58:27.096139 [debug] [Thread-1 (]: Writing runtime sql for node "model.ecom_analytics.mart_individual_products"
[0m11:58:27.097309 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:58:27.097562 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: BEGIN
[0m11:58:27.097729 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:58:27.125120 [debug] [Thread-1 (]: SQL status: BEGIN in 0.027 seconds
[0m11:58:27.125407 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:58:27.125695 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */

  
    

  create  table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp"
  
  
    as
  
  (
    -- Product-level performance mart
-- One row per product_id with detailed product metrics
WITH product_metrics AS (
    SELECT 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm,
        
        -- Order metrics
        COUNT(DISTINCT oj.order_id) as total_orders,
        COUNT(DISTINCT oj.customer_id) as unique_customers,
        COUNT(oj.order_item_id) as total_quantity_sold,
        
        -- Revenue metrics  
        SUM(oj.total_item_value) as total_product_revenue,
        AVG(oj.price) as average_selling_price,
        AVG(oj.total_item_value) as average_order_value,
        
        -- Delivery metrics
        AVG(oj.delivery_days) as average_delivery_days,
        COUNT(CASE WHEN oj.is_late_delivery THEN 1 END) * 100.0 / COUNT(oj.order_id) as late_delivery_percentage,
        
        -- Time analysis
        MIN(oj.order_purchase_timestamp) as first_order_date,
        MAX(oj.order_purchase_timestamp) as last_order_date,
        
        -- Customer behavior
        AVG(oj.total_item_value) as average_item_value
        
    FROM "ecommerce_db"."analytics"."stg_products" p
    LEFT JOIN "ecommerce_db"."analytics"."int_orders_joined" oj 
        ON p.product_id = oj.product_id
    GROUP BY 
        p.product_id,
        oj.product_category_name_english,
        p.product_name_lenght,
        p.product_description_lenght,
        p.product_photos_qty,
        p.product_weight_g,
        p.product_length_cm,
        p.product_height_cm,
        p.product_width_cm
),

product_rankings AS (
    SELECT 
        *,
        -- Revenue rankings
        ROW_NUMBER() OVER (ORDER BY total_product_revenue DESC NULLS LAST) as revenue_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_product_revenue DESC NULLS LAST) as category_revenue_rank,
        
        -- Volume rankings
        ROW_NUMBER() OVER (ORDER BY total_quantity_sold DESC NULLS LAST) as volume_rank,
        ROW_NUMBER() OVER (PARTITION BY product_category_name_english ORDER BY total_quantity_sold DESC NULLS LAST) as category_volume_rank,
        
        -- Performance tiers
        CASE 
            WHEN total_product_revenue >= 50000 THEN 'Star Product'
            WHEN total_product_revenue >= 10000 THEN 'Strong Performer'  
            WHEN total_product_revenue >= 1000 THEN 'Average Performer'
            WHEN total_product_revenue > 0 THEN 'Low Performer'
            ELSE 'No Sales'
        END as performance_tier
        
    FROM product_metrics
)

SELECT 
    product_id,
    product_category_name_english,
    
    -- Product attributes
    product_name_lenght,
    product_description_lenght,
    product_photos_qty,
    product_weight_g,
    product_length_cm,
    product_height_cm,
    product_width_cm,
    
    -- Sales metrics
    total_orders,
    unique_customers,
    total_quantity_sold,
    
    -- Revenue metrics
    ROUND(total_product_revenue::NUMERIC, 2) as total_product_revenue,
    ROUND(average_selling_price::NUMERIC, 2) as average_selling_price,
    ROUND(average_order_value::NUMERIC, 2) as average_order_value,
    
    -- Delivery metrics
    ROUND(average_delivery_days::NUMERIC, 1) as average_delivery_days,
    ROUND(late_delivery_percentage::NUMERIC, 2) as late_delivery_percentage,
    
    -- Time metrics
    first_order_date,
    last_order_date,
    ROUND(average_item_value::NUMERIC, 2) as average_item_value,
    
    -- Rankings
    revenue_rank,
    category_revenue_rank,
    volume_rank,
    category_volume_rank,
    
    -- Performance tier
    performance_tier
    
FROM product_rankings
ORDER BY revenue_rank
  );
  
[0m11:58:28.640587 [debug] [Thread-1 (]: SQL status: SELECT 32951 in 1.512 seconds
[0m11:58:28.654211 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:58:28.654790 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */
alter table "ecommerce_db"."analytics"."mart_individual_products" rename to "mart_individual_products__dbt_backup"
[0m11:58:28.655558 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:58:28.657656 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:58:28.657892 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */
alter table "ecommerce_db"."analytics"."mart_individual_products__dbt_tmp" rename to "mart_individual_products"
[0m11:58:28.658596 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:58:28.670946 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: COMMIT
[0m11:58:28.671354 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:58:28.671740 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: COMMIT
[0m11:58:28.673884 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m11:58:28.678204 [debug] [Thread-1 (]: Applying DROP to: "ecommerce_db"."analytics"."mart_individual_products__dbt_backup"
[0m11:58:28.682013 [debug] [Thread-1 (]: Using postgres connection "model.ecom_analytics.mart_individual_products"
[0m11:58:28.682333 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "ecom_analytics", "target_name": "dev", "node_id": "model.ecom_analytics.mart_individual_products"} */
drop table if exists "ecommerce_db"."analytics"."mart_individual_products__dbt_backup" cascade
[0m11:58:28.685522 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m11:58:28.687232 [debug] [Thread-1 (]: On model.ecom_analytics.mart_individual_products: Close
[0m11:58:28.691376 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b77f89bc-13b6-4a8e-b548-becba3df70f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1206fc590>]}
[0m11:58:28.691896 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.mart_individual_products ........... [[32mSELECT 32951[0m in 1.62s]
[0m11:58:28.692298 [debug] [Thread-1 (]: Finished running node model.ecom_analytics.mart_individual_products
[0m11:58:28.693172 [debug] [MainThread]: Using postgres connection "master"
[0m11:58:28.693391 [debug] [MainThread]: On master: BEGIN
[0m11:58:28.693568 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:58:28.698452 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m11:58:28.698807 [debug] [MainThread]: On master: COMMIT
[0m11:58:28.699065 [debug] [MainThread]: Using postgres connection "master"
[0m11:58:28.699263 [debug] [MainThread]: On master: COMMIT
[0m11:58:28.699589 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:58:28.699838 [debug] [MainThread]: On master: Close
[0m11:58:28.700113 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:28.700323 [debug] [MainThread]: Connection 'model.ecom_analytics.mart_individual_products' was properly closed.
[0m11:58:28.700540 [info ] [MainThread]: 
[0m11:58:28.700785 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.79 seconds (1.79s).
[0m11:58:28.701226 [debug] [MainThread]: Command end result
[0m11:58:28.788771 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m11:58:28.795835 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m11:58:28.800066 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/run_results.json
[0m11:58:28.800378 [info ] [MainThread]: 
[0m11:58:28.800770 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:58:28.800963 [info ] [MainThread]: 
[0m11:58:28.801141 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:58:28.803001 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.5474179, "process_in_blocks": "0", "process_kernel_time": 0.351297, "process_mem_max_rss": "153829376", "process_out_blocks": "0", "process_user_time": 1.880915}
[0m11:58:28.803282 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:28.803236 after 2.55 seconds
[0m11:58:28.803487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1201faa40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1200337f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120033b10>]}
[0m11:58:28.803675 [debug] [MainThread]: Flushing usage events
[0m11:58:29.623886 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:44:41.369756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084fe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bf7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bf7c50>]}


============================== 07:44:41.373885 | 16e84094-e28f-4094-af31-c9f5f872f93e ==============================
[0m07:44:41.373885 [info ] [MainThread]: Running with dbt=1.10.15
[0m07:44:41.374278 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt list --resource-type model', 'partial_parse': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'log_path': '/Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/logs', 'empty': 'None', 'version_check': 'True', 'static_parser': 'True', 'target_path': 'None', 'profiles_dir': '/Users/raramesh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'debug': 'False', 'quiet': 'False', 'write_json': 'True', 'printer_width': '80', 'introspect': 'True', 'log_format': 'default'}
[0m07:44:41.794181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '16e84094-e28f-4094-af31-c9f5f872f93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c0a650>]}
[0m07:44:41.828741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '16e84094-e28f-4094-af31-c9f5f872f93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10998fdf0>]}
[0m07:44:41.829822 [info ] [MainThread]: Registered adapter: postgres=1.9.1
[0m07:44:41.904504 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m07:44:41.986395 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:44:41.986819 [debug] [MainThread]: Partial parsing: updated file: ecom_analytics://models/marts/mart_monthly_sales_summary.sql
[0m07:44:42.113441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '16e84094-e28f-4094-af31-c9f5f872f93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5a5150>]}
[0m07:44:42.149725 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/manifest.json
[0m07:44:42.151689 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/raramesh/Desktop/Project/ecom-analytics-platform/ecom_analytics/target/semantic_manifest.json
[0m07:44:42.167615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '16e84094-e28f-4094-af31-c9f5f872f93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a31b980>]}
[0m07:44:42.168362 [info ] [MainThread]: ecom_analytics.intermediate.int_orders_joined
[0m07:44:42.168576 [info ] [MainThread]: ecom_analytics.marts.mart_customer_analytics
[0m07:44:42.168723 [info ] [MainThread]: ecom_analytics.marts.mart_individual_products
[0m07:44:42.168856 [info ] [MainThread]: ecom_analytics.marts.mart_monthly_sales_summary
[0m07:44:42.168978 [info ] [MainThread]: ecom_analytics.marts.mart_product_performance
[0m07:44:42.169096 [info ] [MainThread]: ecom_analytics.staging.stg_customers
[0m07:44:42.169212 [info ] [MainThread]: ecom_analytics.staging.stg_order_items
[0m07:44:42.169331 [info ] [MainThread]: ecom_analytics.staging.stg_order_payments
[0m07:44:42.169442 [info ] [MainThread]: ecom_analytics.staging.stg_orders
[0m07:44:42.169554 [info ] [MainThread]: ecom_analytics.staging.stg_product_category_name_translation
[0m07:44:42.169669 [info ] [MainThread]: ecom_analytics.staging.stg_products
[0m07:44:42.169781 [info ] [MainThread]: ecom_analytics.staging.stg_sellers
[0m07:44:42.171355 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 0.86456734, "process_in_blocks": "0", "process_kernel_time": 0.289213, "process_mem_max_rss": "144982016", "process_out_blocks": "0", "process_user_time": 1.632632}
[0m07:44:42.171607 [debug] [MainThread]: Command `dbt list` succeeded at 07:44:42.171560 after 0.86 seconds
[0m07:44:42.171796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10999bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a363070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7bdd90>]}
[0m07:44:42.171962 [debug] [MainThread]: Flushing usage events
[0m07:44:45.034441 [debug] [MainThread]: An error was encountered while trying to flush usage events
